+function(e){function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,i=this;e(this).one(e.support.transition.end,function(){n=!0});var o=function(){n||e(i).trigger(e.support.transition.end)};return setTimeout(o,t),this},e(function(){e.support.transition=t()})}(jQuery),+function(e){var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function n(){a.trigger("closed.bs.alert").remove()}var i=e(this),o=i.attr("data-target");o||(o=i.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,""));var a=e(o);t&&t.preventDefault(),a.length||(a=i.hasClass("alert")?i:i.parent()),a.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(a.removeClass("in"),e.support.transition&&a.hasClass("fade")?a.one(e.support.transition.end,n).emulateTransitionEnd(150):n())};var i=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var i=e(this),o=i.data("bs.alert");o||i.data("bs.alert",o=new n(this)),"string"==typeof t&&o[t].call(i)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=i,this},e(document).on("click.bs.alert.data-api",t,n.prototype.close)}(jQuery),+function(e){var t=function(n,i){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,i),this.isLoading=!1};t.DEFAULTS={loadingText:"loading..."},t.prototype.setState=function(t){var n="disabled",i=this.$element,o=i.is("input")?"val":"html",a=i.data();t+="Text",a.resetText||i.data("resetText",i[o]()),i[o](a[t]||this.options[t]),setTimeout(e.proxy(function(){"loadingText"==t?(this.isLoading=!0,i.addClass(n).attr(n,n)):this.isLoading&&(this.isLoading=!1,i.removeClass(n).removeAttr(n))},this),0)},t.prototype.toggle=function(){var e=!0,t=this.$element.closest('[data-toggle="buttons"]');if(t.length){var n=this.$element.find("input");"radio"==n.prop("type")&&(n.prop("checked")&&this.$element.hasClass("active")?e=!1:t.find(".active").removeClass("active")),e&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}e&&this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var i=e(this),o=i.data("bs.button"),a="object"==typeof n&&n;o||i.data("bs.button",o=new t(this,a)),"toggle"==n?o.toggle():n&&o.setState(n)})},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.bs.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle"),t.preventDefault()})}(jQuery),+function(e){var t=function(t,n){this.options=n,this.$element=e(t),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},t.prototype.toggle=function(e){return this[this.isShown?"hide":"show"](e)},t.prototype.show=function(t){var n=this,i=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var i=e.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(document.body),n.$element.show().scrollTop(0),i&&n.$element[0].offsetWidth,n.$element.addClass("in").attr("aria-hidden",!1),n.enforceFocus();var o=e.Event("shown.bs.modal",{relatedTarget:t});i?n.$element.find(".modal-dialog").one(e.support.transition.end,function(){n.$element.focus().trigger(o)}).emulateTransitionEnd(300):n.$element.focus().trigger(o)}))},t.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one(e.support.transition.end,e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},t.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.focus()},this))},t.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},t.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden.bs.modal")})},t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},t.prototype.backdrop=function(t){var n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&n;if(this.$backdrop=e('<div class="modal-backdrop '+n+'" />').appendTo(document.body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;i?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()):t&&t()};var n=e.fn.modal;e.fn.modal=function(n,i){return this.each(function(){var o=e(this),a=o.data("bs.modal"),r=e.extend({},t.DEFAULTS,o.data(),"object"==typeof n&&n);a||o.data("bs.modal",a=new t(this,r)),"string"==typeof n?a[n](i):r.show&&a.show(i)})},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),i=n.attr("href"),o=e(n.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),a=o.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(i)&&i},o.data(),n.data());n.is("a")&&t.preventDefault(),o.modal(a,this).one("hide",function(){n.is(":visible")&&n.focus()})}),e(document).on("show.bs.modal",".modal",function(){e(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){e(document.body).removeClass("modal-open")})}(jQuery),function(){var e=this,t=e._,n={},i=Array.prototype,o=Object.prototype,a=Function.prototype,r=i.push,s=i.slice,l=i.concat,c=o.toString,d=o.hasOwnProperty,u=i.forEach,h=i.map,p=i.reduce,f=i.reduceRight,m=i.filter,v=i.every,g=i.some,k=i.indexOf,w=i.lastIndexOf,_=Array.isArray,b=Object.keys,$=a.bind,y=function(e){return e instanceof y?e:this instanceof y?void(this._wrapped=e):new y(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):e._=y,y.VERSION="1.5.2";var C=y.each=y.forEach=function(e,t,i){if(null!=e)if(u&&e.forEach===u)e.forEach(t,i);else if(e.length===+e.length){for(var o=0,a=e.length;a>o;o++)if(t.call(i,e[o],o,e)===n)return}else for(var r=y.keys(e),o=0,a=r.length;a>o;o++)if(t.call(i,e[r[o]],r[o],e)===n)return};y.map=y.collect=function(e,t,n){var i=[];return null==e?i:h&&e.map===h?e.map(t,n):(C(e,function(e,o,a){i.push(t.call(n,e,o,a))}),i)};var x="Reduce of empty array with no initial value";y.reduce=y.foldl=y.inject=function(e,t,n,i){var o=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return i&&(t=y.bind(t,i)),o?e.reduce(t,n):e.reduce(t);if(C(e,function(e,a,r){o?n=t.call(i,n,e,a,r):(n=e,o=!0)}),!o)throw new TypeError(x);return n},y.reduceRight=y.foldr=function(e,t,n,i){var o=arguments.length>2;if(null==e&&(e=[]),f&&e.reduceRight===f)return i&&(t=y.bind(t,i)),o?e.reduceRight(t,n):e.reduceRight(t);var a=e.length;if(a!==+a){var r=y.keys(e);a=r.length}if(C(e,function(s,l,c){l=r?r[--a]:--a,o?n=t.call(i,n,e[l],l,c):(n=e[l],o=!0)}),!o)throw new TypeError(x);return n},y.find=y.detect=function(e,t,n){var i;return T(e,function(e,o,a){return t.call(n,e,o,a)?(i=e,!0):void 0}),i},y.filter=y.select=function(e,t,n){var i=[];return null==e?i:m&&e.filter===m?e.filter(t,n):(C(e,function(e,o,a){t.call(n,e,o,a)&&i.push(e)}),i)},y.reject=function(e,t,n){return y.filter(e,function(e,i,o){return!t.call(n,e,i,o)},n)},y.every=y.all=function(e,t,i){t||(t=y.identity);var o=!0;return null==e?o:v&&e.every===v?e.every(t,i):(C(e,function(e,a,r){return(o=o&&t.call(i,e,a,r))?void 0:n}),!!o)};var T=y.some=y.any=function(e,t,i){t||(t=y.identity);var o=!1;return null==e?o:g&&e.some===g?e.some(t,i):(C(e,function(e,a,r){return o||(o=t.call(i,e,a,r))?n:void 0}),!!o)};y.contains=y.include=function(e,t){return null==e?!1:k&&e.indexOf===k?-1!=e.indexOf(t):T(e,function(e){return e===t})},y.invoke=function(e,t){var n=s.call(arguments,2),i=y.isFunction(t);return y.map(e,function(e){return(i?t:e[t]).apply(e,n)})},y.pluck=function(e,t){return y.map(e,function(e){return e[t]})},y.where=function(e,t,n){return y.isEmpty(t)?n?void 0:[]:y[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},y.findWhere=function(e,t){return y.where(e,t,!0)},y.max=function(e,t,n){if(!t&&y.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&y.isEmpty(e))return-1/0;var i={computed:-1/0,value:-1/0};return C(e,function(e,o,a){var r=t?t.call(n,e,o,a):e;r>i.computed&&(i={value:e,computed:r})}),i.value},y.min=function(e,t,n){if(!t&&y.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&y.isEmpty(e))return 1/0;var i={computed:1/0,value:1/0};return C(e,function(e,o,a){var r=t?t.call(n,e,o,a):e;r<i.computed&&(i={value:e,computed:r})}),i.value},y.shuffle=function(e){var t,n=0,i=[];return C(e,function(e){t=y.random(n++),i[n-1]=i[t],i[t]=e}),i},y.sample=function(e,t,n){return arguments.length<2||n?e[y.random(e.length-1)]:y.shuffle(e).slice(0,Math.max(0,t))};var E=function(e){return y.isFunction(e)?e:function(t){return t[e]}};y.sortBy=function(e,t,n){var i=E(t);return y.pluck(y.map(e,function(e,t,o){return{value:e,index:t,criteria:i.call(n,e,t,o)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var S=function(e){return function(t,n,i){var o={},a=null==n?y.identity:E(n);return C(t,function(n,r){var s=a.call(i,n,r,t);e(o,s,n)}),o}};y.groupBy=S(function(e,t,n){(y.has(e,t)?e[t]:e[t]=[]).push(n)}),y.indexBy=S(function(e,t,n){e[t]=n}),y.countBy=S(function(e,t){y.has(e,t)?e[t]++:e[t]=1}),y.sortedIndex=function(e,t,n,i){n=null==n?y.identity:E(n);for(var o=n.call(i,t),a=0,r=e.length;r>a;){var s=a+r>>>1;n.call(i,e[s])<o?a=s+1:r=s}return a},y.toArray=function(e){return e?y.isArray(e)?s.call(e):e.length===+e.length?y.map(e,y.identity):y.values(e):[]},y.size=function(e){return null==e?0:e.length===+e.length?e.length:y.keys(e).length},y.first=y.head=y.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:s.call(e,0,t)},y.initial=function(e,t,n){return s.call(e,0,e.length-(null==t||n?1:t))},y.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},y.rest=y.tail=y.drop=function(e,t,n){return s.call(e,null==t||n?1:t)},y.compact=function(e){return y.filter(e,y.identity)};var A=function(e,t,n){return t&&y.every(e,y.isArray)?l.apply(n,e):(C(e,function(e){y.isArray(e)||y.isArguments(e)?t?r.apply(n,e):A(e,t,n):n.push(e)}),n)};y.flatten=function(e,t){return A(e,t,[])},y.without=function(e){return y.difference(e,s.call(arguments,1))},y.uniq=y.unique=function(e,t,n,i){y.isFunction(t)&&(i=n,n=t,t=!1);var o=n?y.map(e,n,i):e,a=[],r=[];return C(o,function(n,i){(t?i&&r[r.length-1]===n:y.contains(r,n))||(r.push(n),a.push(e[i]))}),a},y.union=function(){return y.uniq(y.flatten(arguments,!0))},y.intersection=function(e){var t=s.call(arguments,1);return y.filter(y.uniq(e),function(e){return y.every(t,function(t){return y.indexOf(t,e)>=0})})},y.difference=function(e){var t=l.apply(i,s.call(arguments,1));return y.filter(e,function(e){return!y.contains(t,e)})},y.zip=function(){for(var e=y.max(y.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=y.pluck(arguments,""+n);return t},y.object=function(e,t){if(null==e)return{};for(var n={},i=0,o=e.length;o>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},y.indexOf=function(e,t,n){if(null==e)return-1;var i=0,o=e.length;if(n){if("number"!=typeof n)return i=y.sortedIndex(e,t),e[i]===t?i:-1;i=0>n?Math.max(0,o+n):n}if(k&&e.indexOf===k)return e.indexOf(t,n);for(;o>i;i++)if(e[i]===t)return i;return-1},y.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=null!=n;if(w&&e.lastIndexOf===w)return i?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var o=i?n:e.length;o--;)if(e[o]===t)return o;return-1},y.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),o=0,a=new Array(i);i>o;)a[o++]=e,e+=n;return a};var I=function(){};y.bind=function(e,t){var n,i;if($&&e.bind===$)return $.apply(e,s.call(arguments,1));if(!y.isFunction(e))throw new TypeError;return n=s.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(t,n.concat(s.call(arguments)));I.prototype=e.prototype;var o=new I;I.prototype=null;var a=e.apply(o,n.concat(s.call(arguments)));return Object(a)===a?a:o}},y.partial=function(e){var t=s.call(arguments,1);return function(){return e.apply(this,t.concat(s.call(arguments)))}},y.bindAll=function(e){var t=s.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return C(t,function(t){e[t]=y.bind(e[t],e)}),e},y.memoize=function(e,t){var n={};return t||(t=y.identity),function(){var i=t.apply(this,arguments);return y.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},y.delay=function(e,t){var n=s.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},y.defer=function(e){return y.delay.apply(y,[e,1].concat(s.call(arguments,1)))},y.throttle=function(e,t,n){var i,o,a,r=null,s=0;n||(n={});var l=function(){s=n.leading===!1?0:new Date,r=null,a=e.apply(i,o)};return function(){var c=new Date;s||n.leading!==!1||(s=c);var d=t-(c-s);return i=this,o=arguments,0>=d?(clearTimeout(r),r=null,s=c,a=e.apply(i,o)):r||n.trailing===!1||(r=setTimeout(l,d)),a}},y.debounce=function(e,t,n){var i,o,a,r,s;return function(){a=this,o=arguments,r=new Date;var l=function(){var c=new Date-r;t>c?i=setTimeout(l,t-c):(i=null,n||(s=e.apply(a,o)))},c=n&&!i;return i||(i=setTimeout(l,t)),c&&(s=e.apply(a,o)),s}},y.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},y.wrap=function(e,t){return function(){var n=[e];return r.apply(n,arguments),t.apply(this,n)}},y.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},y.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},y.keys=b||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)y.has(e,n)&&t.push(n);return t},y.values=function(e){for(var t=y.keys(e),n=t.length,i=new Array(n),o=0;n>o;o++)i[o]=e[t[o]];return i},y.pairs=function(e){for(var t=y.keys(e),n=t.length,i=new Array(n),o=0;n>o;o++)i[o]=[t[o],e[t[o]]];return i},y.invert=function(e){for(var t={},n=y.keys(e),i=0,o=n.length;o>i;i++)t[e[n[i]]]=n[i];return t},y.functions=y.methods=function(e){var t=[];for(var n in e)y.isFunction(e[n])&&t.push(n);return t.sort()},y.extend=function(e){return C(s.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},y.pick=function(e){var t={},n=l.apply(i,s.call(arguments,1));return C(n,function(n){n in e&&(t[n]=e[n])}),t},y.omit=function(e){var t={},n=l.apply(i,s.call(arguments,1));for(var o in e)y.contains(n,o)||(t[o]=e[o]);return t},y.defaults=function(e){return C(s.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},y.clone=function(e){return y.isObject(e)?y.isArray(e)?e.slice():y.extend({},e):e},y.tap=function(e,t){return t(e),e};var P=function(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof y&&(e=e._wrapped),t instanceof y&&(t=t._wrapped);var o=c.call(e);if(o!=c.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var a=n.length;a--;)if(n[a]==e)return i[a]==t;var r=e.constructor,s=t.constructor;if(r!==s&&!(y.isFunction(r)&&r instanceof r&&y.isFunction(s)&&s instanceof s))return!1;n.push(e),i.push(t);var l=0,d=!0;if("[object Array]"==o){if(l=e.length,d=l==t.length)for(;l--&&(d=P(e[l],t[l],n,i)););}else{for(var u in e)if(y.has(e,u)&&(l++,!(d=y.has(t,u)&&P(e[u],t[u],n,i))))break;if(d){for(u in t)if(y.has(t,u)&&!l--)break;d=!l}}return n.pop(),i.pop(),d};y.isEqual=function(e,t){return P(e,t,[],[])},y.isEmpty=function(e){if(null==e)return!0;if(y.isArray(e)||y.isString(e))return 0===e.length;for(var t in e)if(y.has(e,t))return!1;return!0},y.isElement=function(e){return!(!e||1!==e.nodeType)},y.isArray=_||function(e){return"[object Array]"==c.call(e)},y.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){y["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),y.isArguments(arguments)||(y.isArguments=function(e){return!(!e||!y.has(e,"callee"))}),"function"!=typeof/./&&(y.isFunction=function(e){return"function"==typeof e}),y.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},y.isNaN=function(e){return y.isNumber(e)&&e!=+e},y.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},y.isNull=function(e){return null===e},y.isUndefined=function(e){return void 0===e},y.has=function(e,t){return d.call(e,t)},y.noConflict=function(){return e._=t,this},y.identity=function(e){return e},y.times=function(e,t,n){for(var i=Array(Math.max(0,e)),o=0;e>o;o++)i[o]=t.call(n,o);return i},y.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var D={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};D.unescape=y.invert(D.escape);var M={escape:new RegExp("["+y.keys(D.escape).join("")+"]","g"),unescape:new RegExp("("+y.keys(D.unescape).join("|")+")","g")};y.each(["escape","unescape"],function(e){y[e]=function(t){return null==t?"":(""+t).replace(M[e],function(t){return D[e][t]})}}),y.result=function(e,t){if(null==e)return void 0;var n=e[t];return y.isFunction(n)?n.call(e):n},y.mixin=function(e){C(y.functions(e),function(t){var n=y[t]=e[t];y.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),R.call(this,n.apply(y,e))}})};var j=0;y.uniqueId=function(e){var t=++j+"";return e?e+t:t},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","    ":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;y.template=function(e,t,n){var i;n=y.defaults({},n,y.templateSettings);var o=new RegExp([(n.escape||O).source,(n.interpolate||O).source,(n.evaluate||O).source].join("|")+"|$","g"),a=0,r="__p+='";e.replace(o,function(t,n,i,o,s){return r+=e.slice(a,s).replace(L,function(e){return"\\"+F[e]}),n&&(r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(r+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),o&&(r+="';\n"+o+"\n__p+='"),a=s+t.length,t}),r+="';\n",n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{i=new Function(n.variable||"obj","_",r)}catch(s){throw s.source=r,s}if(t)return i(t,y);var l=function(e){return i.call(this,e,y)};return l.source="function("+(n.variable||"obj")+"){\n"+r+"}",l},y.chain=function(e){return y(e).chain()};var R=function(e){return this._chain?y(e).chain():e};y.mixin(y),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];y.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],R.call(this,n)}}),C(["concat","join","slice"],function(e){var t=i[e];y.prototype[e]=function(){return R.call(this,t.apply(this._wrapped,arguments))}}),y.extend(y.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){{var e,t=this,n=t.Backbone,i=[],o=(i.push,i.slice);i.splice}e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="1.1.0";var a=t._;a||"undefined"==typeof require||(a=require("underscore")),e.$=t.jQuery||t.Zepto||t.ender||t.$,e.noConflict=function(){return t.Backbone=n,this},e.emulateHTTP=!1,e.emulateJSON=!1;var r=e.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var i=this._events[e]||(this._events[e]=[]);return i.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var i=this,o=a.once(function(){i.off(e,o),t.apply(this,arguments)});return o._callback=t,this.on(e,o,n)},off:function(e,t,n){var i,o,r,s,c,d,u,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(s=e?[e]:a.keys(this._events),c=0,d=s.length;d>c;c++)if(e=s[c],r=this._events[e]){if(this._events[e]=i=[],t||n)for(u=0,h=r.length;h>u;u++)o=r[u],(t&&t!==o.callback&&t!==o.callback._callback||n&&n!==o.context)&&i.push(o);i.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=o.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&c(n,t),i&&c(i,arguments),this},stopListening:function(e,t,n){var i=this._listeningTo;if(!i)return this;var o=!t&&!n;n||"object"!=typeof t||(n=this),e&&((i={})[e._listenId]=e);for(var r in i)e=i[r],e.off(t,n,this),(o||a.isEmpty(e._events))&&delete this._listeningTo[r];return this}},s=/\s+/,l=function(e,t,n,i){if(!n)return!0;if("object"==typeof n){for(var o in n)e[t].apply(e,[o,n[o]].concat(i));return!1}if(s.test(n)){for(var a=n.split(s),r=0,l=a.length;l>r;r++)e[t].apply(e,[a[r]].concat(i));return!1}return!0},c=function(e,t){var n,i=-1,o=e.length,a=t[0],r=t[1],s=t[2];switch(t.length){case 0:for(;++i<o;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=e[i]).callback.call(n.ctx,a);return;case 2:for(;++i<o;)(n=e[i]).callback.call(n.ctx,a,r);return;case 3:for(;++i<o;)(n=e[i]).callback.call(n.ctx,a,r,s);return;default:for(;++i<o;)(n=e[i]).callback.apply(n.ctx,t)}},d={listenTo:"on",listenToOnce:"once"};a.each(d,function(e,t){r[t]=function(t,n,i){var o=this._listeningTo||(this._listeningTo={}),r=t._listenId||(t._listenId=a.uniqueId("l"));return o[r]=t,i||"object"!=typeof n||(i=this),t[e](n,i,this),this}}),r.bind=r.on,r.unbind=r.off,a.extend(e,r);var u=e.View=function(e){this.cid=a.uniqueId("view"),e||(e={}),a.extend(this,a.pick(e,p)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},h=/^(\S+)\s*(.*)$/,p=["model","collection","el","id","attributes","className","tagName","events"];a.extend(u.prototype,r,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,n){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=a.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(a.isFunction(n)||(n=this[e[t]]),n){var i=t.match(h),o=i[1],r=i[2];n=a.bind(n,this),o+=".delegateEvents"+this.cid,""===r?this.$el.on(o,n):this.$el.on(o,r,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(a.result(this,"el"),!1);else{var t=a.extend({},a.result(this,"attributes"));this.id&&(t.id=a.result(this,"id")),this.className&&(t["class"]=a.result(this,"className"));var n=e.$("<"+a.result(this,"tagName")+">").attr(t);this.setElement(n,!1)}}}),e.sync=function(t,n,i){var o=m[t];a.defaults(i||(i={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var r={type:o,dataType:"json"};if(i.url||(r.url=a.result(n,"url")||g()),null!=i.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(r.contentType="application/json",r.data=JSON.stringify(i.attrs||n.toJSON(i))),i.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),i.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){r.type="POST",i.emulateJSON&&(r.data._method=o);var s=i.beforeSend;i.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",o),s?s.apply(this,arguments):void 0}}"GET"===r.type||i.emulateJSON||(r.processData=!1),"PATCH"===r.type&&f&&(r.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=i.xhr=e.ajax(a.extend(r,i));return n.trigger("request",n,l,i),l};var f=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),m={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var v=function(e,t){var n,i=this;n=e&&a.has(e,"constructor")?e.constructor:function(){return i.apply(this,arguments)},a.extend(n,i,t);var o=function(){this.constructor=n};return o.prototype=i.prototype,n.prototype=new o,e&&a.extend(n.prototype,e),n.__super__=i.prototype,n};u.extend=v;var g=function(){throw new Error('A "url" property or function must be specified')}}.call(this),function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),o=window.setTimeout(function(){t(n+i)},i);return e=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(e,t){function n(e){this.callback=e,this.ticking=!1}function i(e){if(arguments.length<=0)throw new Error("Missing arguments in extend function");var t,n,o=e||{};for(n=1;n<arguments.length;n++){var a=arguments[n]||{};for(t in a)o[t]="object"==typeof o[t]?i(o[t],a[t]):o[t]||a[t]}return o}function o(e){return e===Object(e)?e:{down:e,up:e}}function a(e,t){t=i(t,a.options),this.lastKnownScrollY=0,this.elem=e,this.debouncer=new n(_.bind(this.update,this)),this.tolerance=o(t.tolerance),this.classes=t.classes,this.offset=t.offset,this.initialised=!1,this.onPin=t.onPin,this.onUnpin=t.onUnpin,this.onTop=t.onTop,this.onNotTop=t.onNotTop}var r={bind:!0,classList:"classList"in t.documentElement,rAF:!!(e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame)};e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame,n.prototype={constructor:n,update:function(){this.callback&&this.callback(),this.ticking=!1},requestTick:function(){this.ticking||(requestAnimationFrame(this.rafCallback||(this.rafCallback=_.bind(this.update,this))),this.ticking=!0)},handleEvent:function(){this.requestTick()}},a.prototype={constructor:a,init:function(){return a.cutsTheMustard?(this.elem.classList.add(this.classes.initial),setTimeout(_.bind(this.attachEvent,this),100),this):void 0},destroy:function(){var t=this.classes;this.initialised=!1,e.removeEventListener("scroll",this.debouncer,!1),this.elem.classList.remove(t.unpinned,t.pinned,t.top,t.initial)},attachEvent:function(){this.initialised||(this.lastKnownScrollY=this.getScrollY(),this.initialised=!0,e.addEventListener("scroll",this.debouncer,!1),this.debouncer.handleEvent())},unpin:function(){var e=this.elem.classList,t=this.classes;(e.contains(t.pinned)||!e.contains(t.unpinned))&&(e.add(t.unpinned),e.remove(t.pinned),this.onUnpin&&this.onUnpin.call(this))},pin:function(){var e=this.elem.classList,t=this.classes;e.contains(t.unpinned)&&(e.remove(t.unpinned),e.add(t.pinned),this.onPin&&this.onPin.call(this))},top:function(){var e=this.elem.classList,t=this.classes;e.contains(t.top)||(e.add(t.top),e.remove(t.notTop),this.onTop&&this.onTop.call(this))},notTop:function(){var e=this.elem.classList,t=this.classes;e.contains(t.notTop)||(e.add(t.notTop),e.remove(t.top),this.onNotTop&&this.onNotTop.call(this))},getScrollY:function(){return void 0!==e.pageYOffset?e.pageYOffset:(t.documentElement||t.body.parentNode||t.body).scrollTop},getViewportHeight:function(){return e.innerHeight||t.documentElement.clientHeight||t.body.clientHeight},getDocumentHeight:function(){var e=t.body,n=t.documentElement;return Math.max(e.scrollHeight,n.scrollHeight,e.offsetHeight,n.offsetHeight,e.clientHeight,n.clientHeight)},isOutOfBounds:function(e){var t=0>e,n=e+this.getViewportHeight()>this.getDocumentHeight();return t||n},toleranceExceeded:function(e,t){return Math.abs(e-this.lastKnownScrollY)>=this.tolerance[t]},shouldUnpin:function(e,t){var n=e>this.lastKnownScrollY,i=e>=this.offset;return n&&i&&t},shouldPin:function(e,t){var n=e<this.lastKnownScrollY,i=e<=this.offset;return n&&t||i},update:function(){var e=this.getScrollY(),t=e>this.lastKnownScrollY?"down":"up",n=this.toleranceExceeded(e,t);this.isOutOfBounds(e)||(e<=this.offset?this.top():this.notTop(),this.shouldUnpin(e,n)?this.unpin():this.shouldPin(e,n)&&this.pin(),this.lastKnownScrollY=e)}},a.options={tolerance:{up:0,down:0},offset:0,classes:{pinned:"headroom--pinned",unpinned:"headroom--unpinned",top:"headroom--top",notTop:"headroom--not-top",initial:"headroom"}},a.cutsTheMustard="undefined"!=typeof r&&r.rAF&&r.bind&&r.classList,e.Headroom=a}(window,document),!function(e){e&&(e.fn.headroom=function(t){return this.each(function(){var n=e(this),i=n.data("headroom"),o="object"==typeof t&&t;o=e.extend(!0,{},Headroom.options,o),i||(i=new Headroom(this,o),i.init(),n.data("headroom",i)),"string"==typeof t&&i[t]()})},e("[data-headroom]").each(function(){var t=e(this);t.headroom(t.data())}))}(window.Zepto||window.jQuery),function(){var e,t,n,i,o,a,r,s,l,c,d,u,h,p,f,m,v,g,k,w,_=[].slice,b=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};e=jQuery,e.payment={},e.payment.fn={},e.fn.payment=function(){var t,n;return n=arguments[0],t=2<=arguments.length?_.call(arguments,1):[],e.payment.fn[n].apply(this,t)},o=/(\d{1,4})/g,i=[{type:"visaelectron",pattern:/^4(026|17500|405|508|844|91[37])/,format:o,length:[16],cvcLength:[3],luhn:!0},{type:"maestro",pattern:/^(5(018|0[23]|[68])|6(39|7))/,format:o,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",pattern:/^600/,format:o,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",pattern:/^5019/,format:o,length:[16],cvcLength:[3],luhn:!0},{type:"visa",pattern:/^4/,format:o,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[0-5]/,format:o,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",pattern:/^3[0689]/,format:o,length:[14],cvcLength:[3],luhn:!0},{type:"discover",pattern:/^6([045]|22)/,format:o,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^(62|88)/,format:o,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",pattern:/^35/,format:o,length:[16],cvcLength:[3],luhn:!0}],t=function(e){var t,n,o;for(e=(e+"").replace(/\D/g,""),n=0,o=i.length;o>n;n++)if(t=i[n],t.pattern.test(e))return t
},n=function(e){var t,n,o;for(n=0,o=i.length;o>n;n++)if(t=i[n],t.type===e)return t},h=function(e){var t,n,i,o,a,r;for(i=!0,o=0,n=(e+"").split("").reverse(),a=0,r=n.length;r>a;a++)t=n[a],t=parseInt(t,10),(i=!i)&&(t*=2),t>9&&(t-=9),o+=t;return o%10===0},u=function(e){var t;return null!=e.prop("selectionStart")&&e.prop("selectionStart")!==e.prop("selectionEnd")?!0:("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)&&"function"==typeof t.createRange?t.createRange().text:void 0)?!0:!1},p=function(t){return setTimeout(function(){var n,i;return n=e(t.currentTarget),i=n.val(),i=e.payment.formatCardNumber(i),n.val(i)})},s=function(n){var i,o,a,r,s,l,c;return a=String.fromCharCode(n.which),!/^\d+$/.test(a)||(i=e(n.currentTarget),c=i.val(),o=t(c+a),r=(c.replace(/\D/g,"")+a).length,l=16,o&&(l=o.length[o.length.length-1]),r>=l||null!=i.prop("selectionStart")&&i.prop("selectionStart")!==c.length)?void 0:(s=o&&"amex"===o.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,s.test(c)?(n.preventDefault(),setTimeout(function(){return i.val(c+" "+a)})):s.test(c+a)?(n.preventDefault(),setTimeout(function(){return i.val(c+a+" ")})):void 0)},a=function(t){var n,i;return n=e(t.currentTarget),i=n.val(),8!==t.which||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==i.length?void 0:/\d\s$/.test(i)?(t.preventDefault(),setTimeout(function(){return n.val(i.replace(/\d\s$/,""))})):/\s\d?$/.test(i)?(t.preventDefault(),setTimeout(function(){return n.val(i.replace(/\s\d?$/,""))})):void 0},f=function(t){return setTimeout(function(){var n,i;return n=e(t.currentTarget),i=n.val(),i=e.payment.formatExpiry(i),n.val(i)})},l=function(t){var n,i,o;return i=String.fromCharCode(t.which),/^\d+$/.test(i)?(n=e(t.currentTarget),o=n.val()+i,/^\d$/.test(o)&&"0"!==o&&"1"!==o?(t.preventDefault(),setTimeout(function(){return n.val("0"+o+" / ")})):/^\d\d$/.test(o)?(t.preventDefault(),setTimeout(function(){return n.val(""+o+" / ")})):void 0):void 0},c=function(t){var n,i,o;return i=String.fromCharCode(t.which),/^\d+$/.test(i)?(n=e(t.currentTarget),o=n.val(),/^\d\d$/.test(o)?n.val(""+o+" / "):void 0):void 0},d=function(t){var n,i,o;return o=String.fromCharCode(t.which),"/"===o||" "===o?(n=e(t.currentTarget),i=n.val(),/^\d$/.test(i)&&"0"!==i?n.val("0"+i+" / "):void 0):void 0},r=function(t){var n,i;return n=e(t.currentTarget),i=n.val(),8!==t.which||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==i.length?void 0:/\s\/\s\d?$/.test(i)?(t.preventDefault(),setTimeout(function(){return n.val(i.replace(/\s\/\s\d?$/,""))})):void 0},k=function(e){var t;return e.metaKey||e.ctrlKey?!0:32===e.which?!1:0===e.which?!0:e.which<33?!0:(t=String.fromCharCode(e.which),!!/[\d\s]/.test(t))},v=function(n){var i,o,a,r;return i=e(n.currentTarget),a=String.fromCharCode(n.which),/^\d+$/.test(a)&&!u(i)?(r=(i.val()+a).replace(/\D/g,""),o=t(r),o?r.length<=o.length[o.length.length-1]:r.length<=16):void 0},g=function(t){var n,i,o;return n=e(t.currentTarget),i=String.fromCharCode(t.which),/^\d+$/.test(i)&&!u(n)?(o=n.val()+i,o=o.replace(/\D/g,""),o.length>6?!1:void 0):void 0},m=function(t){var n,i,o;return n=e(t.currentTarget),i=String.fromCharCode(t.which),/^\d+$/.test(i)&&!u(n)?(o=n.val()+i,o.length<=4):void 0},w=function(t){var n,o,a,r,s;return n=e(t.currentTarget),s=n.val(),r=e.payment.cardType(s)||"unknown",n.hasClass(r)?void 0:(o=function(){var e,t,n;for(n=[],e=0,t=i.length;t>e;e++)a=i[e],n.push(a.type);return n}(),n.removeClass("unknown"),n.removeClass(o.join(" ")),n.addClass(r),n.toggleClass("identified","unknown"!==r),n.trigger("payment.cardType",r))},e.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",m),this},e.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",g),this.on("keypress",l),this.on("keypress",d),this.on("keypress",c),this.on("keydown",r),this.on("change",f),this.on("input",f),this},e.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",v),this.on("keypress",s),this.on("keydown",a),this.on("keyup",w),this.on("paste",p),this.on("change",p),this.on("input",p),this.on("input",w),this},e.payment.fn.restrictNumeric=function(){return this.on("keypress",k),this},e.payment.fn.cardExpiryVal=function(){return e.payment.cardExpiryVal(e(this).val())},e.payment.cardExpiryVal=function(e){var t,n,i,o;return e=e.replace(/\s/g,""),o=e.split("/",2),t=o[0],i=o[1],2===(null!=i?i.length:void 0)&&/^\d+$/.test(i)&&(n=(new Date).getFullYear(),n=n.toString().slice(0,2),i=n+i),t=parseInt(t,10),i=parseInt(i,10),{month:t,year:i}},e.payment.validateCardNumber=function(e){var n,i;return e=(e+"").replace(/\s+|-/g,""),/^\d+$/.test(e)?(n=t(e),n?(i=e.length,b.call(n.length,i)>=0&&(n.luhn===!1||h(e))):!1):!1},e.payment.validateCardExpiry=function(t,n){var i,o,a;return"object"==typeof t&&"month"in t&&(a=t,t=a.month,n=a.year),t&&n?(t=e.trim(t),n=e.trim(n),/^\d+$/.test(t)&&/^\d+$/.test(n)&&t>=1&&12>=t?(2===n.length&&(n=70>n?"20"+n:"19"+n),4!==n.length?!1:(o=new Date(n,t),i=new Date,o.setMonth(o.getMonth()-1),o.setMonth(o.getMonth()+1,1),o>i)):!1):!1},e.payment.validateCardCVC=function(t,i){var o,a;return t=e.trim(t),/^\d+$/.test(t)?(o=n(i),null!=o?(a=t.length,b.call(o.cvcLength,a)>=0):t.length>=3&&t.length<=4):!1},e.payment.cardType=function(e){var n;return e?(null!=(n=t(e))?n.type:void 0)||null:null},e.payment.formatCardNumber=function(n){var i,o,a,r;return(i=t(n))?(a=i.length[i.length.length-1],n=n.replace(/\D/g,""),n=n.slice(0,a),i.format.global?null!=(r=n.match(i.format))?r.join(" "):void 0:(o=i.format.exec(n),null!=o?(o.shift(),o=e.grep(o,function(e){return e}),o.join(" ")):void 0)):n},e.payment.formatExpiry=function(e){var t,n,i,o;return(n=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(t=n[1]||"",i=n[2]||"",o=n[3]||"",(o.length>0||i.length>0&&!/\ \/?\ ?/.test(i))&&(i=" / "),1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,i=" / "),t+i+o):""}}.call(this),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e,t){var n=0,i=Array.prototype.slice,o=e.cleanData;e.cleanData=function(t){for(var n,i=0;null!=(n=t[i]);i++)try{e(n).triggerHandler("remove")}catch(a){}o(t)},e.widget=function(t,n,i){var o,a,r,s,l={},c=t.split(".")[0];t=t.split(".")[1],o=c+"-"+t,i||(i=n,n=e.Widget),e.expr[":"][o.toLowerCase()]=function(t){return!!e.data(t,o)},e[c]=e[c]||{},a=e[c][t],r=e[c][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new r(e,t)},e.extend(r,a,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),s=new n,s.options=e.widget.extend({},s.options),e.each(i,function(t,i){return e.isFunction(i)?void(l[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},o=function(e){return n.prototype[t].apply(this,e)};return function(){var t,n=this._super,a=this._superApply;return this._super=e,this._superApply=o,t=i.apply(this,arguments),this._super=n,this._superApply=a,t}}()):void(l[t]=i)}),r.prototype=e.widget.extend(s,{widgetEventPrefix:a?s.widgetEventPrefix:t},l,{constructor:r,namespace:c,widgetName:t,widgetFullName:o}),a?(e.each(a._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,r,n._proto)}),delete a._childConstructors):n._childConstructors.push(r),e.widget.bridge(t,r)},e.widget.extend=function(n){for(var o,a,r=i.call(arguments,1),s=0,l=r.length;l>s;s++)for(o in r[s])a=r[s][o],r[s].hasOwnProperty(o)&&a!==t&&(n[o]=e.isPlainObject(a)?e.isPlainObject(n[o])?e.widget.extend({},n[o],a):e.widget.extend({},a):a);return n},e.widget.bridge=function(n,o){var a=o.prototype.widgetFullName||n;e.fn[n]=function(r){var s="string"==typeof r,l=i.call(arguments,1),c=this;return r=!s&&l.length?e.widget.extend.apply(null,[r].concat(l)):r,this.each(s?function(){var i,o=e.data(this,a);return o?e.isFunction(o[r])&&"_"!==r.charAt(0)?(i=o[r].apply(o,l),i!==o&&i!==t?(c=i&&i.jquery?c.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+r+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+r+"'")}:function(){var t=e.data(this,a);t?t.option(r||{})._init():e.data(this,a,new o(r,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,i){var o,a,r,s=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(s={},o=n.split("."),n=o.shift(),o.length){for(a=s[n]=e.widget.extend({},this.options[n]),r=0;r<o.length-1;r++)a[o[r]]=a[o[r]]||{},a=a[o[r]];if(n=o.pop(),i===t)return a[n]===t?null:a[n];a[n]=i}else{if(i===t)return this.options[n]===t?null:this.options[n];s[n]=i}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,i){var o,a=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=o=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,o=this.widget()),e.each(i,function(i,r){function s(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof r?a[r]:r).apply(a,arguments):void 0}"string"!=typeof r&&(s.guid=r.guid=r.guid||s.guid||e.guid++);var l=i.match(/^(\w+)\s*(.*)$/),c=l[1]+a.eventNamespace,d=l[2];d?o.delegate(d,c,s):n.bind(c,s)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,i){var o,a,r=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],a=n.originalEvent)for(o in a)o in n||(n[o]=a[o]);return this.element.trigger(n,i),!(e.isFunction(r)&&r.apply(this.element[0],[n].concat(i))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,o,a){"string"==typeof o&&(o={effect:o});var r,s=o?o===!0||"number"==typeof o?n:o.effect||n:t;o=o||{},"number"==typeof o&&(o={duration:o}),r=!e.isEmptyObject(o),o.complete=a,o.delay&&i.delay(o.delay),r&&e.effects&&e.effects.effect[s]?i[t](o):s!==t&&i[s]?i[s](o.duration,o.easing,a):i.queue(function(n){e(this)[t](),a&&a.call(i[0]),n()})}})}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(e){var t=0;e.ajaxTransport("iframe",function(n){if(n.async){var i,o,a,r=n.initialIframeSrc||"javascript:false;";return{send:function(s,l){i=e('<form style="display:none;"></form>'),i.attr("accept-charset",n.formAcceptCharset),a=/\?/.test(n.url)?"&":"?","DELETE"===n.type?(n.url=n.url+a+"_method=DELETE",n.type="POST"):"PUT"===n.type?(n.url=n.url+a+"_method=PUT",n.type="POST"):"PATCH"===n.type&&(n.url=n.url+a+"_method=PATCH",n.type="POST"),t+=1,o=e('<iframe src="'+r+'" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,a=e.isArray(n.paramName)?n.paramName:[n.paramName];o.unbind("load").bind("load",function(){var t;try{if(t=o.contents(),!t.length||!t[0].firstChild)throw new Error}catch(n){t=void 0}l(200,"success",{iframe:t}),e('<iframe src="'+r+'"></iframe>').appendTo(i),window.setTimeout(function(){i.remove()},0)}),i.prop("target",o.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&e.each(n.formData,function(t,n){e('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(i)}),n.fileInput&&n.fileInput.length&&"POST"===n.type&&(t=n.fileInput.clone(),n.fileInput.after(function(e){return t[e]}),n.paramName&&n.fileInput.each(function(t){e(this).prop("name",a[t]||n.paramName)}),i.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),n.fileInput.removeAttr("form")),i.submit(),t&&t.length&&n.fileInput.each(function(n,i){var o=e(t[n]);e(i).prop("name",o.prop("name")).attr("form",o.attr("form")),o.replaceWith(i)})}),i.append(o).appendTo(document.body)},abort:function(){o&&o.unbind("load").prop("src",r),i&&i.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var n=t&&t[0];return n&&e.isXMLDoc(n)?n:e.parseXML(n.XMLDocument&&n.XMLDocument.xml||e(n.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),function(e){"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)}(function(e){e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file">').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){return t.isDefaultPrevented()?!1:void((n.autoUpload||n.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()}))},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var i=e-this.timestamp;return(!this.bitrate||!n||i>n)&&(this.bitrate=(t-this.loaded)*(1e3/i)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var i,o=Date.now?Date.now():(new Date).getTime();if(n._time&&n.progressInterval&&o-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=o,i=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=i-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(o,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=i,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(o,i,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,i=t.xhr?t.xhr():e.ajaxSettings.xhr();i.upload&&(e(i.upload).bind("progress",function(e){var i=e.originalEvent;e.lengthComputable=i.lengthComputable,e.loaded=i.loaded,e.total=i.total,n._onProgress(e,t)}),t.xhr=function(){return i})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var n,i=this,o=t.files[0],a=t.multipart||!e.support.xhrFileUpload,r="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),a&&!t.blob&&this._isInstanceOf("File",o)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(o.name)+'"'),a?e.support.xhrFormDataFileUpload&&(t.postMessage?(n=this._getFormData(t),t.blob?n.push({name:r,value:t.blob}):e.each(t.files,function(i,o){n.push({name:"array"===e.type(t.paramName)&&t.paramName[i]||r,value:o})})):(i._isInstanceOf("FormData",t.formData)?n=t.formData:(n=new FormData,e.each(this._getFormData(t),function(e,t){n.append(t.name,t.value)})),t.blob?n.append(r,t.blob,o.name):e.each(t.files,function(o,a){(i._isInstanceOf("File",a)||i._isInstanceOf("Blob",a))&&n.append("array"===e.type(t.paramName)&&t.paramName[o]||r,a,a.uploadName||a.name)})),t.data=n):(t.contentType=o.type||"application/octet-stream",t.data=t.blob||o),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var n=e(t.fileInput),i=t.paramName;return i?e.isArray(i)||(i=[i]):(i=[],n.each(function(){for(var t=e(this),n=t.prop("name")||"files[]",o=(t.prop("files")||[1]).length;o;)i.push(n),o-=1}),i.length||(i=[n.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,i){var o=e.Deferred(),a=o.promise();return n=n||this.options.context||a,t===!0?o.resolveWith(n,i):t===!1&&o.rejectWith(n,i),a.abort=o.promise,this._enhancePromise(a)},_addConvenienceMethods:function(t,n){var i=this,o=function(t){return e.Deferred().resolveWith(i,t).promise()};n.process=function(t,a){return(t||a)&&(n._processQueue=this._processQueue=(this._processQueue||o([this])).pipe(function(){return n.errorThrown?e.Deferred().rejectWith(i,[n]).promise():o(arguments)}).pipe(t,a)),this._processQueue||o([this])},n.submit=function(){return"pending"!==this.state()&&(n.jqXHR=this.jqXHR=i._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&i._onSend(t,this)),this.jqXHR||i._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",i._trigger("fail",null,this),i._getXHRPromise(!1))},n.state=function(){return this.jqXHR?i._getDeferredState(this.jqXHR):this._processQueue?i._getDeferredState(this._processQueue):void 0},n.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===i._getDeferredState(this._processQueue)},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),i=n&&n.length>1&&parseInt(n[1],10);return i&&i+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var i,o,a=this,r=t.files[0],s=r.size,l=t.uploadedBytes,c=t.maxChunkSize||s,d=this._blobSlice,u=e.Deferred(),h=u.promise();return this._isXHRUpload(t)&&d&&(l||s>c)&&!t.data?n?!0:l>=s?(r.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",r.error])):(o=function(){var n=e.extend({},t),h=n._progress.loaded;n.blob=d.call(r,l,l+c,r.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+l+"-"+(l+n.chunkSize-1)+"/"+s,a._initXHRData(n),a._initProgressListener(n),i=(a._trigger("chunksend",null,n)!==!1&&e.ajax(n)||a._getXHRPromise(!1,n.context)).done(function(i,r,c){l=a._getUploadedBytes(c)||l+n.chunkSize,h+n.chunkSize-n._progress.loaded&&a._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-n.uploadedBytes,total:l-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=l,n.result=i,n.textStatus=r,n.jqXHR=c,a._trigger("chunkdone",null,n),a._trigger("chunkalways",null,n),s>l?o():u.resolveWith(n.context,[i,r,c])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,a._trigger("chunkfail",null,n),a._trigger("chunkalways",null,n),u.rejectWith(n.context,[e,t,i])})},this._enhancePromise(h),h.abort=function(){return i.abort()},o(),h):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,i,o){var a=o._progress.total,r=o._response;o._progress.loaded<a&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:a,total:a}),o),r.result=o.result=t,r.textStatus=o.textStatus=n,r.jqXHR=o.jqXHR=i,this._trigger("done",null,o)},_onFail:function(e,t,n,i){var o=i._response;i.recalculateProgress&&(this._progress.loaded-=i._progress.loaded,this._progress.total-=i._progress.total),o.jqXHR=i.jqXHR=e,o.textStatus=i.textStatus=t,o.errorThrown=i.errorThrown=n,this._trigger("fail",null,i)},_onAlways:function(e,t,n,i){this._trigger("always",null,i)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var i,o,a,r,s=this,l=s._getAJAXSettings(n),c=function(){return s._sending+=1,l._bitrateTimer=new s._BitrateTimer,i=i||((o||s._trigger("send",e.Event("send",{delegatedEvent:t}),l)===!1)&&s._getXHRPromise(!1,l.context,o)||s._chunkedUpload(l)||e.ajax(l)).done(function(e,t,n){s._onDone(e,t,n,l)}).fail(function(e,t,n){s._onFail(e,t,n,l)}).always(function(e,t,n){if(s._onAlways(e,t,n,l),s._sending-=1,s._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>s._sending)for(var i=s._slots.shift();i;){if("pending"===s._getDeferredState(i)){i.resolve();break}i=s._slots.shift()}0===s._active&&s._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(a=e.Deferred(),this._slots.push(a),r=a.pipe(c)):(this._sequence=this._sequence.pipe(c,c),r=this._sequence),r.abort=function(){return o=[void 0,"abort","abort"],i?i.abort():(a&&a.rejectWith(l.context,o),c())},this._enhancePromise(r)):c()},_onAdd:function(t,n){var i,o,a,r,s=this,l=!0,c=e.extend({},this.options,n),d=n.files,u=d.length,h=c.limitMultiFileUploads,p=c.limitMultiFileUploadSize,f=c.limitMultiFileUploadSizeOverhead,m=0,v=this._getParamName(c),g=0;if(!p||u&&void 0!==d[0].size||(p=void 0),(c.singleFileUploads||h||p)&&this._isXHRUpload(c))if(c.singleFileUploads||p||!h)if(!c.singleFileUploads&&p)for(a=[],i=[],r=0;u>r;r+=1)m+=d[r].size+f,(r+1===u||m+d[r+1].size+f>p||h&&r+1-g>=h)&&(a.push(d.slice(g,r+1)),o=v.slice(g,r+1),o.length||(o=v),i.push(o),g=r+1,m=0);else i=v;else for(a=[],i=[],r=0;u>r;r+=h)a.push(d.slice(r,r+h)),o=v.slice(r,r+h),o.length||(o=v),i.push(o);else a=[d],i=[v];return n.originalFiles=d,e.each(a||d,function(o,r){var c=e.extend({},n);return c.files=a?r:[r],c.paramName=i[o],s._initResponseObject(c),s._initProgressObject(c),s._addConvenienceMethods(t,c),l=s._trigger("add",e.Event("add",{delegatedEvent:t}),c)}),l},_replaceFileInput:function(t){var n=t.clone(!0);e("<form></form>").append(n)[0].reset(),t.after(n).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,i){return i===t[0]?n[0]:i}),t[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(t,n){var i,o=this,a=e.Deferred(),r=function(e){e&&!e.entry&&(e.entry=t),a.resolve([e])};return n=n||"",t.isFile?t._file?(t._file.relativePath=n,a.resolve(t._file)):t.file(function(e){e.relativePath=n,a.resolve(e)},r):t.isDirectory?(i=t.createReader(),i.readEntries(function(e){o._handleFileTreeEntries(e,n+t.name+"/").done(function(e){a.resolve(e)}).fail(r)},r)):a.resolve([]),a.promise()},_handleFileTreeEntries:function(t,n){var i=this;return e.when.apply(e,e.map(t,function(e){return i._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n,i,o=t.prop("webkitEntries")||t.prop("entries");if(o&&o.length)return this._handleFileTreeEntries(o);if(n=e.makeArray(t.prop("files")),n.length)void 0===n[0].name&&n[0].fileName&&e.each(n,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(i=t.prop("value"),!i)return e.Deferred().resolve([]).promise();n=[{name:i.replace(/^.*\\/,"")}]}return e.Deferred().resolve(n).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,i={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(o){i.files=o,n.options.replaceFileInput&&n._replaceFileInput(i.fileInput),n._trigger("change",e.Event("change",{delegatedEvent:t}),i)!==!1&&n._onAdd(t,i)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,i={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&i.files.push(n)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),i)!==!1&&this._onAdd(t,i))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,i=t.dataTransfer,o={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){o.files=i,n._trigger("drop",e.Event("drop",{delegatedEvent:t}),o)!==!1&&n._onAdd(t,o)}))},_onDragOver:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=t.dataTransfer;n&&-1!==e.inArray("Files",n.types)&&this._trigger("dragover",e.Event("dragover",{delegatedEvent:t}))!==!1&&(t.preventDefault(),n.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,n){var i=-1!==e.inArray(t,this._specialOptions);i&&this._destroyEventHandlers(),this._super(t,n),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return"url"!==t&&"string"===e.type(n)&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,i=e(this.element[0].cloneNode(!1));e.each(i.data(),function(e,o){var a="data-"+e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();i.attr(a)&&(t._isRegExpOption(e,o)&&(o=t._getRegExp(o)),n[e]=o)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n,i,o=this,a=e.Deferred(),r=a.promise();return r.abort=function(){return i=!0,n?n.abort():(a.reject(null,"abort","abort"),r)},this._getFileInputFiles(t.fileInput).always(function(e){if(!i){if(!e.length)return void a.reject();t.files=e,n=o._onSend(null,t).then(function(e,t,n){a.resolve(e,t,n)},function(e,t,n){a.reject(e,t,n)})}}),this._enhancePromise(r)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})
}),function(){this.kp={},this.kp.debug=!1}.call(this),kp.config=function(){return{add:function(e){var t;for(t in e)if(e.hasOwnProperty(t)){if(kp.config.hasOwnProperty(t))throw new Error("Attempting to clobber existing kp.config."+t);kp.config[t]=e[t]}},set:function(e){var t;for(t in e)if(e.hasOwnProperty(t)){if("set"===t||"add"===t||"has"===t)throw new Error("Attempting to clobber kp.config."+t);kp.config[t]=e[t]}},has:function(e){return kp.config.hasOwnProperty(e)}}}(),kp.config.validation=function(){return{product_title:{filters:["html"],constraints:{minLength:3,maxLength:250},messages:{minLength:"Sorry, your title must be longer than 3 characters.",maxLength:"Sorry, your title cannot be longer than 250 characters."}},product_description:{filters:["html"],constraints:{maxLength:500},messages:{maxLength:"Sorry, your comment cannot be longer than 500 characters."}},collection_title:{filters:["html"],constraints:{minLength:1,maxLength:60},messages:{minLength:"Collection can't be blank",maxLength:"Sorry, your collection cannot be longer than 60 characters."}}}}(),kp.config.set({debug:!1,facebook_app_id:"",enable_image_polling:!0,enable_price_polling:!0,enable_error_send:!1,disable_tracking:!1}),kp.browser=function(){function e(){var e;for(e in i)i.hasOwnProperty(e)&&(n[e]=i[e]());t()}function t(){$("html").addClass(n.touch?"touch":"no-touch")}var n={},i=[];return i.touch=function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?!0:!1},i.cssTransitions=function(){var e=document.body;return void 0!==e.style.webkitTransition?"webkit":void 0!==e.style.MozTransition?"moz":void 0!==e.style.msTransition?"ms":void 0!==e.style.OTransition?"o":!1},e(),n}(),function(){var e=window.location,t=window.history,n=!(!t||!t.pushState),i=/^\/+|\/+$/g;kp.Router=function(t){this.routes=[],this.lastUrl=e.href,_.each(t,function(e){this.addRoute(e)},this)},_.extend(kp.Router.prototype,Backbone.Events,{start:function(){_.bindAll(this,"checkUrl"),n&&$(window).on("popstate",this.checkUrl),this.dispatch(this.getUrl())},checkUrl:function(){e.href!==this.lastUrl&&(this.trigger("historyChange",this.lastUrl,e.href),this.trigger("navigate",this.lastUrl,e.href),this.lastUrl=e.href,this.dispatch(this.getUrl()))},getUrl:function(){var t=e.pathname;return t=t.replace("//","/"),t=t.replace(i,"/")},dispatch:function(e){var t=!!_.find(this.routes,function(t){var n=e.match(t.urlRe);return n?(this.trigger("route",t.route,n.slice(1)),!0):void 0},this);return t||this.trigger("route_miss",e),t},navigate:function(i,o){return o||(o={}),n?(t[o.replace?"replaceState":"pushState"]({},document.title,i),this.lastUrl=e.href,this.trigger("navigate",this.lastUrl,i),void _gaq.push(["_trackPageview"])):void e.assign(i)},addRoute:function(e){this.routes.push({urlRe:new RegExp(e.url,"i"),route:e})}})}(),function(){kp.PageSession=function(){this.stack=[],this.currentIdx=-1},_.extend(kp.PageSession.prototype,Backbone.Events,{start:function(){this.listenTo(kp.router,"route",this.onRoute),this.listenTo(kp.router,"historyChange",this.historyChange)},garbageCollectViews:function(){var e=this.currentIdx+1,t=this.stack.splice(e);_.each(t,function(e){e.view.trigger("session.remove",this.currentIdx)},this)},add:function(e){this.currentIdx<this.stack.length-1&&this.garbageCollectViews(),this.currentIdx+=1,this.currentIdx>1&&this.stack[this.currentIdx-1].view.trigger("session.hide",this.currentIdx),this.stack.push({view:e,url:window.location.href,title:document.title})},historyChange:function(e,t){var n,i=_.find(this.stack,function(e){return e.url===t});return i?(n=this.stack[this.currentIdx],this.currentIdx>=1&&this.stack[this.currentIdx-1].url===t?(this.currentIdx-=1,n.view.trigger("session.hide",this.currentIdx)):this.stack[this.currentIdx+1]&&this.stack[this.currentIdx+1].url===t&&(this.currentIdx+=1,1!==this.currentIdx&&n.view.trigger("session.hide")),0!==this.currentIdx&&this.stack[this.currentIdx].view.trigger("session.show",this.currentIdx),void(document.title=this.stack[this.currentIdx].title)):void window.location.assign(t)},goToStackIndex:function(e){var t=e-this.currentIdx;this.currentIdx=e,window.history.go(t),0>t&&this.garbageCollectViews()}})}(),kp.animate=function(){function e(){a=t()}function t(){var e;if(!kp.browser.cssTransitions)return!1;switch(e=function(e,t){return"translate("+e+"px, "+t+"px)"},kp.browser.cssTransitions){case"webkit":return{transition:"-webkit-transition",transform:"-webkit-transform",translate:function(e,t){return"translate3d("+e+"px, "+t+"px, 0px)"}};case"moz":return{transition:"-moz-transition",transform:"-moz-transform",translate:e};case"ms":return{transition:"-ms-transition",transform:"-ms-transform",translate:e};case"o":return{transition:"-o-transition",transform:"-o-transform",translate:e}}}var n,i,o,a={},r={};return n={xDist:void 0,yDist:void 0,time:.4,easing:"ease",marginOffset:0},r.translate=function(e,t){var i,o,r,s;i=$(e),o=$.extend({},n,t),r={},kp.browser.cssTransitions?i.css(a.transition,a.transform+" "+o.time+"s "+o.easing).css(a.transform,a.translate(o.xDist||0,o.yDist||0)):(s=1e3*o.time,o.xDist&&(r["margin-left"]=o.xDist+o.marginOffset),o.yDist&&(r["margin-top"]=o.yDist+o.marginOffset),i.animate(r,s))},i={delay:0,time:.6,easing:"ease",remove:!0},r.fadeOut=function(e,t){var n,o,r,s;if(n=$(e),o=$.extend({},i,t),r={},kp.browser.cssTransitions?n.css(a.transition,"opacity "+o.time+"s "+o.easing+" "+o.delay+"s").css("opacity","0"):(s=1e3*o.time,n.delay(o.delay).animate({opacity:0},s)),o.remove){var l=1e3*o.time+1e3*o.delay;setTimeout(function(){n.remove()},l)}},o={scrollEl:"html, body",delay:0,time:400},r.scrollTo=function(e,t){var n,i,a;n=e,i=$.extend({},o,t),a=n.offset().top-10+"px",$(i.scrollEl).delay(i.delay).animate({scrollTop:a},i.time)},e(),r}(),kp.util=function(e){var t=!1,n={currIntervalId:0,intervals:[]},i=[];return{setupCSRF:function(){$.ajaxSetup({beforeSend:function(e,t){var n=$("meta[name=csrf]").attr("content");/^(POST|PUT|DELETE)$/.test(t.type)&&e.setRequestHeader("X-CSRFToken",n)}})},setupErrorHandling:function(){var n,i,o,a;kp.config.enable_error_send&&(t||(n=e.onerror,e.onerror=function(e,t,r){return(i!==e||o!==t||a!==r)&&kp.track.error("global_js:error",{message:e,url:t,line:r}),n?n(e,t,r):!1},$(document).ajaxError(function(e,t,n){kp.track.error("global_js:ajax-error:"+n.url,{})})))},scriptLoad:function(e){var t,n,o;return i[e]||(t=i[e]=$.Deferred(),n=document.createElement("script"),n.type="text/javascript",n.async=!0,n.readyState?n.onreadystatechange=function(){("loaded"===n.readyState||"complete"===n.readyState)&&(n.onreadystatechange=null,t.resolve())}:n.onload=function(){t.resolve()},n.src=e,o=document.getElementsByTagName("script")[0],o.parentNode.insertBefore(n,o)),i[e].promise()},setBackoffInterval:function(e,t,i){var o;n.currIntervalId+=1,o={id:n.currIntervalId,func:e,iterations:t,currTimeoutId:0,isComplete:!1},n.intervals.push(o);var a=function(){if(!o.isComplete){var t=o.iterations.splice(0,1)[0];if(!t)return i&&i.call(),void kp.util.killBackoffInterval(o.id);var n=setTimeout(function(){o.isComplete||(o.currTimeoutId=n,e.call(),a())},t)}};return a(),o.id},killBackoffInterval:function(e){var t=n.intervals;$.each(t,function(n,i){i.id===e&&(i.currTimeoutId&&(i.isComplete=!0,clearTimeout(i.currTimeoutId)),t.splice(n,1))})},typeOf:function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},setCookie:function(e,t,n){var i,o="";n&&(i=new Date,i.setTime(i.getTime()+n),o="; expires="+i.toGMTString()),document.cookie=e+"="+t+o+"; path=/; domain=."+document.domain+";"},getCookie:function(e){var t,n,i=e+"=",o=document.cookie.split(";");for(t=0;t<o.length;t++){for(n=o[t];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(i))return n.substring(i.length,n.length)}return null},deleteCookie:function(e){kp.util.setCookie(e,"",-1)},disableFormOnSubmit:function(e){e.on("submit",function(t){return e.data("is_submitting")?void t.preventDefault():(e.data("is_submitting","1"),void e.find("button, input[type=submit]").attr("disabled","disabled"))})},enableForm:function(e){e.removeData("is_submitting"),e.find("button, input[type=submit]").removeAttr("disabled")},isFormSubmitting:function(e){return e.data("is_submitting")},getSecondsSinceObjectCreated:function(e,t){t||(t=new Date);var n=this.getObjectCreatedDate(e);return(t-n)/1e3},getObjectCreatedDate:function(e){var t=129384e7,n=Number(e).toString(2),i=n.length-23,o=n.slice(0,i),a=parseInt(o,2),r=t+a;return new Date(r)},showInputError:function(e,t){e.addClass("error").next(".input-error").text(t).addClass("show")},formatPhone:function(e){var t=e.currentTarget;8!==e.which&&46!==e.which&&37!==e.which&&39!==e.which&&(t.value=t.value.replace(/^\(?([0-9][0-9][0-9])+(?!\))/,"($1) "),t.value=t.value.replace(/\)+? ?([0-9][0-9][0-9]){1}$/,") $1-"),t.value=t.value.replace(/\)+? ?([0-9][0-9][0-9])+([0-9]){1}$/,") $1-$2"))},endsWith:function(e,t){return-1!==e.indexOf(t,e.length-t.length)}}}(window),kp.track=function(){function e(e,n,i,o){if(i!==new Object(i))throw new Error("Data argument must be an object");var a;i.type=e,a=JSON.stringify({subject:n,data:i}),o?t(a,o):setTimeout(function(){t(a,o)},1)}function t(e,t){$.ajax({url:"/service/1.0/event/track",type:"POST",contentType:"application/json",data:e,async:!t})}return{info:function(t,n,i){n=n||{},e.apply(this,["info",t,n,i])},counter:function(t,n){e.apply(this,["counter",t,{},n])},error:function(t,n,i){n=n||{},n.hasOwnProperty("url")||(n.url=window.location.href),e.apply(this,["error",t,n,i])}}}(),function(){kp.IOS=Backbone.View.extend({id:"ios-open",tpl:'<a href="keep://<%= route %>">View in Keep App</a>',initialize:function(){var e=$("meta[name=apple-itunes-app]"),t=e.attr("content"),n=t.match(/app-id=(\d+).*.keep:\/\/(.*)/);if(this.template=_.template(this.tpl),this.$body=$("body"),this.appId=n[1],!this.appId)throw new Error("ios app-id missing");this.render(n[2])},render:function(e){this.$el.html(this.template({route:e}))}}),kp.IOS.hasSupport=function(){return null!==navigator.userAgent.match(/(iPad|iPhone|iPod touch)/i)}}(),kp.facebook=function(){function e(){return n||(n=$.Deferred(),kp.util.scriptLoad("//connect.facebook.net/en_US/all.js").done(function(){t(),FB.getLoginStatus(function(e){"connected"===e.status?n.resolve():(n.reject(),kp.trigger("facebook.failedToLogin"))})})),n.promise()}function t(){var e=location.protocol+"//"+location.host;FB.init({appId:kp.config.facebook_app_id,channelUrl:e+"/facebook_channel",frictionlessRequests:!0,status:!0,cookie:!0,xfbml:!0,oauth:!0})}var n;return{init:e}}(),kp.analytics=function(e,t){function n(){var t,n,i,o=[],a=e.createDocumentFragment();if(!kp.config.disable_tracking&&o.length){for(t=0,n=o.length;n>t;t++)i=e.createElement("img"),i.setAttribute("width","1"),i.setAttribute("height","1"),i.setAttribute("alt","track"),i.style.visibility="hidden",i.src=o[t],a.appendChild(i);e.body.appendChild(a)}}function i(){kp.config.disable_tracking||(t.ap_param={pid:210478},kp.util.scriptLoad("//event.adparlour.com/js/ap.js"))}function o(){kp.config.disable_tracking||(t.google_conversion_id=959407248,t.google_conversion_language="en",t.google_conversion_format="3",t.google_conversion_color="ffffff",t.google_conversion_label="84m6COjo-yAQkMm9yQM",t.google_conversion_value=0,kp.util.scriptLoad("//www.googleadservices.com/pagead/conversion.js"))}function a(){s([["track","6019105471651",{value:"0.01",currency:"USD"}],["track","6008245822986",{value:"0.01",currency:"USD"}]])}function r(){s([["addPixelId","754598177938616"],["track","PixelInitialized",{}]])}function s(e){t._fbq=t._fbq||[],_.each(e,function(e){t._fbq.push(e)}),kp.config.disable_tracking||kp.util.scriptLoad("//connect.facebook.net/en_US/fbds.js")}return{setupTracking:n,trackGoogleAdConversion:o,trackFacebookSignupConversion:a,trackFacebookRetargeting:r,trackAdParlour:i}}(document,window),function(e){var t=200,n=function(t){this.$el=e(t),this.init()};n.prototype={constructor:n,init:function(){_.bindAll(this),this.$parentEl=this.$el.parent(),this.$menuEl=this.$el.siblings(".dropdown-menu"),this.targetElStatus="off",this.menuElStatus="off",kp.browser.touch?this.addTouchEvents():this.addMouseEvents()},addTouchEvents:function(){this.$el.on("touchend",this.toggleMenu),this.$el.on("touchstart",function(e){e.preventDefault()})},addMouseEvents:function(){this.$el.on("mouseenter",this.onEnterTargetEl),this.$el.on("mouseleave",this.onLeaveTargetEl),this.$menuEl.on("mouseenter",this.onEnterMenuEl),this.$menuEl.on("mouseleave",this.onLeaveMenuEl)},onEnterTargetEl:function(){"on"!==this.menuElStatus&&(this.menuElStatus="off",this.targetElStatus="on",this.showMenu())},onLeaveTargetEl:function(){this.targetElStatus="off",setTimeout(this.testAndHideHover,t)},onEnterMenuEl:function(){this.menuElStatus="on"},onLeaveMenuEl:function(){this.menuElStatus="off",setTimeout(this.testAndHideHover,t)},testAndHideHover:function(){"off"===this.targetElStatus&&"off"===this.menuElStatus&&this.hideMenu()},toggleMenu:function(){var e=this.$parentEl.hasClass("open");e?this.hideMenu():this.showMenu()},showMenu:function(){var e;if(!this.$el.is(".disabled, :disabled"))return e=this.$parentEl.hasClass("open"),e||this.$parentEl.addClass("open"),!1},hideMenu:function(){this.$parentEl.removeClass("open"),this.$el.blur(),this.$parentEl.blur()}},e.fn.dropdown=function(){return this.each(function(){var t=e(this);return new n(t)})},e.fn.dropdown.Constructor=n}(window.jQuery),kp.carousel=function(){function e(e,n){this.parentEl=e,this.gesture={},this.options=$.extend({},t,n),_.bindAll(this,"_nextPage","_prevPage","_onResize"),this._setup()}var t={contSel:".carousel-cont",maskSel:".carousel-mask",prevBtnSel:".carousel-prev_btn",nextBtnSel:".carousel-next_btn",thumbSel:".thumb",thumbWidth:100,thumbGutterX:10,transitionSpeed:500,shiftToActive:!1},n=.35,i=15,o=$(window);return _.extend(e.prototype,{_setup:function(){var e=this.options,t=this.parentEl;this.contEl=$(t.find(e.contSel)),this.maskEl=$(t.find(e.maskSel)),this.thumbEls=$(t.find(e.thumbSel)),this.numThumbs=this.thumbEls.length,this.thumbShift=this.options.thumbWidth+this.options.thumbGutterX,this.curShift=0,this.curIndex=0,this._computeMaskWidth(),this._computeThumbsPerMask(),this._setupNavigation(),this._showHideNav(),kp.browser.touch&&this.contEl.on("touchstart",this._touchStart),this.contWidth=0,o.on("resize.carousel",_.debounce(this._onResize,300)),this._onResize(),this.options.shiftToActive===!0&&this.shiftToActive()},_setupNavigation:function(){this.parentEl.append('<a class="carousel-nav carousel-prev_btn">‹</a><a class="carousel-nav carousel-next_btn">›</a>'),this.prevBtnEl=$(this.parentEl.find(this.options.prevBtnSel)),this.nextBtnEl=$(this.parentEl.find(this.options.nextBtnSel)),this.parentEl.on("click",".carousel-next_btn",this._nextPage),this.parentEl.on("click",".carousel-prev_btn",this._prevPage)},_touchStart:function(e){this.gesture.startTime=new Date,this.gesture.xstart=e.originalEvent.touches[0].pageX,this.gesture.ystart=e.originalEvent.touches[0].pageY,this.gesture.moved=!1,this.contEl.on("touchmove",this._touchMove),this.contEl.on("touchend",this._touchEnd)},_touchMove:function(e){var t,o;if(this.gesture.lastX=e.originalEvent.touches[0].pageX,this.gesture.lastY=e.originalEvent.touches[0].pageY,this.gesture.xd=this.gesture.lastX-this.gesture.xstart,this.gesture.yd=this.gesture.lastY-this.gesture.ystart,!this.gesture.moved&&Math.abs(this.gesture.xd)>=i)this.gesture.moved=!0;else{if(!this.gesture.moved&&Math.abs(this.gesture.yd)>=i)return this.cancelGesture();this.gesture.moved&&(e.originalEvent.preventDefault(),e.originalEvent.stopPropagation())}if(o=!(0===this.curIndex&&this.gesture.xd>0||this.curIndex+this.numThumbsPerMask>=this.numThumbs&&this.gesture.xd<0))t=this.curShift+this.gesture.xd,kp.animate.translate(this.contEl,{xDist:t,time:0});else{var a=this.gesture.xd*n;t=this.curShift+a,kp.animate.translate(this.contEl,{xDist:t,time:0})}return this.gesture.moved?!1:void 0},_touchEnd:function(e){var t,n;return this.gesture.endTime=new Date,this.contEl.off("touchmove",this._touchMove),this.contEl.off("touchend",this._touchEnd),this.gesture.moved===!0?(this.contEl.css("pointer-events","none"),e.originalEvent.preventDefault(),e.preventDefault(),t=this.gesture.lastX<this.gesture.xstart-40,n=this.gesture.lastX>this.gesture.xstart+40,t?this._nextPage():n?this._prevPage():kp.animate.translate(this.contEl,{xDist:this.curShift,time:.4}),this.returnTouch()):(e.originalEvent.preventDefault(),e.preventDefault(),!1)},returnTouch:function(){var e=this;setTimeout(function(){e.contEl.css("pointer-events","")},50)},cancelGesture:function(){this.contEl.off("touchmove",this._touchMove),this.contEl.off("touchend",this._touchEnd)},remove:function(){this.contEl.stop(),this.prevBtnEl.remove(),this.nextBtnEl.remove(),this.parentEl.off(),this.contEl.off()},_showHideNav:function(){this.numThumbs<this.numThumbsPerMask&&(this.prevBtnEl.addClass("hide"),this.nextBtnEl.addClass("hide")),0===this.curIndex?this.prevBtnEl.addClass("hide"):this.prevBtnEl.removeClass("hide"),this.curIndex+this.numThumbsPerMask<this.numThumbs?this.nextBtnEl.removeClass("hide"):this.nextBtnEl.addClass("hide")},_nextPage:function(){var e=this.thumbShift*this._getShiftSteps("next"),t=this.curShift-e;this._animateTo(t)},_prevPage:function(){var e=this.thumbShift*this._getShiftSteps("prev"),t=this.curShift+e;this._animateTo(t)},_animateTo:function(e,t){this.curShift=e,this.curIndex=-(this.curShift/this.thumbShift),kp.animate.translate(this.contEl,{xDist:e,time:t}),this._showHideNav()},_getShiftSteps:function(e){var t,n,i=this.numThumbsPerMask;return n="next"===e?this.numThumbs-this.curIndex-this.numThumbsPerMask:this.curIndex,t=i>n&&n>=0?n:i>n?0:i},_onResize:function(){this._computeMaskWidth(),this._computeThumbsPerMask(),this._showHideNav()},_computeMaskWidth:function(){this.contWidth=this.maskEl.width()},_computeThumbsPerMask:function(){var e=this.options;this.numThumbsPerMask=Math.floor((this.contWidth+e.thumbGutterX)/(e.thumbWidth+e.thumbGutterX))},shiftToActive:function(){var e,t=this.options.thumbWidth+this.options.thumbGutterX,n=null;this.numThumbs<this.numThumbsPerMask||(this.thumbEls.each(function(e,t){null===n&&$(t).hasClass("active")&&(n=e)}),this.numThumbs-n>this.numThumbsPerMask?(e=-t*n,this._animateTo(e,0),this._showHideNav()):n>=this.numThumbsPerMask&&(e=-t*(n-this.numThumbsPerMask+1),this._animateTo(e,0),this._showHideNav()))}}),function(t,n){return new e(t,n)}}(),kp.form={},kp.form.modelform=function(){var e=function(e){var t=this;t.$el=e,t.name=e.attr("name"),t.ajaxURL=e.data("ajax-url"),t.validator=null,t.messages={},t._cache={},t.onChangeHandler=function(){},t.listener()};e.prototype.val=function(){var e;return e=$.trim(this.$el.val())},e.prototype.rules=function(e,t){this.validator=kp.form.validator(e),$.extend(this.messages,t)},e.prototype.errors=function(){var e=_.keys(this.validator._errors);return _.pick(this.messages,e)},e.prototype.cache=function(e,t){var n=this;n._cache[e]=t},e.prototype.clientValidation=function(){var e=this,t=e.val(),n=e.validator.validate(t);return{valid:n,msg:e.errors.apply(e)}},e.prototype.serverValidation=function(e){var t=this;if(t.ajaxURL){var n,i=t.name,o=t.val(),a={};a[i]=o;var r={cache:!1,data:a,dataType:"json",type:"post",url:t.ajaxURL};return n=$.extend({},r,e),$.ajax(n)}},e.prototype.done=function(e,t,n){var i=this;i.cache(e,t),i.onChangeHandler(i.$el,t,n)},e.prototype.validate=function(e){e=e||!1;var t=this,n=t.val();if(_.has(t._cache,n)){var i=t._cache[n];t.onChangeHandler(t.$el,i,e)}else{var o=t.clientValidation();!1!==o.valid&&t.ajaxURL?$.when(t.serverValidation()).always(function(i){t.done(n,i,e)}):t.done(n,o,e)}},e.prototype.listener=function(){var e=this,t=_.debounce(e.validate,300);e.$el.on({focusin:function(){e.validator._hasValidated&&e.$el.on("keyup keydown",$.proxy(t,e,!1))},focusout:function(){e.validate(!1)}})};var t=function(){this.onComplete=function(){},this.onChangeHandler=function(){},this.fields=[],this.totalFields=0,this.validFields={}},n=function(n,i){var o,a=new t;window.navigator.userAgent.match(/msie /i)&&n.find("label").css("display","block"),o=n.find("button[type=submit]:disabled"),n.on("keyup",function(e){var t=n.find("button[type=submit]:disabled").length;13===e.keyCode&&t===!1&&(e.stopPropagation(),e.preventDefault())});var r=_.debounce(a.validateAll,300);return a.totalFields=i.length,_.each(i,function(t){var i=$(t),o=i.attr("name"),s=new e(i);s.onChangeHandler=function(e,t,i){var o,r=n.find("button[type=submit]"),s=e.attr("name"),l={};l.element=e,l.results=t,l.background=i,o=$.extend({},l),o.results.valid?a.validFields[s]=!0:delete a.validFields[s],_.size(a.validFields)===a.totalFields?r.removeAttr("disabled"):r.attr("disabled","disabled"),a.onChangeHandler.apply(this,_.values(o))},s.$el.on("keyup keydown",$.proxy(r,a,!0)),a[o]=s,a.fields.push(s)}),a};return t.prototype.validateAll=function(e){var t=this;$.each(this.fields,function(n,i){var o,a;return o=!i.validator._hasValidated,a=!i.$el.is(":focus"),o&&a&&t.totalFields>1?!1:void i.validate(e)})},n}(),kp.form.sanitize=function(){var e={};return e._trim=$.trim,e._html=function(t){return t.length?(t=t.replace(/<[^>]*?>/g,""),t=t.replace(/[<>]/g,""),e._trim(t)):""},e._titleCase=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},e._regex=function(e,t){var n=t.replaceStr||"";return e.replace(t.mask,n)},e._price=function(e){var t,n;return e&&e.length?(e=e.replace(/[^\d\.]/g,""),-1!==e.indexOf(".")&&(t=e.split("."),t.length>2&&(n=t.pop(),e=t.join("")+"."+n)),e=0+e,e=parseFloat(e),e=Math.round(100*e*100)/100):0},function(t,n){var i,o,a=n.length;for(i=0;a>i;i++)"object"==typeof n[i]?(o="_"+n[i].filter,t=e[o](t,n[i])):(o="_"+n[i],t=e[o](t));return t}}(),kp.form.validator=function(){var e=function(){this._hasValidated=!1,this._usedValidators={},this._errors={}},t=function(t){var n=new e;return _.each(t,function(e,t){n.validators.hasOwnProperty(t)&&(n._usedValidators[t]=n.validators[t](e))}),n};return e.prototype.validate=function(e){var t={};return _.each(this._usedValidators,function(n,i){var o=n(e);!1===o&&(t[i]=!0)}),this._errors=t,this._hasValidated=!0,!_.size(t)},e.prototype.errors=function(){return this._errors},e.prototype.validators={minLength:function(e){return function(t){return t.length>=e}},maxLength:function(e){return function(t){return t.length<=e}},required:function(e){return function(t){return!0===e?!!t:!0}},noHTML:function(){return function(e){return null===e.match(/[<>]/)}},regex:function(e){return function(t){return null!==t.match(e)}}},t}(),kp.form.placeholderPolyfill=function(){function e(e){return r?!0:void 0===r&&(r="placeholder"in document.createElement("input"))?!0:(e||(e=$("body")),e.find("input[placeholder], textarea[placeholder]").on("focus",n).on("blur",i).filter(function(){return""===this.value}).each(function(){o($(this))}),!1)}function t(e){r||void 0===r||(e||(e=$("body")),e.find("input[placeholder], textarea[placeholder]").off("focus",n).off("blur",i))}function n(){var e=$(this);e.removeClass(s),e.hasClass("polyfill-password")&&e.attr("type","password"),this.value===e.attr("placeholder")&&(this.value="")}function i(){var e=$(this);""===this.value&&o(e)}function o(e){"password"===e.attr("type")&&(e.attr("type","text"),e.addClass("polyfill-password")),e.addClass(s),e.val(e.attr("placeholder"))}function a(e){return e.val()===e.attr("placeholder")}var r,s="placeholder-enabled";return{init:e,remove:t,isElEmpty:a,resetEl:o}}(),kp.image={},kp.image.pollForImageReady=function(){function e(){}function t(){n()}function n(){var e=$(".poll-for-img-ready"),t=[];kp.config.enable_image_polling&&e.length&&(i&&kp.util.killBackoffInterval(i),e.each(function(){var e=$(this);t.push({id:e.data("id"),size:e.data("img-size")})}),i=kp.util.setBackoffInterval(function(){$.ajax("/service/1.0/image/is_ready_for_prime_time",{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({bundles:t})}).done(function(t){t&&t.length&&($.each(t,function(t,n){var i,o,a=e.filter("[data-id="+n.id+"][data-img-size="+n.size+"]");a.empty(),n.size.indexOf("hex")?(o="main_hex"===n.size?{url:n.details.url,width:112,height:130,path:"56,0 112,32 112,97 56,130 0,97 0,32"}:{url:n.details.url,width:26,height:30,path:"13,0 26,7 26,22 13,30 0,22 0,7"},i=_.template('<svg class="avatar" width="<%= width %>" height="<%= height %>" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><g><clipPath id="irfpt-mask-<%= url %>"><polygon points="<%= path %>" /></clipPath></g><image clip-path="url(#irfpt-mask-<%= url %>)" width="<%= width %>" height="<%= height %>" xlink:href="<%= url %>" preserveAspectRatio="xMidYMin slice" /></svg>',o)):i='<img src="'+n.details.url+'" width="'+n.details.width+'" height="'+n.details.height+'">',$(i).appendTo(a),a.removeClass(".poll-for-img-ready")}),kp.util.killBackoffInterval(i))}).error(function(){kp.util.killBackoffInterval(i)})},[1e3,2e3,4e3,8e3,16e3,32e3],function(){kp.config.enable_image_polling=!1}))}var i;return{init:e,scan:t}}(),kp.price={},kp.price.pollForPrice=function(){function e(){}function t(){n()}function n(){var e=$(".k_actions_number_buttons .buy"),t=e.parent(".round_button").find(".count_int"),n=e.parents(".k_desc").data("id");kp.config.enable_price_polling&&n&&(i&&kp.util.killBackoffInterval(i),i=kp.util.setBackoffInterval(function(){$.ajax("/service/1.0/price/is_ready_for_price",{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({id:n.toString()})}).done(function(n){n&&n.rounded_dollars&&(n.available===!0||n.available===!1)&&(n.available===!1?(e.text("View"),t.html("Out of Stock")):n.rounded_dollars?(e.text("Buy"),t.find(".count_int").html(n.rounded_dollars)):(e.text("Buy"),t.html("")),kp.util.killBackoffInterval(i))}).error(function(){kp.util.killBackoffInterval(i)})},[1e3,2e3,4e3,8e3,16e3,32e3],function(){kp.config.enable_price_polling=!1}))}var i;return{init:e,scan:t}}(),kp.flashMessage=function(){function e(e,t){var n=e+t;if(n!==l)return l=n,a||(a=_.template(s)),a({level:e,message:t})}function t(t,i){var a;o||(o=$("#flashes")),a=$(e(t,i)),o.append(a),_.delay(function(){a.addClass("show")},10),_.delay(n,r,a)}function n(e){l=null,kp.animate.fadeOut(e)}function i(e){var t=$(".alert");e||(e=r),t.length&&(_.delay(function(){t.addClass("show")},10),setTimeout(function(){t.each(function(){n($(this))})},e))}var o,a,r=7e3,s='<div class="alert alert-<%= level %>"><a class="icon-close" data-dismiss="alert">&times;</a><%= message %></div>',l=null;return{initAll:i,success:function(e){t("success",e)},info:function(e){t("info",e)},error:function(e){t("error",e)}}}(),function(){var e=$(window),t=$(document),n=window.requestAnimationFrame,i={url:"./",totalPages:null,bufferPx:1e3,paginationSel:null,queryOpt:"infs=1",onContentLoaded:null,onStop:null};kp.infiniteScroll=Backbone.View.extend({isLoading:!1,winHeight:0,docHeight:0,currPage:void 0,totalPages:void 0,ticking:!1,initialize:function(e){if(this.options=$.extend(this.options,i,e),!this.options.el)throw new Error("existing el must be provided");_.bindAll(this,"_onScroll","_update","_onPageFetch"),this.currPage=1,this.totalPages=this.el.getAttribute("data-num_pages")||null,this._computeWinHeight(),this.docHeight=t.height(),this.options.paginationSel&&$(this.options.paginationSel).remove(),this.start()},start:function(){var t=kp.browser.touch?"touchmove":"scroll";e.on(t+".infinitescroll"+this.cid,this._onScroll),e.on("resize.infinitescroll"+this.cid,_.debounce(this._computeWinHeight,300))},stop:function(){e.off(".infinitescroll"+this.cid),this.options.onStop&&this.options.onStop.call()},_computeWinHeight:function(){this.winHeight=e.height()},_onScroll:function(){this.ticking||(this.ticking=!0,n(this._update))},_update:function(){!this.isLoading&&-1!==this.totalPages&&this.currPage>=this.totalPages?this.stop():!this.isLoading&&this._isNearBottom()&&(this.isLoading=!0,this.currPage+=1,this._fetchPage(this.currPage).done(this._onPageFetch)),this.ticking=!1},_onPageFetch:function(e){var i;return e?void n(_.bind(function(){i=$($.parseHTML(e)),this.$el.append(i),this.options.onContentLoaded&&this.options.onContentLoaded.call(void 0,i),this.docHeight=t.height(),this.isLoading=!1},this)):(this.stop(),void(this.isLoading=!1))},_fetchPage:function(e){var t=this.options.url+e+"?"+this.options.queryOpt,n=document.location.search;return n&&(t+="&"+n.substr(1)),"/"===this.options.url&&_gaq.push(["_trackEvent","Trending","grid_scroll","Page "+e]),$.ajax(t,{type:"GET",dataType:"html"})},_isNearBottom:function(){return this.docHeight-window.pageYOffset-this.winHeight<this.options.bufferPx}})}(),kp.postGrid=function(e){function t(t){e=$.extend({},k,t),d=_.uniqueId("g"),u=e.parentEl,p=e.itemWidth,f=225===p?160:150,h=e.offset,m.on("resize.postGrid."+d,_.debounce(i,300)),r(),o()}function n(){m.off("resize.postGrid."+d)}function i(){r()&&o(!0)}function o(e){var t=u.children(".post, .river_rock"),n=b;for(e&&t.addClass("reflowing"),w=[];n--;)w[n]=0;l(t),e&&setTimeout(function(){t.removeClass("reflowing")},400)}function a(e){l(e.filter(".post"))}function r(){var e,t=b;return u.width("auto"),e=p===k.itemWidth&&m.width()>340?u.width()-2*h:u.width(),b=Math.floor(e/(p+h)),e>=(b+1)*(p+h)-h&&(b+=1),u.width(b*(p+h)-h),t!==b}function s(e){var t,n,i,o=u.siblings(".river_rock_container").find(".river_rock"),a=o.length;for(o.sort(function(e,t){var n=$(e).data("idx"),i=$(t).data("idx");return n>i?1:-1}),i=0;a>i;i++)t=o.eq(i),n=parseInt(t.data("idx"),10),0===n?t.insertBefore(e.eq(0)):t.insertAfter(e.eq(n-1)),e.splice(n,0,t[0]);return e}function l(e){var t,n,i,o,a;if(e.length&&"1"===e[0].getAttribute("data-page")&&(e=s(e)),a=e.length){for(o=0;a>o;o++)n=e[o].querySelector("img"),t=parseInt(n.getAttribute("height"),10),t||(t=$(e[o]).data("height")),i=Math.max(f,t)+2,c(e[o],i);u.height(g.apply(Math,w))}}function c(e,t){var n,i,o=v.apply(Math,w),a=w.length;for(i=0;a>i;i++)if(o===w[i]){n=i;break}e.style.cssText="top:"+o+"px;left:"+n*(p+h)+"px;height:"+t+"px",w[n]+=t+h}var d,u,h,p,f,m=$(window),v=Math.min,g=Math.max,k={parentEl:null,offset:30,itemWidth:225,autoResize:!0},w=[],b=0;return t(e),{add:a,remove:n}},kp.lazyLoad=function(e){function t(){kp.on("lazyload.checkforimages",n),n()}function n(){e.querySelector(".lazy")&&w(i)}function i(){p||(p=!0,u={},kp.browser.touch?g.on("touchmove.lazyload",r):g.on("scroll.lazyLoad",r),g.on("resize.lazyLoad",_.debounce(a,500)),a())}function o(){g.off(".lazyLoad"),p=!1}function a(){u={},f=g.height(),r()}function r(){k||(w(s),k=!0)}function s(){var t,n;if(k=!1,v=g.scrollTop()+f+m,t=e.querySelectorAll(".lazy"),!t.length)return void o();for(n=t.length-1;n>=0;n--)l(t[n])}function l(e){var t,n,i=e.getAttribute("data-id")+e.getAttribute("data-idx");n=u[i],n||(t=$(e),n=u[i]={top:t.offset().top,el:t,loading:!1}),n.loading||n.top>v||(n.loading=!0,n.el.load({key:i},c),n.el[0].src=e.getAttribute("data-src"))}function c(e){b.push(e.target),h||(h=setTimeout(d,300)),delete u[e.data.key]}function d(){var e;for(e=b.length-1;e>=0;e--)b[e].className=b[e].className.replace(/ lazy/,"");b=[],h=null}var u,h,p=!1,f=0,m=200,v=0,g=$(window),k=!1,w=window.requestAnimationFrame,b=[];return{init:t}}(document),kp.views={},function(){var e=$("body");$(document).on("click",".module-close-cont",function(){kp.session.goToStackIndex(0)}),$(document).on("click",".kp-module",function(e){$(e.target).hasClass("kp-module")&&kp.session.goToStackIndex(0)}),$(document).on("keyup",function(e){27===e.which&&kp.session.stack.length>1&&kp.session.goToStackIndex(0)}),kp.views.PageModalMixin={pageModalMixinRender:function(){return _.bindAll(this,"pageModalMixinShow","pageModalMixinHide","pageModalMixinRemove"),this.$wrapperEl=$('<div class="kp-module"><div class="kp-module-cont"></div></div>'),this.$wrapperEl.addClass(0===kp.session.currentIdx?"preload":"hide-background"),this.$wrapperElCont=this.$wrapperEl.children(),this.on("session.hide",this.pageModalMixinHide),this.on("session.show",this.pageModalMixinShow),this.on("session.remove",this.pageModalMixinRemove),this.$wrapperEl
},pageModalMixinFadein:function(){var t=this;setTimeout(function(){t.$wrapperEl.removeClass("preload"),e.addClass("kp-module-live")},1)},pageModalMixinComplete:function(){this.$wrapperEl.find(".kp-module-cont").append(this.$el).append($('<div class="module-close-cont"><div class="module-close icon-close-no-circle"></div><div class="module-close-text">Close</div></div>')),this.pageModalMixinShow()},pageModalMixinShow:function(){this.$wrapperEl.removeClass("hide-background").show(),this.$wrapperElCont.addClass("active"),e.addClass("kp-module-live")},pageModalMixinHide:function(t){this.$wrapperEl.hide(),this.$wrapperElCont.removeClass("active"),0===t&&e.removeClass("kp-module-live")},pageModalMixinRemove:function(e){this.pageModalMixinHide(e),this.$wrapperEl.remove(),this.remove()}}}(),kp.views.follow=function(){function e(){t()}function t(){var e=_.debounce(function(){n(this)},300,!0);$(document).on("click",i,e)}function n(e){var t,n,i;e=$(e),t=e.attr("data-username"),n=e.hasClass("is-following")?"unfollow":"follow",i=e.attr("data-source"),$.ajax("/service/1.0/user/"+n,{type:"POST",data:{username:t}}).done(function(t){kp.track.info("click:follow",{source:i,state:n}),"follow"===n?(e.removeClass("is-not-following"),e.addClass("is-following"),$(".follow-all").length&&!$(".is-not-following").length&&$(".follow-all").attr("disabled",!0).addClass("all-followed")):(e.addClass("is-not-following"),e.removeClass("is-following"),$(".follow-all").length&&$(".follow-all").removeClass("all-followed").attr("disabled",!1)),kp.trigger("follow.update_counts",{users_i_follow_count:t.users_i_follow_count,target_user:t.target_user})})}var i=".btn-follow";return{init:e}}(),function(){kp.views.grid=Backbone.View.extend({className:"post-grid",events:{"click .hit,.grid-overlay-title,.kept-by-block a":"itemClickHandler","click .keep":"launchRekeep","click .share":"showShareSlider","mouseleave .share_slider":"hideShareSlider"},url:null,numPages:null,colWidth:225,postGrid:null,initialize:function(e){e=e||{},e.colWidth&&(this.colWidth=e.colWidth),this._setupGrid(),e.url?(this.url=e.url,this.numPages=this.el.getAttribute("data-num_pages")||null,1!==this.numPages&&this._setupInfiniteScroll()):this.numPages=1},remove:function(){this.postGrid.remove(),this.infiniteScroll&&this.infiniteScroll.remove(),Backbone.View.prototype.remove.call(this)},itemClickHandler:function(e){if(!e.altKey&&!e.metaKey){e.preventDefault();var t=$(e.currentTarget).parents(".post"),n=t.find(".hit").attr("href").split("/");new kp.views.keep.Detail({urlArgs:[n[1],n[3]],inApp:!0,detailImgLow:t.find(".i").attr("src"),title:t.find(".hit").text()+" | Keep.com",nextEl:t.next()||null,prevEl:t.prev()||null})}},_setupGrid:function(){this.postGrid=new kp.postGrid({parentEl:this.$el,offset:30,itemWidth:this.colWidth,autoResize:!0});var e=this.$(".post");e=_.map(e,function(e){return e.getAttribute("data-id")});var t=new kp.views.keep.ActionsTaken({keep_ids:e,show_score:!0});t.getAllActionsTaken(),this.$el.addClass("active")},launchRekeep:function(e){var t,n,i,o;if(e.preventDefault(),kp.config.user.isAuthenticated){t=$(e.currentTarget).parents(".post"),i=$(e.currentTarget).find(".count"),n=t.hasClass("lazy")?t.find(".i").data("src"):t.find(".i").attr("src"),o=t.find(".grid-overlay-title .product-name").html();var a=t.data("source"),r=t.data("contest_id")?"contest":"keep";return kp.initializedViews.rekeepView||(kp.initializedViews.rekeepView=new kp.views.rekeep({$el:$("#rekeep_modal")})),kp.initializedViews.rekeepView.showModal(t.data("id"),{imgUrl:n,contestId:t.data("contest_id"),imgName:o,source:a}).done(function(){if(i.length){var e=parseInt(i.text(),10);i.text(e+1)}}),kp.track.info("click:rekeep",{source:a,content:r}),!1}},showShareSlider:function(e){var t=$(e.target).parents(".post").data("contest_id");if(t){var n=$(e.target).parents(".post").data("id");kp.views.keep.contestModal.show(t,n)}else{var i;i=$(e.target).parents(".overlay"),i.find(".share_slider").addClass("showing"),setTimeout(function(){i.find(".grid-action-elements").addClass("hiding")},100)}},hideShareSlider:function(e){var t;t=$(e.target).parents(".overlay"),t.find(".share_slider").removeClass("showing"),setTimeout(function(){t.find(".grid-action-elements").removeClass("hiding")},200)},_setupInfiniteScroll:function(){var e=this;this.infiniteScroll=new kp.infiniteScroll({el:this.el,totalPages:this.numPages,url:this.url,bufferPx:2e3,paginationSel:".next_page",onContentLoaded:function(t){e.postGrid.add(t);var n=_.map(t.filter(".post"),function(e){return e.getAttribute("data-id")}),i=new kp.views.keep.ActionsTaken({keep_ids:n,show_score:!0});i.getAllActionsTaken(),kp.trigger("lazyload.checkforimages")}})}})}(),function(){kp.views.FeaturedCollection=Backbone.View.extend({initialize:function(){document.querySelector(".post-grid")&&new kp.views.grid({el:".post-grid",url:window.location.pathname}),$(".js-see-all-guests").on("click",this.showAllGuests)},showAllGuests:function(){$(".js-recent-guests").css("height","auto"),$(this).hide()}})}(),function(){kp.views.Index=Backbone.View.extend({initialize:function(){var e=window.location.pathname;"/"!==e.charAt(e.length-1)&&(e+="/"),document.querySelector(".post-grid")&&new kp.views.grid({el:".post-grid",url:e}),$(window).load(function(){var e=$(".post-grid .river_rock .slideshow");e.length&&new kp.views.RiverRockSlideshow({el:e})})}})}(),function(){kp.views.GenericGrid=Backbone.View.extend({initialize:function(){var e=window.location.pathname;if("/"!==e.charAt(e.length-1)&&(e+="/"),$("#user_posts").length||$("#user_likes").length){var t,n=kp.config.pageUser.username,i=n===kp.config.user.username?"self":"others";t=$("#user_posts").length?"view:keeps":"view:likes",kp.track.info(t,{observing:i})}document.querySelector(".post-grid")&&new kp.views.grid({el:".post-grid",url:e})}})}(),function(){kp.views.Preferences=Backbone.View.extend({initialize:function(){_.bindAll(this,"onFileAdded","onFileUploaded"),this.$form=this.$(".form-preferences"),this.setupAvatarUpload(),this.setupUsernameDisplay(),kp.views.user.colorHexagon.init(),kp.image.pollForImageReady.scan(),kp.util.disableFormOnSubmit(this.$form),$(".refresh-button").on({mouseenter:function(){$(this).find(".tooltip").css("opacity","1")},mouseleave:function(){$(this).find(".tooltip").css("opacity","0")}}),$(".upload-button").on({mouseenter:function(){$(this).find(".tooltip").css("opacity","1")},mouseleave:function(){$(this).find(".tooltip").css("opacity","0")}}),$(".fb-refresh").on("click",function(){window.location.href=$(this).attr("href")})},setupAvatarUpload:function(){this.$form.fileupload({url:"/previews/upload",paramName:"file",dataType:"json",add:this.onFileAdded,done:this.onFileUploaded})},onFileAdded:function(e,t){e.preventDefault(),$(".upload-button").trigger("mouseleave"),t.submit()},onFileUploaded:function(e,t){var n,i=this.$(".upload-photo"),o=this.$(".upload-help-text"),a=this.$(".photo");return t.result.error?(o.text(t.result.error).fadeIn("300"),void a.addClass("error")):(n=this.$(".tpl-new-avatar svg").clone(),n.find("image").attr("xlink:href",t.result.url),i.empty().append(n),this.$("#inp-avatar-temp-id").val(t.result.temp_id),this.$(".js-refresh-colors").fadeOut("300"),a.removeClass("error"),void o.fadeOut("300"))},setupUsernameDisplay:function(){var e=this.$(".lnk_username"),t=e.text().trim(),n=t.split("/");n[n.length-2]="<b>"+kp.config.user.username+"</b>",e.html(n.join("/"))}})}(),kp.views.typeahead=function(){function e(){S=$(".js-search-form"),A=S.find(".search-input"),S.length&&A.length&&(I=S.find(".search-list"),P=S.find(".terms-list"),D=S.find(".accounts-list"),M=P.find(".lnk-more-results"),O=D.find(".search-all-users a"),j=M.attr("href"),F=O.attr("href"),B=_.template(G),N=_.template(X),u().length&&(K=!0,i()),H=kp.form.placeholderPolyfill,U=H.init(S),!1===U&&H.resetEl(A),E())}function t(e){e&&"focusin"===e.type&&!u().length||!1===U&&H.isElEmpty(A)||(kp.trigger("header.dropdown-open","search-list"),I.addClass("show-drop-list"),A.addClass("show-typeahead"))}function n(){R=void 0,I.find(".active").removeClass("active"),I.removeClass("show-drop-list").fadeOut(200),A.removeClass("show-typeahead")}function i(){var e=u();e?c(e).done(a).fail(l):n()}function o(){S.find(".typeahead-item").remove()}function a(e){o(),e.users.length?(D.show(),s(e.users)):D.hide(),e.terms.length?($(".typeahead-search-all").addClass("hide"),r(e.terms)):$(".typeahead-search-all").removeClass("hide"),e.terms.length||e.users.length?(I.css("padding-bottom","10px"),P.css("border-bottom","1px solid #e6e6e6")):(I.css("padding-bottom","0"),P.css("border-bottom","none")),L=I.find(".typeahead-item, .typeahead-search-all, .search-all-users").not(".hide"),R=void 0,M.find("strong").text(e.query),M.attr("href",h(e.query)),O.find("strong").text(e.query),O.attr("href",p(e.query)),K?K=!1:t()}function r(e){for(var t,n=0,i=e.length;i>n;n++)t=e[n],P.prepend(N({text:t.text,text_enc:encodeURIComponent(t.text)}))}function s(e){for(var t,n=0,i=e.length;i>n;n++)t=e[n],t.img&&t.img.navatar_hex&&t.img.navatar_hex.url?t.avatar_url=t.img.navatar_hex.url:(t.avatar_url=null,t.color_svg_avatar=kp.views.user.colorHexagon.getHexSVG(t.svg_color_hexagon,30,26)),D.prepend(B(t))}function l(){}function c(e){var t;return V[e]?t=V[e]:(t=$.ajax({cache:!1,data:{q:e},dataType:"json",type:"post",url:z}),V[e]=t),t}function d(){var e,t,i;e=I.find(".active"),e.length?(t=e.find("a").attr("href"),window.location=t):(i=u(),i&&(window.location=h(i))),n()}function u(){var e=A.val(),t=kp.form.sanitize(e,["trim","html"]);return t.length<q?"":t}function h(e){return j+encodeURIComponent(e)}function p(e){return F+encodeURIComponent(e)}function f(){return $(L[R])}function m(){var e;return R++,e=$(L[R]),e.length||(R=0,e=$(L[R])),e}function v(){var e;return R--,e=$(L[R]),e.length||(R=L.length-1,e=$(L[R])),e}function g(){var e;L.length&&(void 0===R?(R=0,e=f(),e.addClass("active")):(e=f(),e.removeClass("active"),e=m(),e.addClass("active")))}function k(){var e;L.length&&(void 0===R?(R=L.length-1,e=f(),e.addClass("active")):(e=f(),e.removeClass("active"),e=v(),e.addClass("active")))}function w(e){switch(e.preventDefault(),e.keyCode){case W.DOWN_ARROW:case W.UP_ARROW:break;case W.TAB:case W.ENTER:break;case W.ESCAPE:n();break;default:i()}}function b(e){switch(e.keyCode){case W.TAB:case W.ENTER:e.preventDefault(),d();break;case W.ESCAPE:e.preventDefault();break;case W.UP_ARROW:e.preventDefault(),k();break;case W.DOWN_ARROW:e.preventDefault(),g()}}function y(){A.off("blur",n)}function C(){A.focus().on("blur",n)}function x(){I.find(".active").removeClass("active"),$(this).addClass("active")}function T(){$(this).removeClass("active")}function E(){A.on({keyup:w,keydown:b,focusin:t,blur:n}),I.on({mouseover:y,mouseleave:C}),$("#input-search-icon").on("click",function(){$("#search-query").val().length>=3&&S.submit()}),I.on("mouseenter",".typeahead-item, .typeahead-search-all, .search-all-users",x),I.on("mouseleave",".typeahead-item, .typeahead-search-all, .search-all-users",T)}var S,A,I,P,D,M,j,O,F,L,R,B,N,U,H,z="/service/1.0/search/all",V={},q=3,W={DOWN_ARROW:40,UP_ARROW:38,TAB:9,ENTER:13,ESCAPE:27},G='<li class="typeahead-item typeahead-account-item"><a href="/u/<%= username %>"><div class="icon-white-hex"><% if (avatar_url) { %><svg class="avatar" width="26" height="30" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><g><clipPath id="typeahead-mask-<%= username %>"><polygon points="13,0 26,7 26,22 13,30 0,22 0,7" /></clipPath></g><image clip-path="url(#typeahead-mask-<%= username %>)" width="26" height="30" xlink:href="<%= avatar_url %>" preserveAspectRatio="xMidYMin slice" /></svg><% } else { %><%= color_svg_avatar %><% } %></div><div class="fullname"><%= fname %> <%= lname %></div><div class="username"><%= username %></div></a></li>',X='<li class="typeahead-item term-item search-item"><a href="/search/?q=<%= text_enc %>"><svg class="term-icon" viewBox="0 0 17 17"><path d="M14.5,7.5 C14.5,3.6340066 11.3659934,0.5 7.5,0.5 C3.6340066,0.5 0.5,3.6340066 0.5,7.5 C0.5,11.3659934 3.6340066,14.5 7.5,14.5 C11.3659934,14.5 14.5,11.3659934 14.5,7.5 Z M3.5,7.5 C3.5,5.29086085 5.29086085,3.5 7.5,3.5 C9.70913915,3.5 11.5,5.29086085 11.5,7.5 C11.5,9.70913915 9.70913915,11.5 7.5,11.5 C5.29086085,11.5 3.5,9.70913915 3.5,7.5 Z M3.5,7.5"></path><path d="M14.167767,15.2890873 L15.2284271,16.3497475 L17.3497475,14.2284271 L16.2890873,13.167767 L13.4606602,10.3393398 L12.4,9.27867966 L10.2786797,11.4 L11.3393398,12.4606602 L14.167767,15.2890873 Z M14.167767,15.2890873"></path></svg><div class="term-text"><%= text %></div></a></li>',K=!1;return{init:e}}(),kp.views.fb_invite=function(){function e(){$(".lnk_fb_invite").on("click",t)}function t(e){e.preventDefault(),kp.facebook.init().done(n)}function n(){var e="Keep is the place to go when you want to discover and buy the latest trends in fashion, decor, accessories, and design.";FB.ui({method:"apprequests",message:e,data:kp.config.user.username},function(e){e&&e.to&&kp.track.info("submit:invite",{method:"facebook",num_requests:e.to.length})})}return{init:e}}(),function(){var e;kp.views.FacebookFriendList=Backbone.View.extend({events:{"click .itm":"onFriendClick","click .prev_btn":"onPrevClick","click .next_btn":"onNextClick","click .find_friends":"findFriends"},friendsTplHtml:'<% _.each(users, function(o) { %><a class="itm" title="<%= o.name %>" data-id="<%= o.id %>"><div class="recommend_to">Recommend this to <%= o.name %></div><img class="thumb" src="https://graph.facebook.com/<%= o.id %>/picture" alt="<%= o.name %>"><img class="checkmark" alt="sent" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAfCAYAAAAbW8YEAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAAB3RJTUUH3QwYETYdxdcDywAABQhJREFUSMe9l01vHMcRhp+q7tn1LlciIX/QXNGyLz7kZgcGnLtP+QFJgAAJYDi/KkcD8cEGcsjZZ+dgCA4M+JAEQWKJH2JkyhT3c2a6q3Lo2RVXlGzKEtJA787szszTXVVvVY18/O8vXADnKcNXHwIXL3zs9PGxeamwkEzSch7nkjEVfnw4L2ro/p2pqL24B14JulUb+wczUfs/QkWV4TKzfzB54eBf777D78fvsR0Gm1A3A3P604bxwUTUn9/UvRD4w/4veLm3xVbo88Erb29Cc06YGW7O1izx5vHyucAv94Z8uPc+lYT1b99MjzehOIh08S8wWhi3jpciP8AdhB6/G7/Hb15/l8Cjh781uMGvdt9F5ZEaPj/9B3+f3d+EmjuooBoAwRFGC2d851zkKTv+4MbbjEKfG9WQj/bfZzsMeOfaTX75ys+QtcCcP598zT/n9y/dH+ezBf1Bn6CKhgDuZDO2lombdyZyeOu6+2My/np6yBsv7QAQRPjt+Ocb/2c3Pjm+zTQ3T47eBw9OOTm6x3f3v+P70wdMJ+e09RKzzGBSc/Pg/JKp7yzO+Mt/v3liupjlhj8e/PWpQABt25bpdM5ytqBZLElti5sVAzkMz2v2DyeXwIf1GZ+dfIVfQJ+2Mz4++vLHddrv9wlBcQczZz6bs5jPcXOCKiCMZolb9xaXwKfNnD8d3eZhWvKv+Smf3vvblSI8WsqEGMnuLJY1dVPTpLaPSD0ajYhVRINybZZ542gud8fDDR9Pcs0nx7efLSPVTUvTtNRty7L7ztnqZV1rSokQAiIKOMNpy/ju5AfldCXocDDAgTYbLgKiVL0eMUQDcHdSSuRs4DCcNOwenIs8DzRGpV8FXqqUgCPuNHVLCIEQlJRacmoxN8wNEWFnmtk7nP5ksLZtSwxKv6ro9SoAmrqmbVscMLN1URYtZjYzht8v2DucifyEOqtmjmogVhUxRmKMuDt13WCdSb2b0uHNDDNj9LDm9buzZ/axVlVFiJEQwkZ3sFguWSwWmHvJzavWY31cGpLrk4ZX/3P2TGAVARWlqWtSSphlRCCnRF03pcMRQfQiuMxiAWd0XvPat1cHq2rAPaOq4I6KEGOgqqpVO7ZurgBEBRVFVVEVVIUYAtuzxN7R9ErgmFPC3THLxFgqTYiBbMWsj2bZnaLkYIgrMQbcQbWQticJOZrJ0XjrUpHYgPZ6FTnnsuqgJXgAV6GqqiKdGAqx9Dclgt3LrhHcHfdil515hpO5HO4OnaeA497uLk2byDnRti1t09CmxKDX49q1EaGKnU8Vty69S0DFukxVfFsAjiLsnLfkPJV74y3nCWqOw+EAbRJt05Bzpt/vE2KkNxgQY9XtrAS2SpEL3S5FBLOi2xLMDpTWZ/ssYe5y/+bI/TFwVA30KqFtSxaKVUXMGekKehdta0sZDm7giruTLa/dU0T9KMR3HtZUVSWHr/U3dhzdDYcuMYwQgeVySc650+5aXLh1bhJKSrSSsdwvxjmIKGXNwo1JQgW5+2rfV4vRpq6ZzaeknBBYZyGETpurRCeYlwDKZl2hL1Ja6Vi63ggc1ZJI3J2d85bxyaKsNxuxbWs8GckdYkY1UMWIeqY0ZmUFKWfMMtkyelG9oog4slrc6h7RtUXdne2zBnOX6d72t+q56LMKgV5VUcVQOga39fQueNwcrIuqTrulEsjm65rI2rfuK/PDzsOWt8L1W/8Dmz3DKahLTmoAAAAASUVORK5CYII=" /></a><% }); %>',friends:[],curPage:0,numPages:1,numPerPage:5,initialize:function(e){_.bindAll(this,"onFacebookInited","onFriendsLoaded","showFacebookLogin"),this.friendsTpl=_.template(this.friendsTplHtml),this.$cont=this.$(".kp-facebook_friend_list-cont"),this.productTitle=e.productTitle,kp.facebook.init().then(this.onFacebookInited,this.showFacebookLogin).done(this.onFriendsLoaded),kp.on("facebook.failedToLogin",this.showFacebookLogin)},onFacebookInited:function(){var t=$.Deferred(),n=this;return e?t.resolve(e):$.ajax({url:"/service/1.0/user/get_facebook_friends",success:function(i){i&&!i.error?(e=i.data,t.resolve(e)):n.showFacebookLogin()}}),t.promise()},onFriendsLoaded:function(e){var t,n,i;t=_.shuffle(e.registered),n=_.shuffle(e.unregistered),this.friends=t.concat(n),this.numPages=Math.ceil(this.friends.length/this.numPerPage),this.numPages>1&&(i=this.$el.find(".k_recommend_outer"),this.$prevBtn=$('<a class="prev_btn">&nbsp;</a>'),i.before(this.$prevBtn),this.$nextBtn=$('<a class="next_btn">&nbsp;</a>'),i.after(this.$nextBtn)),this.$cont.parent().addClass("show-list"),this.slideshow(),this.showSearchFriends()},showSearchFriends:function(){this.$(".find_friends").css("display","inline-block")},showFacebookLogin:function(){this.$(".btn-facebook").css("display","inline-block")},onPrevClick:function(){this.curPage&&(this.curPage-=1,this.slideshow())},onNextClick:function(){this.curPage<this.numPages-1&&(this.curPage+=1,this.slideshow())},slideshow:function(){var e=this.curPage*this.numPerPage;this.numPages>1&&(this.curPage>=this.numPages-1?(this.$nextBtn.addClass("disabled"),this.$prevBtn.removeClass("disabled")):this.curPage<=0?(this.$nextBtn.removeClass("disabled"),this.$prevBtn.addClass("disabled")):(this.$nextBtn.removeClass("disabled"),this.$prevBtn.removeClass("disabled"))),this.$cont.html(this.friendsTpl({users:this.friends.slice(e,e+this.numPerPage)}))},onFriendClick:function(e){var t=$(e.currentTarget);e.preventDefault(),t.hasClass("sent")||FB.ui({method:"apprequests",message:"Check out what I discovered on Keep: "+this.productTitle,to:e.currentTarget.getAttribute("data-id"),data:encodeURIComponent(window.location.pathname)},function(t){t&&!t.error_code&&($(e.currentTarget).addClass("sent"),kp.track.info("click:share",{content:"keep",method:"facebook_detail_recommend"}))})},findFriends:function(e){FB.ui({method:"apprequests",message:"Check out what I discovered on Keep: "+this.productTitle,to:[],data:encodeURIComponent(window.location.pathname)},function(t){t&&!t.error_code&&($(e.currentTarget).addClass("sent"),kp.track.info("click:share",{content:"keep",method:"facebook_detail_recommend"}))})}})}(),kp.views.confirmation=function(){function e(e,t){e.addClass("blackout"),t.show().addClass("active")}function t(e,t){e.removeClass("blackout"),e.modal("hide"),t.hide().removeClass("active")}return{showConfirmation:e,removeConfirmation:t}}(),function(){kp.views.rekeep=Backbone.View.extend({placeholderPolyfill:kp.form.placeholderPolyfill,formIsSubmitting:!1,hasNewCollection:!1,minCollectionLength:3,maxCollectionLength:60,hideImageTimeout:0,confirmationMessages:["High Five!","Nice Find!","Great Keep!","Good Choice!","Puuurdy!","Love It!","Awesome!","Cool Keep!","Wonderful!","Lovely!","We Likey!","That's Hot","Cute!","Applause!"],events:{"click .create":"onCreateClick","click .collection-create .collection-right-side":"hideCollectionCreate","click .collection-select .collection-right-side":"onCollectionSelectToggle","click .collection-choice":"onClickCollection","submit form":"onFormSubmit","click .icon-close-x":"hideModal","click .keep_modal_keep_it":"submitForm"},initialize:function(){var e=this;this.$formEl=this.$("form"),this.$titleEl=this.$(".new-collection-title"),this.$collectionSelectEl=this.$(".collection-name"),this.$imageHolderEl=this.$(".img_holder"),this.$highResImageHolderEl=this.$(".high_res_img_holder"),this.hasPlaceholderSupport=this.placeholderPolyfill.init(this.$formEl),this.collectionValidator=kp.form.validator({minLength:this.minCollectionLength,maxLength:this.maxCollectionLength,noHTML:!0,regex:/\w/}),this.atMention=new kp.views.user.atMention({el:this.$formEl[0]}),$(document).keydown(function(t){$("#rekeep_modal").is(":visible")&&13===t.keyCode&&e.$formEl.submit()})},submitForm:function(){this.$formEl.submit()},showModal:function(e,t){var n=this,i=t.imgUrl,o=t.contestId,a=t.imgName;if(this.source=t.source,this.content=o?"contest":"keep",clearTimeout(this.hideImageTimeout),this.formIsSubmitting=!1,this.parentId=e,this.clearErrors(),this.$imageHolderEl.css("background-image","url("+i+")"),this.$(".js-selected-coll-name-mobile").html(a),this.$highResImageHolderEl.removeClass("fade-in"),-1===i.indexOf("t_post_large")){var r=document.createElement("img");-1!==i.indexOf("t_post_grid_progressive")?r.src=i.replace("t_post_grid_progressive","t_post_large"):-1!==i.indexOf("t_caine_grid")&&(r.src=i.replace("t_caine_grid","t_post_large")),r.onload=function(){var e="url("+r.src+")";n.$highResImageHolderEl.css("background-image",e).addClass("fade-in")}}return this.hideCollectionCreate(),this.buildCurrentCollections().done(function(){n.$el.modal("show")}),this.atMention.addPlaceholder(),this.hasNoCollections&&this.$titleEl.focus(),this.resolveDfd=new $.Deferred,this.resolveDfd.done(function(){n.hideModal(),o&&kp.views.keep.contestModal.show(o,e)}),this.resolveDfd.promise()},showCollectionCreate:function(){var e=this;this.hasNewCollection=!0,this.hasNoCollections&&($(".no-keeps-copy").show(),$(".rekeep-body, .collection-right-side").addClass("hide"),this.$titleEl.addClass("no-collections")),this.$(".collection-select").hide(),this.$(".collection-create").show(),this.$el.addClass("creation-mode"),setTimeout(function(){e.$titleEl.focus()},500)},hideCollectionCreate:function(){this.hasNewCollection=!1,this.$(".collection-select").show(),this.$(".rekeep-body, .collection-right-side").removeClass("hide"),this.$(".collection-create, .no-keeps-copy").hide(),this.$el.removeClass("creation-mode"),this.$titleEl.removeClass("no-collections"),this.$(".new-collection-title").val(""),this.clearErrors()},getCollectionErrorMsg:function(e){var t;return e.minLength?t="Name must be at least "+this.minCollectionLength+" characters":e.maxLength?t="Name can't be longer than "+this.maxCollectionLength+" characters":e.noHTML?t="Collection cannot contain HTML":e.regex&&(t="Collection must contain at least one letter"),t},validateNewCollectionTitle:function(){var e,t=this.$titleEl.val();return!1===this.hasPlaceholderSupport&&this.placeholderPolyfill.isElEmpty(this.$titleEl)&&(t=""),t=kp.form.sanitize(t,["trim"]),this.$titleEl.val(t),this.collectionValidator.validate(t)?!0:(e=this.collectionValidator.errors(),this.showError(this.getCollectionErrorMsg(e)),!1)},getBodyVal:function(){var e=this.$formEl.find(".rekeep-body");return this.atMention.processCommentText(e)},showError:function(e){this.$(".error").show().find(".error-text").text(e)},clearErrors:function(){this.$(".error").hide().find(".error-text").text("")},onFormSubmit:function(e){var t,n=!0,i=this;if(e.preventDefault(),!this.formIsSubmitting){if(this.formIsSubmitting=!0,this.clearErrors(),this.hasNewCollection&&!1===this.validateNewCollectionTitle()&&(n=!1),!1===n)return void(this.formIsSubmitting=!1);t=this.hasNewCollection?this.$titleEl.val():this.$collectionSelectEl.text(),$.ajax("/service/1.0/keep/rekeep",{type:"POST",dataType:"json",data:{keep_id:this.parentId,collection_title:t,body:this.getBodyVal()}}).done(function(e){e.errors&&kp.flashMessage.error(e.errors[0]),kp.track.info("submit:rekeep",{source:i.source,content:i.content}),i.hasNewCollection&&kp.track.info("submit:create_collection",{source:"rekeep_modal"}),e.show_keepmark===!0&&new kp.views.KeepmarkModal}),this.showSuccessfulRekeep();var o=new kp.views.keep.ActionsTaken({keep_ids:[this.parentId],show_counts:!0});o.getAllActionsTaken();var a=$('.container-fluid .post[data-id="'+this.parentId+'"]');o.updateScore(a,"keep"),o.updateStateInGrid(a,"keep")}},showSuccessfulRekeep:function(){var e=this;this.setConfirmationMsg(),kp.views.confirmation.showConfirmation(this.$el,$(".keep-confirmation")),setTimeout(function(){kp.views.confirmation.removeConfirmation(e.$el,$(".keep-confirmation")),e.resolveDfd.resolve()},1200),this.hasNoCollections=!1},showDropdown:function(){this.$(".collection-dropdown").addClass("active"),this.$(".collection-right-side").addClass("active")},hideDropdown:function(){this.$(".collection-dropdown").removeClass("active"),this.$(".collection-right-side").removeClass("active")},buildCollectionsHtml:function(e){var t=[];$(e).each(function(){var e="";e=this.recent_keeps.length?"<img class='collection-thumb' src="+this.recent_keeps[0].img["44x44"].url+" alt='"+this.title+"' />":"<div class='collection-thumb empty-thumb'></div>",this.is_selected?($(".collection-name").html(this.title),t.unshift('<div class="collection-choice selected">'+e+this.title+'<div class="icon-kept-it-dark"></div></div>')):t.push('<div class="collection-choice">'+e+this.title+'<div class="icon-kept-it-dark"></div></div>')}),t.unshift('<div class="create"><svg viewBox="0 0 48 48"><path d="M24,12 C22.8954305,12 22,12.8970262 22,14.0049466 L22,33.9950534 C22,35.1023548 22.8877296,36 24,36 L24,36 C25.1045695,36 26,35.1029738 26,33.9950534 L26,14.0049466 C26,12.8976452 25.1122704,12 24,12 L24,12 Z M24,12"></path><path d="M24,12 C22.8954305,12 22,12.8970262 22,14.0049466 L22,33.9950534 C22,35.1023548 22.8877296,36 24,36 L24,36 C25.1045695,36 26,35.1029738 26,33.9950534 L26,14.0049466 C26,12.8976452 25.1122704,12 24,12 L24,12 Z M24,12" transform="translate(24.000000, 24.000000) rotate(-270.000000) translate(-24.000000, -24.000000)"></path><path d="M0,24 C0,10.7451655 10.7451655,0 24,0 C37.2548345,0 48,10.7451655 48,24 C48,37.2548345 37.2548345,48 24,48 C10.7451655,48 0,37.2548345 0,24 Z M43,24 C43,13.5065892 34.4934108,5 24,5 C13.5065892,5 5,13.5065892 5,24 C5,34.4934108 13.5065892,43 24,43 C34.4934108,43 43,34.4934108 43,24 Z M43,24"></path></svg>Create a New Collection</div>'),$(".collection-dropdown").html(t.join("\n"))},onCreateClick:function(){this.showCollectionCreate(),this.hideDropdown()},onCollectionSelectToggle:function(){this.$(".collection-select .collection-right-side").hasClass("active")?this.hideDropdown():this.showDropdown()},onClickCollection:function(e){this.$(".collection-name").text($(e.target).text()),this.$(".selected").removeClass("selected"),$(e.target).addClass("selected"),this.hideDropdown()},buildCurrentCollections:function(){var e=this;return this.$(".rekeep-body").val(""),$.ajax({url:"/service/1.0/collection/search",data:{include_image:!0}}).done(function(t){e.hasNoCollections=!t.length,e.hasNoCollections?e.showCollectionCreate():e.buildCollectionsHtml(t)})},setConfirmationMsg:function(){var e=Math.floor(Math.random()*this.confirmationMessages.length),t=this.confirmationMessages[e];$(".confirmation-text").text(t)},hideModal:function(){var e=this.$highResImageHolderEl;this.$el.modal("hide"),this.hideImageTimeout=setTimeout(function(){e.css("background-image","none")},1e3)}})}(),function(){kp.views.KeepmarkModal=Backbone.View.extend({events:{"click .btn-bookmarklet":"onBookmarkletClick","mouseenter .btn-bookmarklet":"onBookmarkletMouseEnter","mouseleave .btn-bookmarklet":"onBookmarkletMouseLeave","hidden.bs.modal":"unregisterView"},initialize:function(){this.injectChromeStoreValidationHeader(),this.loadAndDisplayModal()},onBookmarkletMouseEnter:function(){$(".btn-bookmarklet").addClass("hover"),$(".keepit-arrow").css("opacity",1)},onBookmarkletMouseLeave:function(){$(".btn-bookmarklet").removeClass("hover"),$(".keepit-arrow").css("opacity",0)},onBookmarkletClick:function(){kp.track.counter("click:bookmarklet")},injectChromeStoreValidationHeader:function(){$("head").append('<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/jebdgdginjpgphhdempgjfbambgbpbii">')},loadAndDisplayModal:function(){var e=this;$.ajax({type:"GET",url:"/keepmark/modal",dataType:"html"}).done(function(t){$("body").append(t),e.setElement("#keepmark_modal"),setTimeout(function(){kp.track.info("view:keepmark_modal"),e.$el.modal("show")},1500)})},unregisterView:function(){Backbone.View.prototype.remove.call(this)}})}(),kp.views.searchResults=function(){function e(){var e;kp.track.info("view:search"),document.querySelector(".post-grid")&&new kp.views.grid({el:".post-grid",url:window.location.pathname}),document.querySelector(".user-card-list")&&(e=kp.config.numUserPages||0,e>1&&new kp.infiniteScroll({el:".user-card-list",totalPages:e,url:window.location.pathname+"/",bufferPx:2e3,paginationSel:".next_page"}))}return{init:e}}(),kp.views.sentiment=function(){function e(){kp.config.user.isAuthenticated&&$("body").on("click",".round_button .like",t)}function t(e){var t,i,o,a=$(e.currentTarget),r=a.parents(".post"),s=a.parents(".k_actions_number_buttons");return r.length?(i=$(r).data("source"),t=$(r).data("contest_id")):s.length&&(i=$(s).data("source"),t=$(s).data("contest_id")),o=t?"contest":"keep",kp.track.info("click:like",{source:i,content:o}),e.preventDefault(),n(a,a.data("product_id"),a.data("keep_id")),!1}function n(e,t,n){var a=e.next(".count").find(".count_int");$.ajax("/service/1.0/keep/vote",{data:{product_id:t,context_keep_id:n},type:"POST"}),a.length?o(e,a):i(e)}function i(e){var t=new kp.views.keep.ActionsTaken({keep_ids:[e.data("id")]});t.getAllActionsTaken(),t.updateScore(e.parents(".post"),"like"),e.hasClass("active")?(e.removeClass("active"),e.find(".icon-heart").removeClass("voted")):(e.addClass("active"),e.find(".icon-heart").addClass("voted"))}function o(e,t){if($(".kp-module-cont").length){var n=new kp.views.keep.ActionsTaken({keep_ids:[e.data("id")]});n.getAllActionsTaken();var i=$('.container-fluid .post[data-id="'+e.data("keep_id")+'"]');n.updateScore(i,"like"),n.updateStateInGrid(i,"like")}t.fadeOut(200,function(){var n=parseInt(t.text().trim(),10)||0;t.html("0"),e.hasClass("active")?(e.removeClass("active"),n-=1,n&&t.html(n),e.find(".icon-heart").removeClass("voted")):(e.addClass("active"),t.html(n+1),e.find(".icon-heart").addClass("voted")),t.fadeIn()})}return{init:e}}(),kp.views.socialWidgets=function(){function e(){var e=$(document);e.on("click",".share_email",n),e.on("click",".share_pinterest",h),e.on("click",".share_twitter",l),e.on("click",".share_facebook",d),e.on("click",".share_embed",f),e.on("click mouseenter mouseleave",".share_top",a),e.on("submit","#tell_a_friend form",o),kp.on("contestModal.email",function(e){i(e,{source:"contest",content:"contest",eventType:"click"})}),kp.on("contestModal.tweet",function(e){c(e,{source:"contest",content:"contest",eventType:"click"})}),kp.on("contestModal.fb-share",function(e){u(e,{source:"contest",content:"contest",eventType:"click"})}),kp.on("contestModal.pin-share",function(e){p(e,{source:"contest",content:"contest",eventType:"click"})})}function t(e,t){var n={source:t.source,method:e,content:t.content};kp.track.info(t.eventType+":share",n)}function n(e){var t=s($(e.currentTarget)),n=e.currentTarget.parentNode.dataset;e.preventDefault(),n.eventType="click",i(t,n)}function i(e,n){return $.ajax({url:"/service/1.0/share/get_email_modal",data:{outland_id:e},success:function(e){$("body").append(e),$("#tell_a_friend").modal("show"),t("email",n)}}),!1}function o(e){e.preventDefault();var t=$("#tell_a_friend form").serializeArray(),n=$("#tell_a_friend");$.ajax("/service/1.0/share/email",{type:"POST",data:t}).done(function(e){e.msg?n.find(".error").html(e.msg):(kp.views.confirmation.showConfirmation(n,$(".send-confirmation")),setTimeout(function(){kp.views.confirmation.removeConfirmation(n,$(".send-confirmation"))},1200))})}function a(e){var t=$(".v-keep_detail").data("contest_id");if(t&&"click"===e.type)return void kp.views.keep.contestModal.show(t,$(".v-keep_detail").data("keep_id"));if(kp.browser.touch||"click"!==e.type){var n=$(e.currentTarget).find(".share_edit");$(n).hasClass("show-drop-list")?n.removeClass("show-drop-list").hide():t||n.addClass("show-drop-list").show()}}function r(e){if(k&&k.id===e)return k;var t=$.ajax({url:w,async:!1,data:{outland_id:e},dataType:"json"});return t}function s(e){var t=e.parents(".v-keep_detail"),n=e.parents(".collection-header"),i=e.parents(".post"),o=e.parents(".blog_detail");return t.length?t.data("keep_id"):n.length?n.data("collection_id"):o.length?o.data("post_id"):i.data("id")}function l(e){var t=s($(e.currentTarget)),n=e.currentTarget.parentNode.dataset;e.preventDefault(),n.eventType="click",c(t,n)}function c(e,n){return n.method="twitter",r(e).then(function(e){var i=m(!0,e.data),o=location.protocol+"//"+location.host+"/ua/"+i.url,a=i.isContest?i.twitterContestCaption:i.twitterCaption,r="https://twitter.com/intent/tweet?url="+encodeURIComponent(o),s="&hashtags=DiscoverKeep";
i.isContest&&(r+="?referral_code="+kp.config.user.ref,s=""),r+=s+"&text="+a,t("twitter",n),window.open(r,"twitter",v)}),!1}function d(e){var t=s($(e.currentTarget)),n=e.currentTarget.parentNode.dataset;e.preventDefault(),n.eventType="click",u(t,n)}function u(e,n){return n.method="facebook",r(e).then(function(e){var i=m(!0,e.data),o=location.protocol+"//"+location.host+"/ua/"+i.url,a=encodeURIComponent(o),r=i.isContest?i.fbContestCaption:i.fbCaption;i.isContest&&(a+="?referral_code="+kp.config.user.ref);var s="https://www.facebook.com/dialog/feed?app_id="+kp.config.facebook_app_id+"&display=popup&link="+a+"&redirect_uri="+a;s+="&name="+i.title+"&caption="+r+"&description="+i.title,i.imgUrl&&(s+="&picture="+i.imgUrl),t("facebook",n),window.open(s,"fbshare",v)}),!1}function h(e){var t=s($(e.currentTarget)),n=e.currentTarget.parentNode.dataset;e.preventDefault(),n.eventType="click",p(t,n)}function p(e,n){return n.method="pinterest",r(e).then(function(e){var i=m(!0,e.data),o=location.protocol+"//"+location.host+"/ua/"+i.url+"?utm_campaign=social&utm_medium=web&utm_source=detail",a=encodeURIComponent(o),r=i.isContest?i.pinContestCaption:i.pinCaption;i.isContest&&(a+="?referral_code="+kp.config.user.ref);var s="http://pinterest.com/pin/create/button/?url="+a;s+=i.isContest?"&description="+r:"&description="+i.title,s+="&media="+i.imgUrl,t("pinterest",n),window.open(s,"pin"+(new Date).getTime(),v)}),!1}function f(e){e.preventDefault();var t,n,i=location.protocol+"//"+location.host+"/cc/"+kp.config.collection.collection_id,o=_.template('<iframe src="<%= url %>" width="100%" height="<%= height %>" frameborder="0" scrolling="no"></iframe>');t=$(g),n=t.find("textarea"),$("body").append(t),t.on("click","textarea",function(){this.focus(),this.select()}),n.html(o({url:i,height:400})),t.on("click","[name=include_author]",function(e){var t=e.currentTarget.checked;n.html(o({url:i+(t?"?author=1":""),height:t?660:440}))}),t.modal("show")}function m(e,t){var n;if(e)for(n in t)t.hasOwnProperty(n)&&t[n]&&"url"!==n&&(t[n]=encodeURIComponent(t[n]));return t}var v="status=no,resizable=yes,scrollbars=yes,personalbar=no,directories=no,location=no,toolbar=no,menubar=no,width=632,height=270,left=0,top=0",g='<div class="modal fade share_embed_modal"><div class="modal-content"><div class="modal-header"><a class="close" data-dismiss="modal">&times;</a><h3>Embed this Collection</h3></div><div class="modal-body group"><h4>Copy this to your site</h4><textarea rows=4 spellcheck="false"></textarea><label><input type="checkbox" name="include_author"> Include Keeper</label></div><div class="modal-footer"><button type="submit" class="btn btn-big btn-submit" data-dismiss="modal">Done</button></div></div></div>',k={},w="/service/1.0/share/get_share_info";return{scan:e}}(),function(){kp.views.GetBookmarklet=Backbone.View.extend({leftBtnDown:!1,isDraggingBound:!1,originalText:"",events:{"click #install-button":"downloadExtension","click .bookmark":"switchBottomView","click .modal_enable_bookmark_bar":"_setupBrowserInstructions","mouseenter .btn-bookmarklet":"btnFocus","mouseleave .btn-bookmarklet":"btnBlur","mousedown .btn-bookmarklet":"btnLeftDown"},initialize:function(){this._setupArrow()},tweakMouseMoveEvent:function(e){1!==e.which||this.leftBtnDown||(e.which=0)},_setupArrow:function(){$(document).mousedown(function(e){1===e.which&&(this.leftBtnDown=!0)}),$(document).mouseup(function(e){1===e.which&&(this.leftBtnDown=!1)})},btnFocus:function(e){this._textSwap($(e.target).find(".button-text"),"Drag me"),$(e.target).addClass("hover"),this.$(".keepit-arrow").css("opacity",1)},btnBlur:function(e){this.isDraggingBound===!1&&($(e.target).removeClass("hover"),this._textSwap($(e.target).find(".button-text")),this.$(".keepit-arrow").css("opacity",0))},btnLeftDown:function(e){var t=this;this.isDraggingBound=!0,$(e.target).removeClass("hover").addClass("drag"),this._textSwap($(e.target).find(".button-text")),$(document).off("mousemove.getkeep"),$(document).on("mousemove.getkeep",function(n){t.tweakMouseMoveEvent(n),0===n.which&&($(document).off("mousemove.getkeep"),$(e.target).removeClass("hover drag"),t.isDraggingBound=!1,$(document).off("mousemove"))})},_textSwap:function(e,t){""===this.originalText&&(this.originalText=e.text()),e.text(void 0===t?this.originalText:t)},_setupBrowserInstructions:function(){var e,t=navigator.userAgent.toLowerCase();e=t.match(/chrome/)?"chrome":t.match(/webkit/)?"safari":t.match(/msie /)?"msie":t.match(/mozilla/)?"firefox":"unknown",$(".modal-body").find(".instructions-"+e).show()},downloadExtension:function(){$("head").append('<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/jebdgdginjpgphhdempgjfbambgbpbii">'),chrome.webstore?chrome.webstore.install("",function(){},function(e){kp.flashMessage.error(e)}):kp.flashMessage.error("Sorry, Chome Extensions are not supported with this device.")},switchBottomView:function(){this.$(".keepmark-chrome-hero").toggleClass("show"),this.$(".keepmark-bookmark-hero").toggleClass("show")}})}(),kp.views.tools=function(){function e(){var e=$("#configurator");o=e.find("form"),a=e.find(".code"),o.on("submit",t),r=o.find("input[type=text]"),e.find("#code").on("click",function(){this.focus(),this.select()}),i(r,d)}function t(e){e.preventDefault(),n();var t=l.concat('"',s,'"',c);return a.show().find("textarea").val(t),$("#button-preview").html(t),!1}function n(){return s=$("#km_url").val(),s=s.concat("?"),o.find("input, textarea").each(function(e,t){var n=t.id,i=encodeURIComponent($(t).val());i.length&&(s=s.concat(n,"=",i,"&"))}),s=s.substring(0,s.length-1)}function i(e,t){var n=kp.form.modelform(o,e);$.each(t,function(e,t){n[e].rules(t.constraints,t.messages)}),n.onChangeHandler=function(e,t,n){if(n)return!1;var i;!0===t.valid?u(e).valid():(i=_.isString(t.msg)?t.msg:_.values(t.msg)[0],u(e).invalid(i))}}var o,a,r,s,l="<a target=\"_blank\" onclick=\"window.open(this.href, '_blank', 'location=yes,width=700,height=400'); return false;\" href=",c='><img border="0" title="Keep it" src="http://5b15208d14e7c00b5f9d-f96a2de1a1cf9237fd3f6c21825b2bce.r46.cf1.rackcdn.com/keep-it-button.png"/></a>',d={title:{constraints:{minLength:1,maxLength:1e3},messages:{minLength:"Please add a title for this product.",maxLength:"Sorry, your title is too long."}},origin_url:{constraints:{minLength:1,maxLength:1e3,regex:/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/},messages:{minLength:"Please add an origin URL for this product.",maxLength:"Sorry, your URL is too long.",regex:"This doesn't appear to be a valid URL"}},image_url:{constraints:{minLength:1,maxLength:1e3,regex:/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/},messages:{minLength:"Please add an image URL for this product.",maxLength:"Sorry, your URL is too long.",regex:"This doesn't appear to be a valid URL"}},price:{constraints:{minLength:1,maxLength:1e3,regex:/(^\d+$|^\d+\.\d{2}$)/},messages:{minLength:"Please add a price for this product.",maxLength:"That's way too expensive.",regex:"This doesn't appear to be a valid price."}}},u=function(e){var t=e.next(".help-text");return{invalid:function(n){e.addClass("input-error"),t.html(n).fadeIn("300")},valid:function(){e.removeClass("input-error"),t.fadeOut("300")},notice:function(n){e.addClass("input-notice"),t.html(n).addClass("help-notice").fadeIn("300")}}};return{init:e}}(),kp.views.crick=function(){function e(){t=$(".crick-frm"),n=t.find(".js-submit"),t.find(".js-available-cont,.js-price-cont,.js-price-right-cont").hide(),n.attr("disabled","disabled"),t.on("submit",function(){var e=t.find("[name=is_product]").val(),n=t.find("[name=is_available]").val(),i=t.find(".js-price").val(),o=t.find("[name=skipped]").val();if(i=kp.form.sanitize(i,["price"]),t.find("[name=price]").val(i),"0"===e||"1"===o)return!0;if("1"===e){if("0"===n)return!0;if("1"===n&&i)return!0}return!1}),t.on("click",".js-skip",function(e){e.preventDefault(),t.find(".js-product").removeClass("halo"),t.find(".js-available").removeClass("halo"),t.find(".js-price-right").removeClass("halo"),$(this).addClass("halo");var i=t.find("[name=skipped]").val();"0"===i?(t.find("[name=skipped]").val("1"),n.removeAttr("disabled"),t.find(".js-price").val(""),t.find("[name=is_available]").val(""),t.find("[name=is_product]").val(""),t.find(".js-available-cont").hide(),t.find(".js-product-cont").hide(),t.find(".js-price-cont").hide(),t.find(".js-price-right-cont").hide()):(t.find("[name=skipped]").val("0"),n.attr("disabled","disabled"),$(this).removeClass("halo"),t.find(".js-product-cont").show())}),t.on("click",".js-product",function(e){var i=$(this).data("is_product");e.preventDefault(),t.find(".js-product").removeClass("halo"),$(this).addClass("halo"),t.find("[name=is_product]").val(i),i?(t.find(".js-available-cont").show(),n.attr("disabled","disabled")):(t.find(".js-available-cont").hide(),n.removeAttr("disabled"),t.find(".js-price").val(""),t.find("[name=is_available]").val(""))}),t.on("click",".js-available",function(e){var i=$(this).data("is_available");e.preventDefault(),t.find(".js-available").removeClass("halo"),$(this).addClass("halo"),t.find("[name=is_available]").val(i),i?(t.find(".js-price-right-cont").show(),t.find(".js-price-cont").show(),n.attr("disabled","disabled")):(t.find(".js-price-cont").hide(),t.find(".js-price-right-cont").hide(),t.find(".js-price").val(""),n.removeAttr("disabled"))}),t.on("click",".js-price-right",function(e){var i,o=$(this).data("is_right_price");e.preventDefault(),t.find(".js-price-right").removeClass("halo"),$(this).addClass("halo"),o?(i=t.find("[name=crawler_price]").val(),t.find("[name=price]").val(i)):t.find(".js-price").val("").focus(),n.removeAttr("disabled")})}var t,n;return{init:e}}(),kp.views.header=function(){function e(){t(),kp.views.typeahead.init(),$(".notification-dropdown").length&&kp.views.user.notificationDropdown.init(),r(),$("#subheader").length&&(s(),h()),p()}function t(){$(".hamburger").on("mouseenter",function(){a()}).on("click",function(){kp.browser.touch&&($(".hamburger-list").hasClass("show-drop-list")?o():a())}),$(".hamburger-menu").on("mouseleave",function(){o()}),$("#header .username").on("mouseenter",function(){i()}).on("click",function(e){kp.browser.touch&&(e.preventDefault(),$(".user-list").hasClass("show-drop-list")?n():i())}),$(".user-dropdown").on("mouseleave",function(){n()}),kp.on("header.dropdown-open",function(e){$("#header .drop-list:visible").not("."+e).removeClass("show-drop-list").fadeOut(200),"user-list"!==e&&$(".user-list-cont").hide(),"hamburger-list"!==e&&$(".hamburg-list-cont").hide(),$("#subheader").length&&g.hasClass("active")&&d()}),$("#mobile-search .icon-search").on("click",function(){$("#mobile-search").submit()})}function n(){$(".user-list").removeClass("show-drop-list").fadeOut(200),$(".user-list-cont").hide()}function i(){kp.trigger("header.dropdown-open","user-list"),$(".user-list").addClass("show-drop-list"),$(".user-list-cont").show()}function o(){$(".hamburger-list").removeClass("show-drop-list").fadeOut(200),$(".icon-hamburger").removeClass("active"),$(".hamburg-list-cont").hide()}function a(){kp.trigger("header.dropdown-open","hamburger-list"),$(".hamburger-list").addClass("show-drop-list"),$(".icon-hamburger").addClass("active"),$(".hamburg-list-cont").show()}function r(){var e=!1,t=!1;$("#feedback").on("click",function(n){return n.preventDefault(),t?void FBY.showForm("2558"):void(e||(e=!0,kp.util.scriptLoad("//fby.s3.amazonaws.com/fby.js?100").done(function(){return t=!0,e=!1,kp.config.has("user")&&FBY.setEmail(kp.config.user.email),FBY.showForm("2558"),!1})))})}function s(){m=$("#subheader-content"),v=m.children(),g=v.filter(".more-links"),k=g.find("li"),b=f.width();var e=v.length-1;w=v.slice(3,e),l(),m.removeClass("preload"),kp.browser.touch?(f.on("resize.header",_.debounce(u,600)),$(".more-dropdown").on("click",function(){g.hasClass("active")?d():c(),$(".hamburger-list").hasClass("show-drop-list")&&o(),$(".user-list").hasClass("show-drop-list")&&n()})):(f.on("resize.header",_.debounce(u,300)),g.on("mouseenter",c).on("mouseleave",d))}function l(){for(var e=v.first().offset(),t=e.top,n=w.length-1,i=n;i>0;i--){var o=$(w[i]),a=o.data("linkindex"),r=o.offset();if(r.top>t){var s=o.prev(),l=s.data("linkindex"),c=s.offset();if(o.addClass("hide"),k.filter('[data-linkindex="'+a+'"]').addClass("show"),c.top===t)return s.addClass("hide"),k.filter('[data-linkindex="'+l+'"]').addClass("show"),g.addClass("show-more-links"),!1}}}function c(){m.addClass("visible"),g.addClass("active")}function d(){m.removeClass("visible"),g.removeClass("active")}function u(){f.width()!==b&&(b=f.width(),g.hasClass("active")&&d(),g.hasClass("show-more-links")&&(g.removeClass("show-more-links"),w.removeClass("hide"),k.removeClass("show")),l())}function h(){$("#subheader").headroom({tolerance:10,offset:150,classes:{initial:"animated",pinned:"slideDown",unpinned:"slideUp",top:"position-top",notTop:"position-not-top"},onPin:function(){!kp.browser.touch&&g.hasClass("show-more-links")&&g.on("mouseenter",c).on("mouseleave",d)},onUnpin:function(){!kp.browser.touch&&g.hasClass("show-more-links")&&g.off("mouseenter mouseleave"),g.hasClass("active")&&d()}})}function p(){var e=0;$.ajax("/service/1.0/cart/mget_cart_and_orders",{type:"GET",data:{}}).done(function(t){t.cart_items.length?(_.each(t.cart_items,function(t){e+=t.quantity}),e&&$(".cart-link .gem-background").addClass("show").find(".cart-count").html(e)):$(".cart-link .gem-background").removeClass("show"),t.orders.length&&$("#header-user").find(".drop-item.order-history").removeClass("hide")})}var f=$(window),m=null,v=null,g=null,k=null,w=null,b=null;return{init:e}}(),kp.views.masthead=function(){function e(){kp.browser.touch||$(".iphone-masthead").length||(a(),o()),$(".iphone-masthead").length&&t()}function t(){$(".masthead .icon-close-x").on("click",function(){i()}),$(".number_form").on("submit",function(e){e.preventDefault();var t=$(this),o=t.find("input").val();o=o.replace(/[^\d]/g,""),10!==o.length?$(".error").css("opacity","1"):($(".error").css("opacity","0"),$.post(t.attr("action"),{number:o}),n(),setTimeout(function(){i()},2e3))})}function n(){$(".masthead").addClass("fade-out"),$(".mobile-number-confirmation").addClass("show")}function i(){$(".masthead-background").slideUp(500),$(".page_content").css("margin-top","65px"),kp.util.setCookie("no_iphone_masthead",1,r)}function o(){var e=$(".masthead-img"),t=e.length,n=0;setInterval(function(){e.eq(n).removeClass("show-slideshow-img"),setTimeout(function(){n=++n%t,e.eq(n).addClass("show-slideshow-img")},700)},5500)}function a(){$(".masthead-img").each(function(){this.hasAttribute("data-defer-src")&&this.setAttribute("src",this.getAttribute("data-defer-src"))})}var r=2592e6;return{init:e}}(),function(){kp.views.RiverRockSlideshow=Backbone.View.extend({slideshowIntervalSec:3.2,initialize:function(){this.$imgSet=this.$(".riverrock-img"),this.startImgRotation()},startImgRotation:function(){var e=this.$imgSet,t=e.length,n=0,i=this;this.preload(1),setInterval(function(){e.eq(n).removeClass("show-slideshow-img"),n=++n%t,setTimeout(function(){e.eq(n).addClass("show-slideshow-img"),i.preload((n+1)%t)},0)},1e3*this.slideshowIntervalSec)},preload:function(e){var t,n=this.$imgSet[e];n&&(t=n.getAttribute("data-defer-src"),t&&t!==n.getAttribute("src")&&n.setAttribute("src",t))}})}(),kp.views.downloads=function(){function e(){$(".number_form").on("submit",function(e){t(e)}),$(".mobile-input").on("keyup",function(e){kp.util.formatPhone(e)})}function t(e){e.preventDefault();var t=$(e.target),i=t.find("input").val();i=i.replace(/[^\d]/g,""),10!==i.length?$(".error").css("opacity","1"):($(".error").css("opacity","0"),$.post(t.attr("action"),{number:i}),$(".mobile-input").val(""),n())}function n(){$(".download-app-buttons").addClass("fade-out"),$(".mobile-number-confirmation").addClass("show"),setTimeout(function(){i()},4e3)}function i(){$(".mobile-number-confirmation").addClass("fade-out"),$(".download-app-buttons").removeClass("fade-out"),setTimeout(function(){$(".mobile-number-confirmation").removeClass("show")},1e3)}return{init:e}}(),function(){kp.views.About=Backbone.View.extend({events:{"click .navbar-item":"changeSection","click .sub-navbar-toggle":"toggleMenu"},initialize:function(){this.setElement(this.$(".about_page")),new kp.views.Widgets({el:$(".widget_section")}),new kp.views.GetBookmarklet({el:$("#keepitbutton")})},changeSection:function(e){e.preventDefault();var t=$(e.target).attr("id");this.$(".about_section").fadeOut(500),this.$("#"+t+"_section").fadeIn(500),this.$(".navbar-item").removeClass("active"),$(e.target).addClass("active"),kp.router.navigate("/about/"+t),$("html, body").scrollTop(0),this.toggleMenu()},toggleMenu:function(){if($(window).width()<820){var e=this.$(".nav-tabs"),t=this.$(".sub-navbar-toggle").find(".caret");e.hasClass("expanded")?(t.removeClass("expanded"),e.slideUp(200).removeClass("expanded")):(t.addClass("expanded"),e.slideDown(200).addClass("expanded"))}}})}(),function(){kp.views.Widgets=Backbone.View.extend({events:{"click .generate_button":"createButton","click .generate_badge":"createBadge","click .generate textarea":"selectSnippet","keyup .user_url":"checkIfEmpty"},initialize:function(){},createButton:function(e){var t=$(e.target).parents(".widget_section"),n=t.find(".buttons input[name=buttons]:checked").data("image-style");if(n){var i='<a class="keep-it-button" href="//keep.com"></a><script async="true" type="text/javascript" src="//keepit.keep.com/keepit-button/'+n+'"></script>';t.find(".button_code").val(i),t.find(".code").addClass("expanded")}},createBadge:function(e){var t=$(e.target).parents(".widget_section"),n=t.find(".badges input[name=badges]:checked");if(n.length){var i=n.parent().find("img").attr("src"),o=t.find(".user_url").val(),a='<a href="'+o+'"><img src="'+i+'" width="200" height="180" border="0" style="margin-top:2em;margin-bottom:2em;" alt="My Keeps"></a>';t.find(".badge_code").val(a),t.find(".code").addClass("expanded")}},selectSnippet:function(e){$(e.target).select()},checkIfEmpty:function(e){""===$(e.target).val()?this.$(".generate_badge").addClass("disabled"):this.$(".generate_badge").removeClass("disabled")}})}(),function(){kp.views.MyFeed=Backbone.View.extend({CAROUSEL_OPTIONS:{thumbSel:".user-card",thumbGutterX:36,thumbWidth:272},initialize:function(){var e=this.$("#carousel-container");e.length?this.loadCarousel(e):this.loadGrid()},loadCarousel:function(e){var t=this.CAROUSEL_OPTIONS;$.ajax({type:"GET",url:"/register/welcome_user_carousel/",dataType:"html"}).done(function(n){e.append(n),kp.carousel(e.find(".user-card-carousel"),t)})},loadGrid:function(){new kp.views.grid({el:".post-grid",url:window.location.pathname})}})}(),function(){kp.views.ModularMasthead=Backbone.View.extend({el:".modular-masthead",events:{"click a":"clickedLink"},clickedLink:function(e){var t=$(e.currentTarget),n={destination:t.attr("href"),variant:kp.config.featureVariants.modular_masthead};kp.track.info("click:modular masthead",n,!0)}})}(),function(){kp.views.ProductInfo=Backbone.View.extend({events:{"click .js-product[data-is_product='1']":"markAsProduct","click .js-product[data-is_product='0']":"markAsNotProduct","click .js-product[data-us_price='1']":"markUSPriceTrue","click .js-product[data-us_price='0']":"markUSPriceFalse","click .js-product[data-is_highest_price='1']":"markHighestPriceTrue","click .js-product[data-is_highest_price='0']":"markHighestPriceFalse","click .btn-save-price":"saveHighestPrice","click .js-available[data-is_available='1']":"markAsAvailable","click .js-available[data-is_available='0']":"markAsUnavailable","click .btn-prev-step":"goToPrevStep","click .btn-save-cont":"saveAndContinue","submit .crick-frm":"onSubmit"},initialize:function(){this.enableRefreshBlock(),this.$newHighestPrice=$("#new_highest_price"),this.$newHighestPrice.on("keyup",function(){var e=/^\d{0,}(\.\d{0,2})?$/.test(this.value),t=this.value;e||(this.value=t.substring(0,t.length-1))})},enableRefreshBlock:function(){window.onbeforeunload=function(){return confirm("Are you sure you want to reload the page?")}},disableRefreshBlock:function(){window.onbeforeunload=void 0},markAsProduct:function(){return $("#is_product").val("1"),this.goToNextStep(),$(".btn-prev-step").removeClass("hide"),!1},markAsNotProduct:function(){return $("#is_product").val("0"),confirm("Are you sure you want to mark this as not a product?")?void 0:($("#is_product").val("1"),!1)},markUSPriceTrue:function(){return $("#has_us_price").val("1"),this.goToNextStep(),!1},markUSPriceFalse:function(){return $("#has_us_price").val("0"),confirm("Are you sure you want to mark this product as not having a U.S. price?")?void 0:($("#has_us_price").val("1"),!1)},markHighestPriceTrue:function(){return $("#is_highest_price").val("1"),this.goToNextStep(),!1},markHighestPriceFalse:function(){return $("#is_highest_price").val("0"),$(".current-step").children(".step1").hide(),$(".current-step").children(".step2").fadeIn(300),!1},saveHighestPrice:function(e){e.preventDefault(),this.$newHighestPrice.val()&&this.goToNextStep()},markAsAvailable:function(){return $("#is_available").val("1"),this.goToNextStep(),!1},markAsUnavailable:function(){return $("#is_available").val("0"),confirm("Are you sure you want to mark this as unavailable?")?void 0:($("#is_available").val("1"),!1)},goToNextStep:function(){$(".current-step").removeClass("current-step").hide().next().addClass("current-step").fadeIn(300),$(".current-step").hasClass("highest-price")&&this.resetHighestPrice()},goToPrevStep:function(e){e.preventDefault();var t=$(".current-step");t.removeClass("current-step").hide().prev().addClass("current-step").fadeIn(300),t=$(".current-step"),t.hasClass("is-product")&&$(".btn-prev-step").addClass("hide"),t.hasClass("highest-price")&&this.resetHighestPrice()},saveAndContinue:function(e){e.preventDefault(),this.goToNextStep()},resetHighestPrice:function(){var e=$(".highest-price");e.children(".step1").show(),e.children(".step2").hide()},onSubmit:function(){this.disableRefreshBlock()}})}(),kp.views.keep={},function(){kp.views.keep.Detail=Backbone.View.extend({className:"v-keep_detail",keepId:null,productId:null,contestId:null,imgUrl:null,infoEl:null,imgName:null,nextEl:null,prevEl:null,$cartCount:null,oneMonth:2592e6,events:{"click .round_button .keep":"setupRekeep","click .round_button .buy":"onBuyButtonClick","click .k_desc .k_desc_img":"onImageClick","click .k_thumb, .k_comment_thumb":"loadNewImage","click .k_report_issue":"onReportIssue","click .k_origin_domain .origin":"onOriginClick","click .k_collection_cards .collection-lnk":"onCollectionCardClick","click .k_edit_options .btn-edit":"onEditOptionClick","click .k_edit_options .btn-mark-review":"onMarkForReviewClick","click .go_to_previous":"goToPreviousKeep","click .go_to_next":"goToNextKeep","click .btn-follow .follow":"trackFollow"},initialize:function(e){if(this.slug=e.urlArgs[0],this.keepId=e.urlArgs[1],this.url="/"+this.slug+"/k/"+this.keepId+"/",this.inApp=e.inApp||!1,this.detailImgLow=e.detailImgLow,this.$cartCount=$("#header-user").find(".cart-count"),this.prevEl=e.prevEl,this.nextEl=e.nextEl,this.$el.hasClass("page_content")&&this.setElement(this.$(".kp-view")),_.bindAll(this,"_onContentLoaded","onEditModalSubmit","onEditOptionModalLoaded","getPrevNext"),!this.slug||!this.keepId)throw new Error("Missing id or slug");this.inApp?(_.extend(this,kp.views.PageModalMixin),document.title=e.title||"Loading",kp.router.navigate(this.url),kp.IOS.hasSupport()&&kp.iosView.render(this.url),this.render(),$.ajax({url:this.url,cache:!1,headers:{"X-PJAX":"true"}}).done(this._onContentLoaded),this.cainejqXHR=$.ajax({url:"/keep/"+this.keepId+"/caine"}),this.collectionjqXHR=$.ajax({url:"/keep/"+this.keepId+"/collection"}),this.commentjqXHR=$.ajax({url:"/keep/"+this.keepId+"/comments"})):this._setupComponents()},onCollectionCardClick:function(){kp.track.counter("click:also_kept_into_collection",!0)},onOriginClick:function(){kp.track.counter("click:more_from_source",!0)},onBuyButtonClick:function(e){if(kp.config.user.isAuthenticated){if($(e.target).hasClass("webcart")){var t={},n=$(e.target).parents(".k_desc").find(".scd-options select"),i=n.eq(0).parent(".scd-options"),o=n.eq(1).parent(".scd-options"),a=i.find("option:selected").attr("value"),r=o.find("option:selected").attr("value"),s=i.data("category")||"",l=o.data("category")||"";if(i.length&&"undefined"==typeof a)return this._showOptionsError(s,i),!1;if(o.length&&"undefined"==typeof r)return this._showOptionsError(l,o),!1;"undefined"!=typeof s&&"undefined"!=typeof a&&(t.choice_one=s+": "+a),"undefined"!=typeof l&&"undefined"!=typeof r&&(t.choice_two=l+": "+r),t.product_id=this.productId,t.context_keep_id=this.keepId,$.ajax({url:"/service/1.0/cart/add_to_cart",context:this,data:t,type:"POST"}).done(function(e){var t=$(e);$(window).width()>750?($("body").append(t),t.modal("show"),t.on("click",".cart_modal_keep_shopping",function(e){e.preventDefault(),t.modal("hide")})):(t=$("#cart-mobile-modal"),t.modal("show"),t.on("click",".icon-close-x",function(e){e.preventDefault(),t.modal("hide")}));var n=parseInt(this.$cartCount.text()),i=n+1;this.$cartCount.text(i),0===n&&this.$cartCount.parent().addClass("show")})}var c=this.$el.data("contest");kp.track.info("click:buy",{source:"button",content:c},!0)}},onImageClick:function(){var e=this.$el.data("contest");kp.track.info("click:buy",{source:"image",content:e},!0)},_onContentLoaded:function(e){var t=$($.parseHTML(e)),n=t.find(".k_full_img");document.title=t.filter("title").text(),kp.router.navigate(this.url,{replace:!0}),kp.session.add(this),this.detailImgLow&&(this.preloadImg(n,n.attr("src")),n.attr("src",this.detailImgLow)),this.setElement(t.find("."+this.className)),this.pageModalMixinComplete(),this._setupComponents()},render:function(){this.inApp&&($("body").append(this.pageModalMixinRender()),this.pageModalMixinFadein())},remove:function(){this.grid&&this.grid.remove(),this.comment.remove(),this.editKeep&&this.editKeep.remove(),this.reportIssue&&this.reportIssue.remove(),Backbone.View.prototype.remove.call(this)},_setupComponents:function(){var e=this;this.imgUrl=this.$(".k_desc_img img").attr("src"),this.infoEl=this.$(".k_desc"),this.imgName=this.$(".k_desc_title").html(),this.productId=this.$el.data("product_id"),this.contestId=this.$el.data("contest_id");var t=new kp.views.keep.ActionsTaken({keep_ids:[this.keepId],show_counts:!0,product_id:this.productId});kp.config.user.isAuthenticated?t.getAllActionsTaken():(t.getCachedTotalKeeps(),t.getCachedSentimentScore()),this.commentjqXHR?this.commentjqXHR.done(function(t){e.$(".k_comments_list").append(t),e.loadComments()}):this.loadComments(),this.collectionjqXHR&&this.collectionjqXHR.done(function(t){e.$(".k_collection_container").append(t)}),this.cainejqXHR?this.cainejqXHR.done(function(t){e.$(".k_related_keeps").append(t),e.loadGrid()}):this.loadGrid(),this.$(".k_edit").length&&(this.editKeep=new kp.views.keep.EditKeep({el:this.$(".k_edit")[0]})),kp.image.pollForImageReady.scan(),kp.price.pollForPrice.scan(),new kp.views.FacebookFriendList({el:this.$(".kp-facebook_friend_list"),productTitle:this.imgName}),this.checkIfPrevNextDisabled()},checkIfPrevNextDisabled:function(){$(this.prevEl).length||this.$(".go_to_previous").addClass("disabled"),$(this.nextEl).length||this.$(".go_to_next").addClass("disabled")},onReportIssue:function(e){e.preventDefault(),this.reportIssue||(this.reportIssue=new kp.views.keep.ReportIssue({productId:this.$el.data("product_id")})),this.reportIssue.render()},loadComments:function(){this.comment=new kp.views.keep.Comment({el:this.$(".k_comments")[0],keepId:this.keepId,productId:this.productId})},loadGrid:function(){var e=this.$(".post-grid");e.length&&(this.grid=new kp.views.grid({el:e[0],colWidth:212}))},loadNewImage:function(e){var t=$(e.currentTarget),n=t.data("fullimage");if(n&&"None"!==n)this.swapProductImage(n);else{var i=$(e.currentTarget).attr("data-id");this.getFullImage(i,$(e.currentTarget))}t.hasClass("k_thumb")&&(this.$(".k_thumb").removeClass("hot"),t.addClass("hot"))},preloadImg:function(e,t){var n=document.createElement("img");$(n).load(function(){e.attr("src",t)}),n.src=t},getFullImage:function(e,t){var n=this,i={id:e,size:"large"};$.ajax("/service/1.0/image/is_ready_for_prime_time",{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({bundles:[i]})}).done(function(e){if(e&&e.length){var i=e[0].details.url;t.data("fullimage",i),n.swapProductImage(i)}})},swapProductImage:function(e){var t,n=this.$(".k_full_img"),i=this.$(".k_desc_img"),o=$.Deferred(),a=$.Deferred();i.height(i.height()),n.addClass("fadeout"),t=n.clone(),t.attr("src",e),$.when(o,a).done(function(){t.removeClass("fadeout"),i.height("auto")}),t.on("load",function(){a.resolve()}),setTimeout(function(){n.replaceWith(t),o.resolve()},500)},setupRekeep:function(e){var t=this;if(e.preventDefault(),kp.config.user.isAuthenticated&&"disabled"!==e.target.getAttribute("disabled")){$(e.target).hasClass("caine-size")&&(this.infoEl=$(e.target).parents(".post"),this.imgUrl=this.infoEl.find(".i").attr("src"),this.imgName=this.infoEl.find(".product-name"));var n=this.infoEl.data("id"),i=t.contestId?"contest":"keep";kp.initializedViews.rekeepView||(kp.initializedViews.rekeepView=new kp.views.rekeep({$el:$("#rekeep_modal")})),kp.initializedViews.rekeepView.showModal(n,{imgUrl:t.imgUrl,contestId:t.$el.data("contest_id"),imgName:t.imgName,source:"detail",content:i}).done(function(){var e=t.$(".detail-keep .count");e.text(parseInt(e.text(),10)+1)}),kp.track.info("click:rekeep",{source:"detail",content:i})}},onEditOptionClick:function(){$.ajax(this.url+"set_options/modal/").done(this.onEditOptionModalLoaded)},onMarkForReviewClick:function(e){e.preventDefault(),$(e.currentTarget).attr("disabled","disabled"),$.ajax({url:this.url+"mark_for_review/",type:"POST"})},onEditOptionModalLoaded:function(e){this.$editOptionsModal=$($.parseHTML(e)),$("body").append(this.$editOptionsModal),this.$editOptionsModal.modal("show"),this.$editOptionsModal.on("submit",this.onEditModalSubmit)},onEditModalSubmit:function(e){var t=$(e.currentTarget),n=this.$editOptionsModal.find("form");e.preventDefault(),$.ajax({url:this.url+"set_options/",type:"POST",dataType:"json",data:n.serialize(),context:this}).done(function(e){t.off(),t.modal("hide"),this.$(".opt_group[data-option-type=description] .body").html(e.description),_.each(["size","color"],function(t){this.$(".opt_group[data-option-type="+t+"] ul").html(_.reduce(e[t],function(e,t){return e+"<li>"+t+"</li>"},""))},this),window.location=""})},getPrevNext:function(e){37===e.which?this.goToPreviousKeep():39===e.which&&this.goToNextKeep()},goToPreviousKeep:function(){for($(".k_desc_arrow").hide();!$(this.prevEl).hasClass("post");){if(!$(this.prevEl).prev(".post").length)return;this.prevEl=$(this.prevEl).prev()}if(this.prevEl.length){var e=this.prevEl.find(".hit"),t=e.attr("href").split("/");new kp.views.keep.Detail({urlArgs:[t[1],t[3]],inApp:!0,detailImgLow:this.prevEl.find(".i").attr("src"),title:e.text()+" | Keep.com",nextEl:this.prevEl.next()||null,prevEl:this.prevEl.prev()||null})}},goToNextKeep:function(){for($(".k_desc_arrow").hide();!$(this.nextEl).hasClass("post");){if(!$(this.nextEl).next(".post").length)return;this.nextEl=$(this.nextEl).next()}if(this.nextEl.length){var e=this.nextEl.find(".hit"),t=e.attr("href").split("/");new kp.views.keep.Detail({urlArgs:[t[1],t[3]],inApp:!0,detailImgLow:this.nextEl.find(".i").attr("src"),title:e.text()+" | Keep.com",nextEl:this.nextEl.next()||null,prevEl:this.nextEl.prev()||null})}},closeAppCallout:function(e){$(e.target).parent().addClass("fade").slideUp(),kp.util.setCookie("hide-appcallout",1,this.oneMonth)},trackFollow:function(e){$(e.target).parents(".top").length?kp.track.info("click:follow",{source:"top"}):kp.track.info("click:follow",{source:"bottom"})},_showOptionsError:function(e,t){alert("You need to select a "+e.toLowerCase()+" first"),t.addClass("error"),setTimeout(function(){t.removeClass("error")
},500)}})}(),function(){kp.views.keep.EditKeep=Backbone.View.extend({events:{click:"showModal"},showModal:function(){var e=this,t=e.$el.parents(".kp-view").data("keep_id");$.ajax({url:"/service/1.0/keep/get_edit_modal",data:{keep_id:t}}).done(function(t){$("body").append(t),e.$modalEl=$("body").find("#edit_keep_modal"),e.$modalEl.modal("show"),e.$modalEl.on("click",".icon-close-x",function(){e.hideModal()})})},hideModal:function(){this.$modalEl.modal("hide")},remove:function(){this.$modalEl&&this.$modalEl.length&&(this.$modalEl.off(),this.$modalEl.remove()),Backbone.View.prototype.remove.call(this)}})}(),function(){kp.views.keep.ReportIssue=Backbone.View.extend({templateDfd:null,events:{"submit form":"onSubmit","click .close-modal-container":"hideModal"},initialize:function(e){this.productId=e.productId},render:function(){var e=this;return this.getModalTemplate().then(function(){e.$el.modal("show")}),this},onSubmit:function(e){e.preventDefault();var t=this,n=this.$("#flag_reason").val();$.ajax({method:"POST",url:"/product/"+this.productId+"/flag/"+n+"/",success:function(){t.hideModal()}})},getModalTemplate:function(){var e=this,t=$("body");return this.templateDfd||(this.templateDfd=$.ajax({url:"/service/1.0/keep/report_issue_modal"}).then(function(n){t.append(n),e.setElement(t.find("#report_issue_modal")[0])})),this.templateDfd},hideModal:function(){this.$el.modal("hide")}})}(),function(){kp.views.keep.Comment=Backbone.View.extend({events:{"click .k_comments_more":"moreOrLessComments","mouseenter .k_owned_comment_body":"onCommentMouseover","mouseleave .k_owned_comment_body":"onCommentMouseleave","click .k_delete_comment_btn":"deleteComment","mousedown .k_comment_wrapper":"showAddCommentBox","click .btn-cancel":"hideAddCommentBox","submit .k_comment_form":"onAddFormSubmit","click #modal_image_upload .close":"onCancelUpload"},keepId:null,productId:null,minCommentLength:1,maxCommentLength:500,maxProgressPercent:0,uploadDeferred:null,uploadCancelled:!1,initialize:function(e){this.keepId=e.keepId,this.productId=e.productId,this.atMentionView=new kp.views.user.atMention({el:this.$(".k_comment_wrapper")[0]}),_.bindAll(this,"onFileAdded","onFileUploaded","uploadAndProgressDone","_onCommentsLoaded","_onCommentAdded","disableAddForm","enableAddForm"),this.$formEl=this.$(".k_comment_form"),this.numComments=this.$el.data("num_comments"),this.numCommentsVisible=this.$(".k_comment").length,this.originalCommentsVisibleCnt=this.numCommentsVisible,this.numCommentsVisible&&this.numCommentsVisible<this.numComments&&(this.updateNumComments(),this.$(".k_comments_more").removeClass("hide")),this.hasPlaceholderSupport=kp.form.placeholderPolyfill.init(this.$formEl),this.contributionValidator=new kp.form.validator({minLength:this.minCommentLength,maxLength:this.maxCommentLength,noHTML:!0}),this.setupImageUpload()},remove:function(){kp.form.placeholderPolyfill.remove(this.$formEl),this.atMentionView.remove(),Backbone.View.prototype.remove.call(this)},onAddFormSubmit:function(e){var t,n,i,o,a=this.$formEl.find(".k_comment-body");return e.preventDefault(),this._formIsSubmitting?!1:(this.disableAddForm(),a.val(decodeURIComponent(this.atMentionView.processCommentText())),t=this.$formEl.find("textarea").val(),n=this.$formEl.find("[name=temp_image_id]").val(),t.length&&!1===this.contributionValidator.validate(t)?(i=this.contributionValidator.errors(),o=i.minLength?"Your comment must have at least "+this.minCommentLength+" characters":i.maxLength?"Your comment cannot be longer than "+this.maxCommentLength+" characters":i.noHTML?"Your comment cannot contain HTML":"An unknown error has occured",kp.flashMessage.error(o),void this.enableAddForm()):t.length||n.length?void $.ajax({url:"/service/1.0/keep/comment",method:"POST",dataType:"json",data:this.$formEl.serializeArray()}).then(this._onCommentAdded).then(this.enableAddForm):(kp.flashMessage.error("Your comment needs some text or an image"),void this.enableAddForm()))},disableAddForm:function(){this._formIsSubmitting=!0,this.$(".btn").addClass("disabled")},enableAddForm:function(){this._formIsSubmitting=!1,this.$(".btn").removeClass("disabled")},_onCommentAdded:function(e){var t,n,i,o=new $.Deferred;return e.error?(kp.flashMessage.error("There was a problem adding your comment, please try again"),void this.$(".btn").removeClass("disabled")):(t=this.$formEl.find("textarea").val(),n=this.$formEl.find("[name=temp_image_id]").val(),i=t.length?n.length?"text_and_image":"text":"image",kp.track.info("submit:create_comment",{media_type:i}),$($.parseHTML(e.body)).prependTo(this.$(".k_comments_list")).hide().slideDown(400,function(){o.resolve()}),this.hideAddCommentBox(),this.$formEl.find(".k_img_preview").css("background-image","").removeClass("show"),this.numCommentsVisible+=1,this.numComments+=1,this.updateNumComments(),o.promise())},showAddCommentBox:function(){return this._formIsSubmitting?!1:void this.$el.addClass("add_comment")},hideAddCommentBox:function(e){e&&e.stopPropagation(),this.$el.removeClass("add_comment"),this.atMentionView.addPlaceholder(),this.$formEl.find(".k_img_preview").css("background-image","").removeClass("show"),this.$formEl.find("#temp_image_id").attr("value",""),this.$(".k_comment_input").blur()},updateNumComments:function(){this.$(".displayed_comment_count").text(this.numCommentsVisible),this.$(".total_comment_count").text(this.numComments)},grabUploadHTML:function(){return this.uploadModalDeferred?this.uploadModalDeferred:(this.uploadModalDeferred=$.ajax({url:"/service/1.0/comment/get_upload_modal"}),this.uploadModalDeferred)},setupImageUpload:function(){var e=this;this.$formEl.fileupload({url:"/previews/upload",paramName:"file",dataType:"json",formData:{product_id:this.productId,keep_id:this.keepId},add:this.onFileAdded,done:this.onFileUploaded,progressall:function(t,n){e.maxProgressPercent=parseInt(n.loaded/n.total*100,10)}})},onCancelUpload:function(){this.uploadCancelled=!0,kp.track.info("analytics:show_and_tell:image_upload:cancel",{product_id:this.productId,keep_id:this.keepId}),this.uploadDeferred.reject()},onFileAdded:function(e,t){var n=this;this.grabUploadHTML().done(function(e){$("body").append(e),n.$progEl=$("#modal_image_upload"),n.$progEl.find(".curr-upload").show(),n.$progEl.find(".error").hide(),n.$progEl.modal("show");var i=n.startProgressBar();n.maxProgressPercent=0,n.uploadDeferred=new $.Deferred,n.uploadPromise=n.uploadDeferred.promise(),$.when(i,n.uploadPromise).done(n.uploadAndProgressDone).fail(function(){kp.track.error("analytics:comment:upload",{product_id:n.productId,keep_id:n.keepId})}),t.submit()})},uploadAndProgressDone:function(e,t){var n=this.$progEl.find(".error");if(!this.uploadCancelled&&t.result){if(n.hide(),this.$progEl.find(".curr-upload").hide(),t.result.error)return n.html(t.result.error),void n.show();this.$(".k_img_preview").css("background-image",'url("'+t.result.url+'")').addClass("show"),this.$("[name=temp_image_id]").attr("value",t.result.temp_id),this.$progEl.modal("hide")}},onFileUploaded:function(e,t){this.maxProgressPercent=100,this.uploadDeferred.resolve(t)},startProgressBar:function(){var e=new $.Deferred,t=this.$progEl.find(".bar"),n=this,i=0;t.css("width",0);var o=setInterval(function(){i<=n.maxProgressPercent&&(i+=1,i>=100&&(clearInterval(o),e.resolve()),t.css("width",i+"%"))},30);return e.promise()},moreOrLessComments:function(e){var t=this;e.preventDefault(),this.numCommentsVisible>=this.numComments?(this.$(".comments_view_more").removeClass("hide"),this.$(".comments_view_less").addClass("hide"),this.$(".k_comment").filter(function(e){return e>=t.originalCommentsVisibleCnt}).remove(),this.numCommentsVisible=this.originalCommentsVisibleCnt,this.updateNumComments()):$.getJSON("/service/1.0/comment/mget_by_product",{product_id:this.productId,offset:this.numCommentsVisible,limit:15}).done(this._onCommentsLoaded)},_onCommentsLoaded:function(e){this.$(".k_comments_list").append(e),this.numCommentsVisible=this.$(".k_comment").length,this.updateNumComments(),this.numCommentsVisible>=this.numComments&&(this.$(".comments_view_more").addClass("hide"),this.$(".comments_view_less").removeClass("hide"))},deleteComment:function(e){var t=$(e.currentTarget).parents(".k_comment"),n=t.data("comment_id");$.ajax("/service/1.0/comment/delete",{type:"POST",dataType:"json",data:{comment_id:n}}),kp.animate.fadeOut(t,{remove:!0}),this.numCommentsVisible-=1,this.numComments-=1,this.updateNumComments()},onCommentMouseover:function(e){$(e.currentTarget).find(".k_delete_comment_btn").fadeIn(200)},onCommentMouseleave:function(e){$(e.currentTarget).find(".k_delete_comment_btn").fadeOut(200)}})}(),kp.views.keep.contestModal=function(){function e(){$(".contest-modal-twitter-btn").on("click",i),$(".contest-modal-fb-btn").on("click",o),$(".contest-modal-pin-btn").on("click",a),$(".close-contest-modal, .modal-backdrop, .modal-close-text").on("click",n),$(".contest-modal-email-form").on("submit",t),$(".contest-modal-email-form .icon-arrow-right").on("click",t)}function t(e){e.preventDefault();var t=$(".contest-modal-email-input"),n=t.val();n.length&&$.post("/service/1.0/share/email",{email:n,is_contest:!0,outland_id:c}).done(function(){t.val("")}),s("share-email"),kp.track.counter("submit:contest_email")}function n(){$(".contest-modal").modal("hide"),$(".contest-modal, .modal-backdrop").remove()}function i(){kp.trigger("contestModal.tweet",c),s("share-twitter")}function o(){kp.trigger("contestModal.fb-share",c),s("share-facebook")}function a(){kp.trigger("contestModal.pin-share",c),s("share-pinterest")}function r(e){var t;e=e||1,t=1===e?"1 entry!":e+" entries!",$(".contest-modal-header").text("You now have "+t),$(".contest-modal-copy").text("Want more? Keep sharing!")}function s(e,t){return t&&(c=t),$.ajax({url:"/service/1.0/contest/enter_contest",data:{keep_id:c,source:e},success:function(t){"share"===e.substring(0,5)&&r(t.msg.num_entries)}})}function l(t,n){c=n,$.ajax("/contest-modal/"+t+"/").then(function(n){var i=$($.parseHTML(n));$("body").append(i),$(".contest-modal").modal("show"),kp.track.info("view:contest",{contest_id:t}),e()})}var c;return{show:l,registerEntry:s}}(),function(){kp.views.keep.ActionsTaken=Backbone.View.extend({initialize:function(e){this.keep_ids=e.keep_ids||[],this.show_counts=e.show_counts||!1,this.show_score=e.show_score||!1,this.cached_total_keeps=0,this.cached_sentiment_score=0,this.productId=e.product_id||null},getAllActionsTaken:function(){var e=this;$.ajax("/service/1.0/keep/get_all_actions_taken",{dataType:"json",data:{keep_ids:JSON.stringify(this.keep_ids),show_counts:this.show_counts}}).done(function(t){for(var n=t.length,i=0;n>i;i++){var o=$('div[data-id="'+t[i].keep_id+'"]');if(e.cached_total_keeps=t[i].cached_total_keeps,e.cached_sentiment_score=t[i].cached_sentiment_score,t[i].kept&&o.find(".keep").addClass("kept"),t[i].liked&&o.find(".like").addClass("active"),e.show_counts){var a=o.find(".keep_count"),r=o.find(".like_count");a.find(".count_int").html(e.cached_total_keeps),r.find(".count_int").html(e.cached_sentiment_score),a.fadeIn(300),r.fadeIn(300)}e.show_score&&e.getCombinedScore(o)}})},checkIfKept:function(){$.ajax("/service/1.0/keep/get_already_kept",{type:"POST",dataType:"json",data:{keep_ids:JSON.stringify(this.keep_ids)}}).done(function(e){for(var t=e.length,n=0;t>n;n++){var i=$('div[data-id="'+e[n]+'"]');i.find(".keep").addClass("kept").html("Kept")}})},checkIfLiked:function(){$.ajax("/service/1.0/keep/get_already_liked",{type:"POST",dataType:"json",data:{keep_ids:JSON.stringify(this.keep_ids),show_counts:this.show_counts}}).done(function(e){for(var t=e.length,n=0;t>n;n++){var i=$('div[data-id="'+e[n]+'"]');i.find(".like").addClass("active")}})},getCachedSentimentScore:function(){var e=this;$.ajax("/service/1.0/keep/get_cached_sentiment_score",{type:"POST",dataType:"json",data:{product_id:this.productId}}).done(function(t){e.cached_sentiment_score=t,$(".kp-view .like_count .count_int").html(e.cached_sentiment_score),$(".kp-view .like_count").fadeIn(300)})},getCachedTotalKeeps:function(){var e=this;$.ajax("/service/1.0/keep/get_cached_total_keeps",{type:"POST",dataType:"json",data:{product_id:this.productId}}).done(function(t){e.cached_total_keeps=t,$(".kp-view .keep_count .count_int").html(e.cached_total_keeps),$(".kp-view .keep_count").fadeIn(300)})},getCombinedScore:function(e){var t=this.cached_total_keeps+this.cached_sentiment_score;e.find(".score_count").html(t)},updateScore:function(e,t){var n=parseInt(e.find(".score_count").html());"like"===t?e.find(".score_count").html(e.find(".like").hasClass("active")?n-1:n+1):"keep"===t&&e.find(".score_count").html(e.find(".keep").hasClass("kept")?n-1:n+1)},updateStateInGrid:function(e,t){"like"===t?e.find(".like").toggleClass("active"):"keep"===t&&e.find(".keep").toggleClass("kept")}})}(),kp.views.collection={},kp.views.collection.edit=function(){function e(){var e=$(".delete-frm"),t=$("#delete_collection_modal"),n=!1;e.on("submit",function(e){e.preventDefault(),t.modal("show")}),t.on("click",".btn-submit",function(i){return i.preventDefault(),n?!1:(n=!0,t.find(".btn").attr("disabled","disabled"),void $.ajax({url:"/service/1.0/collection/delete",type:"POST",data:e.serialize()}).done(function(){window.location=e.data("user-collections")}))})}return{init:e}}(),kp.views.auth={},function(){kp.views.auth.Modal=Backbone.View.extend({events:{"click [data-auth-required]":"onAuthReqClick","click .close-authentication-modal, .modal-backdrop":"closeModal","hidden.bs.modal #modal_authentication":"onModalHidden"},cache:[],isRoadblock:!1,initialize:function(){_.bindAll(this,"showFbFacepile")},onAuthReqClick:function(e){var t=e.currentTarget,n=t.getAttribute("data-auth-required");e.preventDefault(),e.stopImmediatePropagation(),this.showModal(n)},showFbFacepile:function(){this.$(".facepileDiv").show()},showModal:function(e){var t,n=this,i="login";e=e||"login_page",kp.config.auth.show_roadblock&&(this.isRoadblock=!0,i="roadblock",e=kp.config.auth.campaign||"hard_roadblock"),t=$.param({type:i,action:e}),this.cache.hasOwnProperty(t)||(this.cache[t]=$.ajax("/auth/modal",{data:t})),this.cache[t].then(function(t){var o=$($.parseHTML(t)),a="next="+encodeURIComponent(window.location.pathname)+"&amp;action="+e+"&amp;type="+i;o.find(".js-auth-ret-lnk").each(function(e,t){var n=-1!==t.href.indexOf("?")?"&amp;":"?";t.href+=n+a}),n.$(".auth-modal").remove(),n.$el.append(o),n.$("#modal_authentication").modal(n.isRoadblock?{backdrop:"static"}:"show")}),kp.facebook.init().done(this.showFbFacepile),this.trackLogin(e)},closeModal:function(){this.$("#modal_authentication").modal("hide")},onModalHidden:function(){this.$("#modal_authentication, .modal-backdrop").remove()},trackLogin:function(e){kp.track.info("analytics:login:open",{action:e})}})}(),kp.views.user={},kp.views.user.profile=function(){function e(){i=kp.config.pageUser.username;var e=i===kp.config.user.username?"self":"others";t(),$(".user-card-list").length&&new kp.infiniteScroll({el:$(".user-card-list")[0],url:window.location.pathname,bufferPx:2e3,paginationSel:".next_page"});var o=$(".collection-grid");o.length&&(new kp.infiniteScroll({el:o[0],url:window.location.pathname,bufferPx:2e3,paginationSel:".next_page"}),i===kp.config.user.username&&n()),kp.track.info("view:collections",{observing:e})}function t(){var e,t=!1;kp.config.user.username===i?(t=!0,e=$("#user_meta .num_following")):e=$("#user_meta .num_followers"),kp.on("follow.update_counts",function(n){(t||n.target_user.username===i)&&e.fadeOut(400,function(){e.text(t?n.users_i_follow_count:n.target_user.users_following_me_count),e.fadeIn()})})}function n(){var e=$(".collection-create");e.length&&(e.on({click:function(){e.removeClass("hover").addClass("active").find("input").focus()}}),e.one({click:function(){kp.track.info("click:create_collection",{source:"user_profile"})}}),e.on("click",".close_btn",function(t){t.stopPropagation(),e.removeClass("hover active")}),kp.util.disableFormOnSubmit($(".collection-create-frm")),-1!==window.location.search.indexOf("error=1")&&e.trigger("click"))}var i;return{init:e}}(),kp.views.user.users=function(){function e(e){c=$.extend({},u,e),r=c.parentEl,l=c.itemWidth,s=c.offset,d.on("resize.postGrid",_.debounce(t,300)),o(),n(),new kp.infiniteScroll({el:r[0],totalPages:-1,url:"/users/",bufferPx:2e3,paginationSel:".next_page",onContentLoaded:i})}function t(){$(".avatar_link").css({top:"0","margin-left":"0"}),m=v=f=g=0,o()&&n(!0)}function n(e){var t=r.children(".avatar_link"),n=p;for(e&&t.addClass("reflowing"),h=[];n--;)h[n]=0;a(t),e&&setTimeout(function(){t.removeClass("reflowing")},400)}function i(e){a(e.filter(".avatar_link"))}function o(){var e=p;return r.width("auto"),p=v=Math.floor(r.width()/(l+s)),r.width(p*(l+s)-s),e!==p}function a(e){for(var t=g+e.length,n=0;t>g;g++,n++)g===v+f&&(f+=v,m+=1,v=v===p?p-1:p,m%2!==0&&$(e[n]).css({"margin-left":"37px"})),$(e[n]).css({top:-21*m+"px"})}var r,s,l,c,d=$(window),u={parentEl:$(".users-cont"),offset:4,itemWidth:70},h=0,p=0,f=0,m=0,v=0,g=0;return{init:e,add:i}}(),kp.views.user.hoverCard=function(){function e(){$("body").on("mouseenter",".enable-user-hovercard",t).on("mouseleave",".enable-user-hovercard",i),kp.router.on("navigate",s),kp.on("follow.update_counts",c)}function t(){var e=$(this);return h===e?void(f="on"):(u&&l(),clearTimeout(v),m&&m.reject(),p="off",f="on",h=e,d=h.data("username"),g.hasOwnProperty(d)||(g[d]=$.get("/u/"+d+"/hover")),m=new $.Deferred,v=setTimeout(function(){m.resolve()},k),void $.when(m,g[d]).done(function(){("on"===f||"on"===p)&&g[d].done(n)}))}function n(e){var t,n,i,r,l,c,d,p;return h?(t=h.offset(),n=h.height(),t.top&&t.left?(u=$($.parseHTML(e.trim())).on("mouseenter",o).on("mouseleave",a).addClass("on").appendTo(document.body),i=t.left,l=u.width(),d=w.width(),i+l>d&&(i=d-l-20),r=t.top+n+_,c=u.height(),p=w.height(),r+c>w.scrollTop()+p&&(r=t.top-c-_),void u.css({top:r,left:i})):void s()):void s()}function i(){f="off",setTimeout(r,500)}function o(){p="on"}function a(){p="off",setTimeout(r,500)}function r(){"off"===f&&"off"===p&&l()}function s(){u=null,h=null,d=null,f="off",p="off",clearTimeout(v),$(".user-hovercard").remove()}function l(){var e=$(".user-hovercard");e.length&&(e.removeClass("on"),d&&g[d]&&"resolved"===g[d].state()&&(g[d].responseText=e[0].outerHTML),s())}function c(e){var t=e.target_user;delete g[t.username],u&&u.hasClass("on")&&u.data("username")===t.username&&u.find(".user-card-count-follow").text(t.users_following_me_count)}var d,u,h,p,f,m,v,g=[],k=500,w=$(window),_=4;return{init:e}}(),kp.views.user.notifications=function(){function e(){var e,t,n=location.pathname;n=n.replace("//","/"),e=n.split("/"),t=parseInt(e[2],10)||1,1===t&&kp.views.user.notificationDropdown.setRead()}return{init:e}}(),kp.views.user.notificationDropdown=function(){function e(){var e;a=$(".notification-list"),r=$(".icon-notification");var t=a.prev(".gem");l=kp.util.getCookie("notif-count"),null!==l?n({count:l}):(e=$.ajax("/service/1.0/timeline/get_new_count",{type:"POST",dataType:"json",data:{round:!0}}),e.done(n),e.done(function(e){kp.util.setCookie("notif-count",e.count,c)})),t.on("mouseenter",i),$(".notification-dropdown").on("mouseleave",function(){r.removeClass("active"),a.removeClass("show-drop-list").fadeOut(200)})}function t(){$.ajax("/service/1.0/timeline/set_checked",{type:"POST",data:"{}"}).done(function(){kp.util.setCookie("notif-count",0,c)})}function n(e){0!==parseInt(e.count,10)&&($(".notif-count").text(e.count),$(".notif-gem-background, .notif-wrapper").fadeIn("slow",function(){$(this).delay(200).addClass("bounce")}))}function i(){s||(s=!0,$(".notification-items").load("/components/notification-dropdown",o),t(),kp.track.info("hover:timeline_dropdown",{state:"viewing"})),kp.trigger("header.dropdown-open","notification-list"),kp.track.info("hover:timeline_dropdown",{state:"rendered"}),r.addClass("active"),a.addClass("show-drop-list")}function o(e){0===e.trim().length&&a.addClass("no-new"),$(".notif-spinner").remove()}var a,r,s=!1,l=null,c=3e5;return{init:e,setRead:t}}(),function(){kp.views.user.atMention=Backbone.View.extend({searchUrl:"/service/1.0/user/search",prefetchUrl:"/service/1.0/user/mention_prefetch",usernameMatchUrl:"/service/1.0/user/mget_by_username",cache:{},mentionRegex:/(.*)@([\w\-\.]+)$/,wasMenuClick:!1,MAX_SHOWN:10,placeholder:'<span class="k_placeholder">@mention or comment</span>',prefetchUsers:null,prefetchDfd:null,key:{DOWN_ARROW:40,UP_ARROW:38,TAB:9,ENTER:13,BACKSPACE:8},userHTML:'<li class="at-mention-item" data-username="<%= username %>" data-fb-id="<% if (facebook_id) { %><%= facebook_id %><% } else { %><% } %>" data-user-id="<% if (user_id) { %><%= user_id %><% } else { %><% } %>"><% if (avatar_url) { %><svg class="avatar" width="26" height="30" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><g><clipPath id="comment-at-mention-typeahead-mask-<%= username %>"><polygon points="13,0 26,7 26,22 13,30 0,22 0,7" /></clipPath></g><image clip-path="url(#comment-at-mention-typeahead-mask-<%= username %>)" width="26" height="30" xlink:href="<%= avatar_url %>" preserveAspectRatio="xMidYMin slice" /></svg><% } else if (facebook_id && !user_id) { %><div class="avatar mention-facebook-icon"></div><% } else { %><%= color_svg_avatar %><% } %><div class="text fullname"><%= name %></div><div class="text username"><%= username %></div></li>',events:{"focus .at-mention":"getPrefetchDataAndProcessText","keydown .at-mention":"keydown","keyup .at-mention":"keyup","paste .at-mention":"delayedHandlePaste","click .at-mention-item":"clickSelectUser","mousedown .at-mention-menu":"registerMenuClick"},initialize:function(){var e=document.createElement("ol"),t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("textarea");e.className="at-mention-menu",t.className="arrow",n.className="arrow-bg",e.appendChild(t),e.appendChild(n),this.$el.append(e),i.className="k_comment-body",i.name="description",this.$el.append(i),this.$menu=this.$el.find(".at-mention-menu"),this.$input=this.$el.find(".at-mention"),this.userTemplate=_.template(this.userHTML),this.addPlaceholder(),this.preventMenuClickBlur()},getPrefetchDataAndProcessText:function(){this.getPrefetchData(),this.processText()},delayedHandlePaste:function(e){var t=this;setTimeout(function(){t.handlePaste(e)},50)},keydown:function(e){if(this.$menu.hasClass("menu-active"))switch(e.keyCode){case this.key.TAB:case this.key.ENTER:e.preventDefault(),this.keySelectUser();break;case this.key.UP_ARROW:e.preventDefault(),this.shiftUser("prev");break;case this.key.DOWN_ARROW:e.preventDefault(),this.shiftUser("next")}},keyup:function(e){switch(e.preventDefault(),e.keyCode){case this.key.TAB:case this.key.ENTER:case this.key.UP_ARROW:case this.key.DOWN_ARROW:break;case this.key.BACKSPACE:this.checkTextForBrokenMentions(e);break;default:this.processText(e)}},processText:function(){var e=this.$input,t=e.html(),n=this.getMentionable(t);1===e.text().length&&1!==t.length&&(e.html(e.text()),t=e.html(),this.putCaretAtEnd()),t===this.placeholder&&(e.html(""),this.putCaretAtEnd()),n?this.getUsers(n).then(this.showMenu()):this.$menu.removeClass("menu-active")},checkTextForBrokenMentions:function(){var e,t,n,i,o,a,r,s,l=this.$input;if(0===l.text().length)return l.html(""),void this.processText();for(e=l.html().trim(),t=e.split(/(<a.*?<\/a>)/g),r=0,s=t.length;s>r;r++)"<a"===t[r].slice(0,2)&&(a=$(t[r]),a.length&&(n=a.attr("data-username"),i=a.text(),(i.length<=n.length||r===t.length-2&&""===t[t.length-1])&&(t[r]=i)));o=t.join(""),o!==e&&(l.html(o),this.putCaretAtEnd()),this.processText()},handlePaste:function(){var e=this;this.getPrefetchData().then(function(){var t,n,i,o,a,r=e.$input.html().split(/([^\s]+)/),s=[];for(a=0;a<r.length;a++)if(t=!1,/^@[\w\-\.]+$/.test(r[a])){for(o=0;o<e.prefetchUsers.length;o++)if(e.prefetchUsers[o].username===r[a].slice(1)){n=e.prefetchUsers[o],r[a]=e.getMentionLink(n),t=!0;break}t||s.push(r[a].slice(1))}s.length&&$.ajax({url:this.usernameMatchUrl,data:{usernames:s.join("+")},dataType:"json",async:!1}).then(function(t){t.users&&t.users.length&&e.findAndReplaceDataUsers(t.users,r)}),i=r.join(""),e.$input.html(i+"&nbsp;"),e.putCaretAtEnd(),e.$input.scrollTop(e.el.scrollHeight),e.$menu.removeClass("menu-active"),e.checkTooManyMentions()})},findAndReplaceDataUsers:function(e,t){var n,i,o;for(n=0;n<t.length;n++)if(/^@[\w\-\.]+$/.test(t[n]))for(i=0;i<e.length;i++)if(e[i].username===t[n].slice(1)){o=e[i],t[n]=this.getMentionLink(o);break}},getMentionLink:function(e){var t=e.username,n=e.facebook_id||"",i=e.user_id;return'<a class="at-mention-link" data-fb-id="'+n+'" data-user-id="'+i+'" data-username="'+t+'">@'+t+"</a>"},getMentionable:function(e){var t,n=$("<div>"+e+"</div>").text();return t=this.mentionRegex.exec(n),t&&t[2]},getUsers:function(e){var t,n,i,o=new $.Deferred,a=this,r=[],s=function(){a.getNonPrefetchUsers(e,r).then(function(e){for(n=e.users,i=0;i<n.length;i++)n[i].name=n[i].fname+" "+(n[i].lname||"");r=r.concat(n),o.resolve(r)})};return this.getPrefetchData().done(function(){t=a.getPrefixMatchRegExp(e),r=a.findUsersInPrefetch(t),r.length===a.MAX_SHOWN?o.resolve(r):s()}),o.promise()},findUsersInPrefetch:function(e){for(var t=0,n=this.prefetchUsers.length,i=[],o=0;t<this.MAX_SHOWN&&n>o;o++)e.test(this.prefetchUsers[o].name)&&(i.push(this.prefetchUsers[o]),t++);return i},getNonPrefetchUsers:function(e,t){var n,i=[],o=t.length,a=0;if(this.cache[e])n=this.cache[e];else{for(;o>a;a++)t[a].user_id&&i.push(t[a].user_id);i=i.join("+"),n=$.ajax({url:this.searchUrl,data:{q:e,ids:i,max_users:this.MAX_SHOWN-o},dataType:"json"}),this.cache[e]=n}return n},showMenu:function(){var e=this;return function(t){var n;e.clearMenu(),t.length?(n=e.buildUserResults(t),e.$menu.append(n),e.$menu.addClass("menu-active")):e.$menu.removeClass("menu-active")}},buildUserResults:function(e){var t,n,i,o,a,r=document.createDocumentFragment(),s=document.createElement("div");for(a=0,o=e.length;o>a;a++)i=e[a],i.img&&i.img.navatar_hex&&i.img.navatar_hex.url?i.avatar_url=i.img.navatar_hex.url:(i.avatar_url=null,i.color_svg_avatar=kp.views.user.colorHexagon.getHexSVG(i.svg_color_hexagon,30,26)),i.facebook_id||(i.facebook_id=null),t=this.userTemplate(i),s.innerHTML=t,n=s.firstChild,r.appendChild(n);return r},clickSelectUser:function(e){var t=$(e.target),n=t.hasClass("at-mention-item")?t:t.parent();this.selectUser(n)},keySelectUser:function(){var e=this.$menu.find(".at-mention-item"),t=this.$menu.find(".active");e.length&&(t.length||(t=e.eq(0)),this.selectUser(t))},selectUser:function(e){var t,n,i,o,a,r,s;s=e.attr("data-username"),a=e.attr("data-fb-id"),r=e.attr("data-user-id"),t=this.$input.html().replace("<br>",""),n=this.mentionRegex.exec(t),o='<a class="at-mention-link" data-fb-id="'+a+'" data-user-id="'+r+'" data-username="'+s+'">@'+s+"</a>",i=n[1]+o+"&nbsp;",this.$input.html(i),this.putCaretAtEnd(),this.$input.scrollTop(this.$input[0].scrollHeight),this.$menu.removeClass("menu-active"),this.checkTooManyMentions()},checkTooManyMentions:function(){this.$input.find("a[data-fb-id]").length>10&&kp.flashMessage.error("You can only send up to 10 Facebook friend @mentions in a single comment! Those friends over the limit won't get notified.")},shiftUser:function(e){var t,n,i=this.$menu.find(".at-mention-item");i.length&&(this.$menu.find(".active").length?(t=this.$menu.find(".active").eq(0),t.removeClass("active"),n="next"===e?this.getNext(t):this.getPrev(t)):n="next"===e?i.first():i.last(),n.addClass("active"))},getNext:function(e){var t=e.next(".at-mention-item");return t.length||(t=e.parent().children(".at-mention-item").first()),t},getPrev:function(e){var t=e.prev(".at-mention-item");return t.length||(t=e.parent().children().last()),t},preventMenuClickBlur:function(){$(window).on("mousedown",function(){this.wasMenuClick=!1})},registerMenuClick:function(e){e.stopPropagation(),this.wasMenuClick=!0},hideMenu:function(){return""===this.$input.text()?void this.addPlaceholder():void(this.wasMenuClick||(this.$menu.removeClass("menu-active"),this.$el.parent().parent().parent().parent().css("overflow","hidden")))},addPlaceholder:function(){this.$input.html(this.placeholder)},clearMenu:function(){this.$menu.find(".at-mention-item").remove()},getPrefixMatchRegExp:function(e){var t;return 1===e.length?new RegExp("\\b"+e+"[a-zA-Z]+\\b","i"):(t=e.replace(/\s/g,"").split("").join("\\s*"),new RegExp("(^"+t+")|(\\b"+e+")","i"))},putCaretAtEnd:function(){this.$input[0].focus();var e=document.createRange(),t=window.getSelection();e.selectNodeContents(this.$input[0]),e.collapse(!1),t.removeAllRanges(),t.addRange(e)},getPrefetchData:function(){var e=this;return this.prefetchDfd?this.prefetchDfd:(this.prefetchDfd=$.ajax({url:this.prefetchUrl,dataType:"json"}),void this.prefetchDfd.done(function(t){e.prefetchUsers=t.data}))},processCommentText:function(){var e,t,n,i,o;return t=this.$input.html().replace("&nbsp;"," ").trim(),e=$(t!==this.placeholder?"<div>"+t+"</div>":""),e.find("a").each(function(){n=$(this).attr("data-user-id")?$(this).attr("data-username")+":"+$(this).attr("data-user-id"):"fb:"+$(this).text().slice(1)+":"+$(this).attr("data-fb-id"),$(this).text("@"+n)}),i=encodeURIComponent(e.text().trim()),o=i.replace(/%C2%A0/g,"%20")}})}(),kp.views.user.colorHexagon=function(){function e(e,t,n){return'<svg class="avatar" width="'+n+'" height="'+t+'" viewBox="0 0 100 100" preserveAspectRatio="xMidYMin slice"><polygon style="fill: '+e[0]+'" points="50,0 50,50 93.5,25" /><polygon style="fill: '+e[1]+'" points="93.5,25 93.5,75 50,50"/><polygon style="fill: '+e[2]+'" points="50,100 50,50 93.5,75"/><polygon style="fill: '+e[3]+'" points="50,100 50,50 6.5,75"/><polygon style="fill: '+e[4]+'" points="6.5,25 6.5,75 50,50"/><polygon style="fill: '+e[5]+'" points="50,0 50,50 6.5,25"/></svg>'}function t(){var e=$("input[name=color_hexagon]").val();$(".refresh-button").on("click",function(){b(!1)}),e&&e.length?g(e):b(!0)}function n(){return Math.floor(360*Math.random())}function i(){return Math.floor(Math.random()*E+S)}function o(){return T}function a(e,t,n){return"hsla("+e+", "+t+"%, "+n+"%, "+I+")"}function r(){var e=n(),t=o(),a=i();return d(e,t,a)}function s(e){var t=(e.hue+A/2+180)%360;return d(t,e.sat,e.light)}function l(e){var t=(e.hue+A)%360;return d(t,e.sat,e.light)}function c(e){var t=S,n=E,i=(e.light-t+.5*n)%n+t;return d(e.hue,e.sat,i)}function d(e,t,n){return{hue:e,sat:t,light:n,alpha:I,hsla:a(e,t,n)}}function u(e){for(var t,n=[],i=e.length;i>=1;)t=Math.floor(Math.random()*i),n.push(e[t]),e.splice(t,1),i--;return n}function h(e,t,n){var i,o,a,r=u(e),s=u(t),l=u(n),c=u([r,s,l]),d=[];for(i=0;i<c.length;i++)for(o=0;2>o;o++)d.push(c[i][o]);return Math.floor(2*Math.random())&&(a=d.shift(),d.push(a)),d}function p(e,t){var n=""+e;for(t=t||3;n.length<t;)n="0"+n;return n}function f(){return 100*I}function m(e){var t,n,i="";for(t=0;t<e.length;t++)n=e[t],i+=p(n.hue)+p(n.sat)+p(n.light)+p(f()),5>t&&(i+="+");$("input[name=color_hexagon]").val(i)}function v(e,t,n){var i=n||1;t?$(".tri-"+i).css({fill:e[i-1].hsla}):($(".tri-"+i).css({fill:"#fff"}),setTimeout(_.bind(function(){$(".tri-"+this.index).css({fill:e[this.index-1].hsla})},{index:i}),100)),6>i&&setTimeout(function(){v(e,t,++i)},100)}function g(e){var t,n,i,o=e.split("+"),a=[];for(t=0;6>t;t++)n=o[t],i=d(n.slice(0,3),n.slice(3,6),n.slice(6,9),n.slice(9)),a.push(i);v(a,!0)}function k(){var e;for(e=1;6>=e;e++)$(".tri-"+e).css("fill","rgba(0, 0, 0, 0)")}function w(){var e=r(),t=s(e),n=l(e),i=c(e),o=c(t),a=c(n),d=[e,i],u=[n,a],p=[t,o],f=h(d,u,p);return f}function b(e){var t=w();v(t,e),m(t)}function y(e){for(;"0"===e.charAt(0);)e=e.slice(1);return 1===parseInt(e,10)?"1":"."+e}function C(e){var t=e.slice(0,3),n=e.slice(3,6),i=e.slice(6,9),o=y(e.slice(9));return"hsla("+t+", "+n+"%, "+i+"%, "+o+")"}function x(t,n,i){t||(t="360100100001+360100100001+360100100001+360100100001+360100100001+360100100001");var o,a=t.split("+"),r=[];for(o=0;o<a.length;o++)r.push(C(a[o]));return e(r,n,i)}var T=53,E=30,S=60,A=60,I=.6;return{init:t,clearHex:k,getHexSVG:x}}(),kp.views.user.invite=function(){function e(){r=$(".invite-form-email"),s=r.find(".invite-form-emails"),l=r.find(".help-text"),kp.views.fb_invite.init(),t()
}function t(){d=kp.form.placeholderPolyfill,c=d.init(r),r.on("submit",function(e){e.preventDefault(),i()&&n()})}function n(){$.ajax({type:"POST",url:r.attr("action"),dataType:"json",data:{emails:u.join(",")}}).done(function(e){e.status?(kp.flashMessage.success("Invites sent!"),$(".invite-form-emails").val("").blur()):e.error&&(kp.flashMessage.error(e.error),$(".invite-form-emails").focus())}),kp.track.info("submit:invite",{method:"email",num_requests:u.length})}function i(){var e,t=!0;return a(),u=[],!1===c&&d.isElEmpty(s)?t=!1:(e=_.without(s.val().split(/[ ,]+/),""),t=_.every(e,function(e){return h.validate(e)})),t?u=e:o(),t}function o(){l.text(u.length<=1?"Please enter a valid email address":"Hm, one or more of these addresses appear to be invalid"),s.one("keydown",a)}function a(){l.text("")}var r,s,l,c,d,u=[],h=new kp.form.validator({minLength:5,maxLength:1e3,regex:/\S+@\S+\.\S+/});return{init:e}}(),kp.views.blog={},function(){kp.views.blog.Detail=Backbone.View.extend({events:{"click .recent_post":"moreFromKeep"},initialize:function(e){this.postId=e.urlArgs[1],kp.util.scriptLoad("//www.zergnet.com/zerg.js?id=19489");var t=this.$(".post-grid");t.length&&new kp.views.grid({el:t[0],url:window.location.pathname}),this.loadRecommended()},moreFromKeep:function(){kp.track.info("click:read_recommended")},loadRecommended:function(){var e=this.$(".recent_posts_thumbs");$.ajax("/service/1.0/blog/getRandomRecentPosts",{type:"POST",dataType:"json",data:{blog_post_id:this.postId}}).done(function(t){$.each(t,function(t,n){e.append('<a class="recent_post" href="'+n.url+'"><img src="'+n.img.more_from_keep.url+'" /><div class="recent_post_title">'+n.title+"</div></a>")})})}})}(),function(){kp.views.Cart=Backbone.View.extend({events:{"click .cart-items .delete":"onDeleteClick","change .qty-select":"onQuantitySelect","click .btn-checkout":"onClickCheckout","click .btn-place-order":"onClickPlaceOrder","change .checkout-details .select-saved":"onSavedChange","click #display-address .btn-cart.edit":"onAddressEditClick","click #display-address .btn-cart.delete":"onAddressDeleteClick","submit #add-address":"onAddressSubmit","click #display-card .btn-cart.delete":"onCardDeleteClick","submit #add-card":"onCardSubmit","click #display-contact-info .btn-cart.edit":"onContactInfoEditClick","submit #add-contact-info":"onContactInfoSubmit","click .out-of-stock-message .close":"closeOutOfStockMessage","click .row.promo-code .code-text":"onPromoCodeAddEditSave"},client:null,$cartContainer:null,$cartItems:null,$cartCount:null,$subtotal:null,$savedAddresses:null,$addAddressForm:null,$addAddressInputs:null,$displayAddressInfo:null,$savedCards:null,$addCardForm:null,$addCardInputs:null,$displayCardInfo:null,$addContactInfoForm:null,$displayContactInfo:null,$addressId:null,$billingId:null,$cardNum:null,$expiry:null,$cvv:null,$formError:null,$promoCodeInput:null,$promoCodeText:null,promoCode:null,requiredValidator:null,zipValidator:null,phoneValidator:null,specialCode:"FREESHIP11",initialize:function(){var e=this,t=this.$(".summary-wrapper");if(this.$cartContainer=this.$(".cart-container"),this.$cartItems=this.$(".cart-items"),this.$cartCount=$("#header-user").find(".cart-count"),this.$subtotal=this.$(".cart-subtotal").children(".amt"),this.$savedAddresses=this.$("#select-address"),this.$addAddressForm=this.$("#add-address"),this.$addAddressInputs=this.$addAddressForm.find(".faux-input"),this.$displayAddressInfo=this.$("#display-address"),this.$savedCards=this.$("#select-card"),this.$addCardForm=this.$("#add-card"),this.$addCardInputs=this.$addCardForm.find(".faux-input"),this.$displayCardInfo=this.$("#display-card"),this.$addContactInfoForm=this.$("#add-contact-info"),this.$displayContactInfo=this.$("#display-contact-info"),this.$addressId=this.$savedAddresses.children(":selected").data("address-id"),this.$paymentToken=this.$savedCards.children(":selected").data("payment-token"),this.$cardNum=this.$addCardInputs.filter(".card-number"),this.$expiry=this.$addCardInputs.filter(".expiry"),this.$cvv=this.$addCardInputs.filter(".cvv"),this.$formError=this.$(".form-error"),this.$promoCodeInput=this.$(".code-input"),this.$promoCodeText=this.$(".code-text"),this.$cardNum.payment("formatCardNumber"),this.$expiry.payment("formatCardExpiry"),this.$cvv.payment("formatCardCVC"),_.bindAll(this,"getClientToken"),t.length){var n=$(window);n.scroll(function(){n.scrollTop()>=91&&n.width()>940?t.addClass("fixed"):t.removeClass("fixed")}),n.resize(_.debounce(function(){n.width()<=940&&t.hasClass("fixed")&&t.removeClass("fixed")},200))}this.$addCardForm&&(kp.util.scriptLoad("https://js.braintreegateway.com/v2/braintree.js").done(this.getClientToken),this.loadBraintreeData()),this.requiredValidator=kp.form.validator({noHTML:!0,regex:/\w/}),this.zipValidator=kp.form.validator({minLength:5,noHTML:!0,regex:/[0-9]{5}/}),this.phoneValidator=kp.form.validator({minLength:10,noHTML:!0,regex:/[0-9]{5}/}),$("#phone").on("keyup",function(e){kp.util.formatPhone(e)}),$(".cart-container").on("focus keyup",".faux-input",function(e){$(this).hasClass("error")&&13!==e.keyCode&&$(this).removeClass("error").next(".input-error").removeClass("show")}),this.$promoCodeInput.on("keyup",function(t){13===t.keyCode&&e.onPromoCodeAddEditSave()}),this.checkForTruck(),$(".is-out-of-stock").length&&this.handleOutOfStockMessage()},onDeleteClick:function(e){var t=this,n=$(e.currentTarget),i=n.closest(".list-row"),o=i.data("product-id");$.ajax({url:"/service/1.0/cart/delete_cart_item",data:{product_id:o},type:"POST",context:this}).done(function(e){e.affected_rows?(i.slideUp(function(){i.remove(),t.$(".cart-items").children(".list-row").length||t.$cartContainer.addClass("cart-empty")}),i.data("quantity","0"),this.updateTotals()):alert("Something went wrong. Please try again shortly.")})},onQuantitySelect:function(e){var t=$(e.currentTarget),n=t.parents(".list-row"),i=n.data("product-id"),o=e.currentTarget.value;$.ajax({url:"/service/1.0/cart/update_cart_item",data:{quantity:o,product_id:i},type:"POST",context:this}).done(function(e){e.updates_made?(n.data("quantity",o),this.updateTotals()):alert("Something went wrong. Please try again shortly.")})},updateTotals:function(){var e=0,t=0;this.$cartItems.children().each(function(){if(!$(this).find(".is-out-of-stock").length){var n=parseInt($(this).data("price-cents")),i=parseInt($(this).data("quantity"));e+=n*i,t+=i}}),0===e&&$(".btn-checkout").addClass("disabled"),this.$subtotal.text("$"+(e/100).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")),0===t&&this.$cartCount.parent().removeClass("show"),this.$cartCount.text(t)},onClickCheckout:function(e){e.preventDefault();var t=$(e.target).attr("href"),n={},i={};_.each($(".order-notes"),function(e){var t=$(e).find("input").val(),n=$(e).parents(".list-row").data("product-id");i[n]=t}),n.item_notes=JSON.stringify(i),$.ajax({url:"/service/1.0/cart/update_order_notes",data:n,type:"POST"}).done(function(e){return e.ok?void(window.location=t):(alert("Something went wrong. Please try again shortly."),!1)})},onSavedChange:function(e){var t=$(e.currentTarget),n=t.children(":selected"),i=t.parent().next(),o=i.next(),a="";t.removeClass("add-new edit-existing"),o.find(".faux-input.error").removeClass("error").next(".input-error").removeClass("show"),t.children(".add").is(":selected")?(t.hasClass("addresses")?(this.$addAddressInputs.val(""),this.$addAddressInputs.filter(".state").children(".select").prop("selected",!0).change()):t.hasClass("cards")&&this.$addCardInputs.val(""),i.removeClass("show"),t.addClass("add-new"),o.addClass("show")):t.children(".select").is(":selected")?(i.removeClass("show"),o.removeClass("show")):(t.hasClass("addresses")?(this.$addressId=n.data("address-id"),n.data("name")&&(a="<h3>"+n.data("name")+"</h3>"),a+="<p>"+n.data("recipient")+"<br>"+n.data("address")+"<br>"+n.data("city")+", "+n.data("state")+" "+n.data("zip"),this.updateDefaultAddress(this.$addressId)):t.hasClass("cards")&&(this.$paymentToken=n.data("payment-token"),a="<h3>"+n.data("card-type")+"</h3><p>Ending in "+n.data("last-four")+"</p>",this.updateDefaultCard(this.$paymentToken)),o.removeClass("show"),i.children(".info").html(a),i.addClass("show"),this.$formError.hasClass("show")&&this.formsComplete())},onAddressEditClick:function(e){var t=this.$savedAddresses.children(":selected"),n=t.data("state");e.preventDefault(),this.$displayAddressInfo.removeClass("show"),this.$addAddressInputs.filter(".name").val(t.data("recipient")),this.$addAddressInputs.filter(".address").val(t.data("address")),this.$addAddressInputs.filter(".city").val(t.data("city")),this.$addAddressInputs.filter(".state").children('[value="'+n+'"]').prop("selected",!0).change(),this.$addAddressInputs.filter(".zip").val(t.data("zip")),this.$addAddressInputs.filter(".label").val(t.data("name")),this.$addAddressInputs.filter(".address-id").val(t.data("address-id")),this.$savedAddresses.addClass("edit-existing"),this.$addAddressForm.addClass("show")},onAddressDeleteClick:function(e){var t=this.$savedAddresses.children(":selected"),n=t.data("address-id");e.preventDefault(),$.ajax({url:"/service/1.0/cart/delete_address",data:{address_id:n},type:"POST",context:this}).done(function(e){if(e){var n;t.remove(),n=this.$savedAddresses.children(".insert").next(),n.is(":disabled")?(this.$savedAddresses.children(".add").prop("selected",!0).change(),this.$savedAddresses.removeClass("show")):this.$savedAddresses.children(".select").prop("selected",!0).change(),kp.flashMessage.info("Address deleted.")}else alert("Something went wrong. Please try again shortly.")})},onAddressSubmit:function(e){var t,n=this,i=this.$addAddressInputs.filter(".address-id").val(),o={},a=!0;if(e.preventDefault(),i&&(o.address_id=i),o.recipient_name=kp.form.sanitize(this.$addAddressInputs.filter(".name").val(),["trim"]),o.street_address=kp.form.sanitize(this.$addAddressInputs.filter(".address").val(),["trim"]),o.locality=kp.form.sanitize(this.$addAddressInputs.filter(".city").val(),["trim"]),o.region=this.$addAddressInputs.filter(".state").children(":selected").val(),o.postal_code=kp.form.sanitize(this.$addAddressInputs.filter(".zip").val(),["trim"]),o.name=kp.form.sanitize(this.$addAddressInputs.filter(".label").val(),["trim"]),o.is_default=!0,o.is_billing=!1,this.$addAddressInputs.each(function(){var e=$(this);e.hasClass("optional")||e.hasClass("address-id")||n.requiredValidator.validate(e.val())?e.hasClass("state")&&e.children(":selected").hasClass("select")&&(kp.util.showInputError(e),a=!1):(kp.util.showInputError(e,"Required"),a=!1)}),o.street_address){var r=o.street_address.replace(/\W/g,"").toLowerCase();(r.match(/pobox/)||r.match(/postofficebox/))&&(kp.util.showInputError(this.$addAddressInputs.filter(".address"),"Please use a non PO Box address"),a=!1)}o.postal_code&&!this.zipValidator.validate(o.postal_code)&&(kp.util.showInputError(this.$addAddressInputs.filter(".zip"),"Invalid ZIP"),a=!1),a&&$.ajax({url:"/service/1.0/cart/save_address",data:o,type:"POST",context:this}).done(function(e){e?(i?(t=this.$savedAddresses.children(":selected"),t.data("recipient",o.recipient_name),t.data("address",o.street_address),t.data("city",o.locality),t.data("state",o.region),t.data("zip",o.postal_code),t.data("name",o.name)):(this.$savedAddresses.addClass("add-new"),t=$('<option data-address-id="'+e.address_id+'" data-recipient="'+o.recipient_name+'" data-address="'+o.street_address+'" data-city="'+o.locality+'" data-state="'+o.region+'" data-zip="'+o.postal_code+'" data-name="'+o.name+'"></option>'),this.$addressId=e.address_id,this.$savedAddresses.children(".insert").after(t),t.prop("selected",!0)),t.text(o.name?o.name+" ("+o.street_address+")":o.street_address),t.change(),this.$savedAddresses.addClass("show"),kp.flashMessage.success(i?"Address updated!":"Address added!")):alert("Something went wrong. Please try again shortly.")})},onCardDeleteClick:function(e){var t=this.$savedCards.children(":selected"),n=t.data("payment-token");e.preventDefault(),$.ajax({url:"/service/1.0/cart/delete_payment_option",data:{payment_token:n},type:"POST",context:this}).done(function(e){if(e){var n;t.remove(),n=this.$savedCards.children(".insert").next(),n.is(":disabled")?(this.$savedCards.children(".add").prop("selected",!0).change(),this.$savedCards.removeClass("show")):this.$savedCards.children(".select").prop("selected",!0).change(),kp.flashMessage.info("Card deleted.")}else alert("Something went wrong. Please try again shortly.")})},getClientToken:function(){$.ajax({url:"/service/1.0/cart/get_client_token",context:this}).done(function(e){e?this.client=new braintree.api.Client({clientToken:e.client_token}):console.log("Unable to get Client Token. Braintree not setup.")})},nonceCallback:function(e,t,n,i){var o,a={};t&&(a.fname=n,a.lname=i,a.nonce=t,a.is_default=!0,$.ajax({url:"/service/1.0/cart/add_payment_with_nonce",data:a,type:"POST",context:this}).done(function(e){e?(this.$savedCards.addClass("add-new"),o=$('<option data-payment-token="'+e.token+'" data-card-type="'+e.card_type+'" data-last-four="'+e.last_4+'" selected>'+e.card_type+"****"+e.last_4+"</option>"),this.$savedCards.children(".insert").after(o),o.prop("selected",!0).change(),this.$savedCards.addClass("show"),kp.flashMessage.success("Card added!")):alert("Something went wrong. Please try again shortly.")}).fail(function(e){500===e.status&&alert("Invalid card details. Please try again.")}))},onCardSubmit:function(e){var t=this,n={},i=!0;e.preventDefault(),n.firstName=kp.form.sanitize(this.$addCardInputs.filter(".first-name").val(),["trim"]),n.lastName=kp.form.sanitize(this.$addCardInputs.filter(".last-name").val(),["trim"]),n.fullName=n.firstName+" "+n.lastName,n.cardNumber=this.$cardNum.val(),n.expiryVal=kp.form.sanitize(this.$expiry.val(),["trim"]),n.expiry=this.$expiry.payment("cardExpiryVal"),n.CVV=this.$cvv.val(),n.ZIP=kp.form.sanitize(this.$addCardInputs.filter(".zip").val(),["trim"]),n.cardType=$.payment.cardType(n.cardNumber),this.$addCardInputs.each(function(){var e=$(this);t.requiredValidator.validate(e.val())||(kp.util.showInputError(e,"Required"),i=!1)}),n.cardNumber&&!$.payment.validateCardNumber(n.cardNumber)?(kp.util.showInputError(this.$cardNum,"Invalid Card"),i=!1):n.cardNumber=n.cardNumber.replace(/\s+/g,""),n.expiryVal&&!$.payment.validateCardExpiry(n.expiry)&&(kp.util.showInputError(this.$expiry,"Invalid Expiration"),i=!1),n.CVV&&!$.payment.validateCardCVC(n.CVV,n.cardType)&&(kp.util.showInputError(this.$cvv,"Invalid CVV"),i=!1),n.ZIP&&!this.zipValidator.validate(n.ZIP)&&(kp.util.showInputError(this.$addCardInputs.filter(".zip"),"Invalid ZIP"),i=!1),i&&this.client.tokenizeCard({number:n.cardNumber,cardholderName:n.fullName,expirationMonth:n.expiry.month,expirationYear:n.expiry.year,cvv:n.CVV,billingAddress:{postalCode:n.ZIP}},function(e,i){t.nonceCallback(e,i,n.firstName,n.lastName)})},onContactInfoEditClick:function(e){e.preventDefault(),this.$displayContactInfo.removeClass("show"),this.$addContactInfoForm.addClass("show")},onContactInfoSubmit:function(e){var t,n={},i=!0;e.preventDefault(),n.email=kp.form.sanitize(this.$("input#email").val(),["trim"]),n.phone_number=this.$("input#phone").val().replace(/\D/g,""),this.requiredValidator.validate(n.email)||(kp.util.showInputError(this.$("input#email"),"Required"),i=!1),this.requiredValidator.validate(n.phone_number)||(kp.util.showInputError(this.$("input#phone"),"Required"),i=!1),n.email&&kp.util.endsWith(n.email,"@facebook.com")&&(kp.util.showInputError(this.$("input#email"),"Please use a non-Facebook domain"),i=!1),n.phone_number&&(this.phoneValidator.validate(n.phone_number)?t="("+n.phone_number.substr(0,3)+") "+n.phone_number.substr(3,3)+"-"+n.phone_number.substr(6,4):(kp.util.showInputError(this.$("input#phone"),"Invalid Number"),i=!1)),i&&$.ajax({url:"/service/1.0/user/set_preferences",data:n,type:"POST",context:this}).done(function(e){if(e){var i="<p>"+n.email+"</p><p>"+t+"</p>";this.$displayContactInfo.children(".info").html(i),this.$addContactInfoForm.removeClass("show"),this.$displayContactInfo.addClass("show"),this.$formError.hasClass("show")&&this.formsComplete(),kp.flashMessage.success("Contact info updated!")}else alert("Something went wrong. Please try again shortly.")})},onPromoCodeAddEditSave:function(){this.promoCode=kp.form.sanitize(this.$promoCodeInput.val(),["trim"]),this.isSpecialCode(this.promoCode)||(this.$promoCodeText.hasClass("save-code")?$.ajax({url:"/service/1.0/cart/apply_gift_code",data:{gift_code:this.promoCode},type:"POST",context:this}).done(function(e){e?(this.$promoCodeText.removeClass("save-code"),this.promoCode?this.$promoCodeText.text(this.promoCode).attr("title","Edit promo code"):this.$promoCodeText.text("Add").attr("title",""),this.$promoCodeText.next(".edit-code").removeClass("show"),this.$promoCodeInput.val(this.promoCode)):alert("Something went wrong. Please try again shortly.")}):(this.$promoCodeText.addClass("save-code").text("Save").attr("title",""),this.$promoCodeText.next(".edit-code").addClass("show"),this.$promoCodeInput.focus()))},isSpecialCode:function(e){return e.toLowerCase()===this.specialCode.toLowerCase()?(this.showPromoMessage(),!0):(this.hidePromoMessage(),!1)},getBraintreeDataSessionId:function(){var e=this;return this.BTDataDfd||(this.BTDataDfd=$.Deferred(),this.loadBraintreeData().done(function(){var t=document.createElement("form"),n=BraintreeData.environments[kp.config.BTEnvironment],i=n.withId(kp.config.kountMerchantId);t.id="BTCollectionFrm",document.body.appendChild(t),BraintreeData.setup(kp.config.BTMerchantId,t.id,i),document.body.removeChild(t),e.BTDataDfd.resolveWith(e,[BraintreeData.deviceSessionId])}).fail(function(){e.BTDataDfd.rejectWith(e)})),this.BTDataDfd.promise()},loadBraintreeData:function(){var e=this,t="https://js.braintreegateway.com/v1/braintree-data.js";return this.BTDataScriptDfd||(this.BTDataScriptDfd=$.Deferred(),kp.util.scriptLoad(t).done(function(){e.BTDataScriptDfd.resolveWith(e)}).fail(function(){e.BTDataScriptDfd.rejectWith(e)})),this.BTDataScriptDfd.promise()},formsComplete:function(){return this.$addAddressForm.hasClass("show")||this.$addCardForm.hasClass("show")||this.$addContactInfoForm.hasClass("show")?(this.$formError.text("Please complete and save all forms.").addClass("show"),!1):this.$savedAddresses.children(".select").is(":selected")||this.$savedCards.children(".select").is(":selected")?(this.$formError.text("Please select an address and card.").addClass("show"),!1):(this.$formError.removeClass("show"),!0)},onClickPlaceOrder:function(e){e.preventDefault();var t={};if(this.promoCode=kp.form.sanitize(this.$(".code-input").val(),["trim"]),!this.isSpecialCode(this.promoCode)&&this.formsComplete()){var n=$(e.currentTarget);n.addClass("processing"),t.shipping_id=this.$addressId,t.payment_token=this.$paymentToken,t.gift_code=this.promoCode,this.getBraintreeDataSessionId().done(function(e){t.device_data=e,$.ajax({url:"/service/1.0/cart/place_order",data:t,type:"POST"}).done(function(e){if(e)if(e.success){var t=e.order_id;window.location="/cart/confirmation/"+t+"/"}else alert("Your card was declined and your order has not been submitted. Please place the order again with a valid credit card whenever you like, or contact us at gogetters@keep.com for assistance."),window.location.href="/cart/";else n.removeClass("processing"),alert("Something went wrong. Please try again shortly.")}).fail(function(){n.removeClass("processing"),alert("Your credit card could not be processed. Please try again or use another card.")})})}},checkForTruck:function(){var e=this,t=setInterval(function(){e.$(".truck-img").length&&!e.$el.hasClass("velocity-animating")&&(e.animateTruck(),clearInterval(t))},100)},animateTruck:function(){var e=this.$(".truck-img");e.one("load",function(){setTimeout(function(){e.addClass("show")},500)}).each(function(){this.complete&&e.load()})},handleOutOfStockMessage:function(){localStorage.getItem("seen-out-of-stock")||setTimeout(function(){$(".out-of-stock-message").addClass("show"),localStorage.setItem("seen-out-of-stock",!0)},500)},closeOutOfStockMessage:function(){$(".out-of-stock-message").removeClass("show")},showPromoMessage:function(){$(".promo-message").slideDown()},hidePromoMessage:function(){$(".promo-message").slideUp()},updateDefaultCard:function(e){$.ajax({url:"/service/1.0/cart/set_default_payment",data:{payment_token:e},type:"POST"}).done(function(e){e.updated||alert("Something went wrong. Please try again shortly.")})},updateDefaultAddress:function(e){$.ajax({url:"/service/1.0/cart/set_default_address",data:{address_id:e,is_shipping:!0},type:"POST",context:this}).done(function(e){e.quote_price?this.updateCartQuote(e.quote_price):alert("Something went wrong. Please try again shortly.")})},updateCartQuote:function(e){var t=$(".cart-summary");t.find(".subtotal .amt").html(e.raw_total),t.find(".shipping-tax .amt").html(e.shipping_and_tax),t.find(".total .amt").html(e.total)}})}(),function(){kp.views.CartHelloModal=Backbone.View.extend({el:"#cart-hello-modal",oneMonth:2592e6,events:{"click .icon-close-x":"hideModal","hide.bs.modal":"setCookie"},initialize:function(){this.$el.modal("show")},hideModal:function(){this.$el.modal("hide")},setCookie:function(){kp.util.setCookie("hide-carthello",1,this.oneMonth)}})}(),kp.root=function(e){function t(){kp.util.setupCSRF(),kp.util.setupErrorHandling(),_.extend(kp,Backbone.Events),i(),kp.router.start(),e.requestAnimationFrame(n)}function n(){if(kp.flashMessage.initAll(),kp.views.header.init(),kp.config.user.isAuthenticated)kp.initializedViews.rekeepView||(kp.initializedViews.rekeepView=new kp.views.rekeep({el:"#rekeep_modal"})),kp.views.follow.init(),kp.views.sentiment.init();else{var t=new kp.views.auth.Modal({el:"body"});$(".js-login-lnk,.js-register-lnk").on("click",function(){t.trackLogin("login_page")})}kp.browser.touch||kp.views.user.hoverCard.init(),kp.browser.touch&&kp.IOS.hasSupport()?(kp.iosView=new kp.IOS,$("body").addClass("is-ios").find("#header-sizzle").append(kp.iosView.el)):$("#app-signup-sizzle").length&&$("body").addClass("b-sizzle"),$(".masthead").length&&kp.views.masthead.init(),kp.views.socialWidgets.scan(),kp.analytics.setupTracking(),kp.config.user.canCurateContent&&kp.views.contentCurate.init(),kp.analytics.trackFacebookRetargeting(),null===kp.util.getCookie("hide-carthello")&&$(e).width()>750&&new kp.views.CartHelloModal}function i(){var e;return kp.router=new kp.Router(o),kp.session=new kp.PageSession(o),kp.session.start(),kp.config.is404?void kp.session.add(new Backbone.View):(e=_.clone(Backbone.Events),e.listenToOnce(kp.router,"route",function(t,n){e.stopListening();var i=new t.module({urlArgs:n,el:".page_content"});kp.session.add(i)}),void e.listenToOnce(kp.router,"route_miss",function(){e.stopListening(),kp.session.add(new Backbone.View)}))}kp.initializedViews={};var o=[{url:"^/([^/]+)/[kx]/([^/]+)/",module:kp.views.keep.Detail},{url:"^/social/$",module:kp.views.MyFeed},{url:"^/([^/]+)/fg/([^/]+)",module:kp.views.FeaturedCollection},{url:"^/$",module:kp.views.Index},{url:"^/trending2/$",module:kp.views.GenericGrid},{url:"^/preferences/",module:kp.views.Preferences},{url:"^/u/([^/]+)/(followers/|following/)?$",module:kp.views.user.profile.init},{url:"^/u/([^/]+)/keeps/$",module:kp.views.GenericGrid},{url:"^/u/([^/]+)/price-alerts",module:kp.views.GenericGrid},{url:"^/price-alerts/",module:kp.views.GenericGrid},{url:"^/cs/([^/]+)/",module:kp.views.GenericGrid},{url:"^/c/([^/]+)/",module:kp.views.GenericGrid},{url:"^/u/([^/]+)/likes/",module:kp.views.GenericGrid},{url:"^/recentkeeps/$",module:kp.views.GenericGrid},{url:"^/collections/([^/]+)/edit$",module:kp.views.collection.edit.init},{url:"^/all/$",module:kp.views.GenericGrid},{url:"^/source/([^/]+)/",module:kp.views.GenericGrid},{url:"^/store/([^/]+)/",module:kp.views.GenericGrid},{url:"^/downloads/$",module:kp.views.downloads.init},{url:"^/giveaway7/$",module:kp.views.downloads.init},{url:"^/invite/$",module:kp.views.user.invite.init},{url:"^/moderate/$",module:kp.views.GenericGrid},{url:"^/trending_v2/",module:kp.views.GenericGrid},{url:"^/h/([^/]+)/$",module:kp.views.GenericGrid},{url:"^/([^/]+)/c/([^/]+)/$",module:kp.views.GenericGrid},{url:"^/search/",module:kp.views.searchResults.init},{url:"^/tools/$",module:kp.views.tools.init},{url:"^/tools/crick/$",module:kp.views.crick.init},{url:"^/users/$",module:kp.views.user.users.init},{url:"^/notifications/$",module:kp.views.user.notifications.init},{url:"^/category/.*",module:kp.views.GenericGrid},{url:"^/new/$",module:kp.views.GenericGrid},{url:"^/about",module:kp.views.About},{url:"^/read/([^/]+)/([^/]+)/$",module:kp.views.blog.Detail},{url:"^/tools/enter_product_info/$",module:kp.views.ProductInfo},{url:"^/cart/",module:kp.views.Cart}];return{init:t}}(window);